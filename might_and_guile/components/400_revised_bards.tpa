
//__________________________________________________________________________________
//__________________________________________________________________________________
//
//								REVISED BARDS
//__________________________________________________________________________________
//__________________________________________________________________________________

/* 
thiefscl:
PP	OL	FT	MS	HiS	DI	ST	Stealth
*/

// ***** left to do:
// --/ fix initialization
// --/ make 5E casting optional...??
// --/ check bottom where nubard.2da is appended
// --/ liberalize thief skills (make sure meister can hide!)
// --/ change kit descs if no 5E casting

//COPY MARKER FILE__________________________________________________________________
//
COPY ~might_and_guile/lib/markers/d5_marker.d5~ ~override/d5__bards.d5~
//__________________________________________________________________________________


LAM JOINABLE_NPC_ARRAYS


//BARD ABILITY FILES_________________________________________________________________
//
COPY ~might_and_guile/misc/d5_1hp.spl~ ~override~				//	1 hit point bonus
	SAY NAME1 ~ ~
	SAY UNIDENTIFIED_DESC ~ ~
COPY ~might_and_guile/misc/d5lor05.spl~ ~override~				//	5-point lore bonus
	SAY NAME1 ~ ~
	SAY UNIDENTIFIED_DESC ~ ~
COPY ~might_and_guile/misc/d5lor20.spl~ ~override~				//	20-point lore bonus
	SAY NAME1 ~ ~
	SAY UNIDENTIFIED_DESC ~ ~
COPY ~might_and_guile/misc/d5_bab1.spl~ ~override~				//	thac0 bonus
	SAY NAME1 ~ ~
	SAY UNIDENTIFIED_DESC ~ ~
COPY ~might_and_guile/misc/d5_bab2.spl~ ~override~				//	thac0 bonus
	SAY NAME1 ~ ~
	SAY UNIDENTIFIED_DESC ~ ~
COPY ~might_and_guile/feats/d5_rfe8b.bam~ ~override~
COPY ~might_and_guile/misc/d5swash.spl~ ~override~				//	swashbuckling ability
	SAY NAME1 @5506
	SAY UNIDENTIFIED_DESC @5507
	WRITE_ASCII 0x3a ~d5_rfe8b~ #8
	LPF ALTER_SPELL_HEADER STR_VAR icon = ~d5_rfe8b~ END
COPY ~might_and_guile/misc/d5swshb.eff~ ~override~
COPY ~might_and_guile/misc/d5swshc.spl~ ~override~
COPY ~might_and_guile/misc/d5swshx.spl~ ~override~
	SAY NAME1 @5514
	SAY UNIDENTIFIED_DESC @5514
COPY ~might_and_guile/misc/d5swshx.bam~ ~override~
COPY ~might_and_guile/misc/d5_notu.spl~ ~override~				//	disable turn undead
	SAY NAME1 ~ ~
	SAY UNIDENTIFIED_DESC ~ ~
	
//disable skill buttons_______________________________________________________________
//
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5noppb.spl~
  LPF ADD_SPELL_EFFECT INT_VAR opcode = 144 target = 1 parameter2 = 1 timing = 9 END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5nomsb.spl~
  LPF ADD_SPELL_EFFECT INT_VAR opcode = 144 target = 1 parameter2 = 0 timing = 9 END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5noftb.spl~
  LPF ADD_SPELL_EFFECT INT_VAR opcode = 144 target = 1 parameter2 = 14 timing = 9 END

//base HLA table______________________________________________________________________
//
COPY ~might_and_guile/nubards/lud5brd.2da~ ~override~
//____________________________________________________________________________________


//ADD WHISTLER AS THIEF______________________________________________________________
//
// ***** make this a druid/thief kit...???
// if so, add the kit, but not in menu; only if FnP installed add to menu

LAF check_kit_conflict END

ADD_KIT ~D5_WHISTLER~

//WEAPON PROFICIENCIES_______________________________________________________________
//11                                   T   S           F   Q             S S
//10           L S                     W   C           L   U             W I
//9            A M             B L S   O   I   W       A   A             O N
//8            R A             A O H   H   M   A       I   R C   S       R G
//7            G L           M S N O   A   I   R     H L   T R L H     2 D L 2                 E E E E E E E E E E E
//6            E L       S   I T G R   N K T D H     A M   E O O O     H A E W E E E E E E E E X X X X X X X X X X X
//5            S S   S B P   S A S T   D A A A A   S L O   R S N R   S A N W E X X X X X X X X T T T T T T T T T T T
//4            W W   P L I   S R W S   E T R G M C P B R M S S G T D L N D E A T T T T T T T T R R R R R R R R R R R
//3            O O B E U K A I D O W A D A W G M L E E N A T B B B A I D S A P R R R R R R R R A A A A A A A A A A A
//2            R R O A N E X L S R O X S N A E E U A R I C A O O O R N E H P O A A A A A A A A 1 1 1 1 1 1 1 1 1 1 2
//1            D D W R T D E E W D R E W A K R R B R D N E F W W W T G D I O N 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0
~D5_WHISTLER   1 1 1 1 1 1 1 1~
~D5_WHISTLER   0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 2 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~

//MINIMUM KIT STATS__________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_WHISTLER       0   12  0   0   9   12~

//KIT STAT MODIFIERS_________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_WHISTLER       0   0   0   0   0   0~

//REQUIREMENTS TO DUAL TO THIS KIT___________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_WHISTLER       0   17  0   0   0   17~

//REQUIREMENTS TO DUAL FROM THIS KIT_________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_WHISTLER       0   15  0   0   0   15~

//ALIGNMENT RESTRICTIONS_____________________________________________________________
//                 LG LN LE NG TN NE CG CN CE
~D5_WHISTLER       1  1  0  1  1  1  1  1  0~

//DUAL CLASS OPTIONS_________________________________________________________________
//                 FT CL MA TH DR RA
~D5_WHISTLER       1  1  0  0  0  0~

//KIT ABILITIES 2DA FILE_____________________________________________________________
~might_and_guile/nubards/d5_whsl.2da~

//RACIAL KIT AVAILABILITY____________________________________________________________
~K_T_HL~

//UNUSABLE FLAGS AND KIT BASE CLASS__________________________________________________
//CLASSES: Mage = 1, Fighter = 2, Cleric=3, Thief = 4, Bard = 5
//         Paladin 6, Druid = 11, Ranger = 12, Sorcerer = 19
//         Monk = 20, FT = 9, FC = 8, CT = 15, CR = 18, FM = 7, CM = 14, MT = 13
~0x00004000 4~

//HIGH LEVEL ABILITIES ABBREVIATION__________________________________________________
~Th0~

//TOB STARTING EQUIPMENT_____________________________________________________________
~LEAT14	* HELM07 BAG25 RING06 RING31 CLCK02 BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 BOW18 SW1H39 STAF08~

//CHARACTER CREATION KIT DESCRIPTION_________________________________________________
SAY @40861
SAY @40862
SAY @40863
//___________________________________________________________________________________

//EE KIT EXTRAS______________________________________________________________________
// 
ACTION_IF GAME_IS ~bgee bg2ee eet iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@40863)
		STR_VAR
			kit_name = D5_WHISTLER
			clswpbon = ~0 0 3~
			hpclass = ~HPROG~
			clsrcreq = ~0 0 0 0 1 0 0~
			sneakatt = ~1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2~
			backstab = ~1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2~
			thiefskl = ~40 20~
			thiefscl = ~100 100 100 0 0 100 0 0~
	END
END
//___________________________________________________________________________________

//WHISTLER ABILITY FILES_____________________________________________________________
//
COPY ~might_and_guile/nubards/d5_whsl.2da~ ~override~

COPY ~might_and_guile/misc/d5_xp75.spl~ ~override~
  LPF ALTER_EFFECT INT_VAR silent = 1 match_opcode = 104 parameter1 = 80 END

ACTION_IF !(FILE_EXISTS_IN_GAME ~d5wh000.spl~) BEGIN
 ACTION_DEFINE_ASSOCIATIVE_ARRAY semi_innate_whistler BEGIN
  d5wh01 => sppr207	
  d5wh02 => sppr105	
  d5wh03 => sppr212	
  d5wh04 => sppr109	
  d5wh05 => sppr202	
  d5wh06 => sppr317	
  d5wh07 => sppr318	
  d5wh08 => sppr319	
 END
 LAF semi_innate_casting INT_VAR semi_innate_stat = 109 semi_innate_shift = 20 STR_VAR semi_innate_prefix = ~d5wh~ semi_innate_array = ~semi_innate_whistler~ END
 COPY ~might_and_guile/nubards/d5kiwhs.spl~ ~override~			//	add ki points
  LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter2 = 1 timing = 1 STR_VAR resource = ~d5wh172~ END
  LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5whpls~ END
END
//___________________________________________________________________________________

//WILD TALENT_________________________________________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~d5__psionics.d5~) BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5_whsl.2da~) BEGIN
	APPEND ~d5_whsl.2da~ ~WILD_TLNT   AP_D5PSWT_  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
  END
END
//____________________________________________________________________________________

// get kit identifier, add to bards list______________________________________________
//
OUTER_SET nu_whistler_code = (0x4000 + %D5_WHISTLER%)
OUTER_SPRINT $bard_kits_list(~d5_whsl~ ~%nu_whistler_code%~) ~T~
//____________________________________________________________________________________


//ADD LORESINGER AS CLERIC, and C/T____________________________________________________
//
// cleric with songs... basically, a demibard

ACTION_IF !(FILE_EXISTS_IN_GAME ~d5__cleric_umd.d5~) BEGIN
  LAF clerics_use_magical_devices END
  LAF cleric_clabs_umd END
END

LAF check_kit_conflict END

ADD_KIT ~D5_LORESINGER~

//WEAPON PROFICIENCIES_______________________________________________________________
//11           		                        T   S           F   Q             S S
//10           		L S                     W   C           L   U             W I
//9            		A M             B L S   O   I   W       A   A             O N
//8            		R A             A O H   H   M   A       I   R C   S       R G
//7            		G L           M S N O   A   I   R     H L   T R L H     2 D L 2                 E E E E E E E E E E E
//6            		E L       S   I T G R   N K T D H     A M   E O O O     H A E W E E E E E E E E X X X X X X X X X X X
//5            		S S   S B P   S A S T   D A A A A   S L O   R S N R   S A N W E X X X X X X X X T T T T T T T T T T T
//4            		W W   P L I   S R W S   E T R G M C P B R M S S G T D L N D E A T T T T T T T T R R R R R R R R R R R
//3            		O O B E U K A I D O W A D A W G M L E E N A T B B B A I D S A P R R R R R R R R A A A A A A A A A A A
//2            		R R O A N E X L S R O X S N A E E U A R I C A O O O R N E H P O A A A A A A A A 1 1 1 1 1 1 1 1 1 1 2
//1            		D D W R T D E E W D R E W A K R R B R D N E F W W W T G D I O N 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0
~D5_LORESINGER      0 0 0 0 0 0 0 0~
~D5_LORESINGER      0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 1 1 1 0 0 0 0 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~

//MINIMUM KIT STATS_________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_LORESINGER     0   0   0   9   12  15~

//KIT STAT MODIFIERS________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_LORESINGER     0   0   0   0   0   0~

//REQUIREMENTS TO DUAL TO THIS KIT__________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_LORESINGER     0   0   0   0   017  17~

//REQUIREMENTS TO DUAL FROM THIS KIT________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_LORESINGER     0   0   0   0   15  15~

//ALIGNMENT RESTRICTIONS____________________________________________________________
//                 LG LN LE NG TN NE CG CN CE
~D5_LORESINGER     1  1  0  1  1  0  1  1  0~

//DUAL CLASS OPTIONS________________________________________________________________
//                 FT CL MA TH DR RA
~D5_LORESINGER     1  0  1  1  0  0~

//KIT ABILITIES 2DA FILE____________________________________________________________
~might_and_guile/nubards/d5_lors.2da~

//RACIAL KIT AVAILABILITY___________________________________________________________
~K_C_D K_C_E K_C_G K_C_H K_C_HE K_C_HL K_C_HO~

//UNUSABLE FLAGS AND KIT BASE CLASS_________________________________________________
//CLASSES: Mage = 1, Fighter = 2, Cleric=3, Thief = 4, Bard = 5
//         Paladin 6, Druid = 11, Ranger = 12, Sorcerer = 19
//         Monk = 20, FT = 9, FC = 8, CT = 15, CR = 18, FM = 7, CM = 14, MT = 13
~0x00800000 3~

//HIGH LEVEL ABILITIES ABBREVIATION_________________________________________________
~CL0~

//TOB STARTING EQUIPMENT_____________________________________________________________
~LEAT14	* HELM07 BAG25 RING06 RING31 CLCK02 BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 BOW18 SW1H39 STAF08~

//CHARACTER CREATION KIT DESCRIPTION_________________________________________________
SAY @40866
SAY @40867
SAY @40868

//EE KIT EXTRAS______________________________________________________________________
// 
ACTION_IF GAME_IS ~bgee bg2ee eet iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@40868)
		STR_VAR
			kit_name = D5_LORESINGER
			clswpbon = ~0 0 3~
			clsrcreq = ~1 1 1 0 0 1 0~
	END
END

//LORESINGER ABILITY FILES___________________________________________________________
//
COPY ~might_and_guile/nubards/d5_lors.2da~ ~override~

//WILD TALENT_________________________________________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~d5__psionics.d5~) BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5_lors.2da~) BEGIN
	APPEND ~d5_lors.2da~ ~WILD_TLNT   AP_D5PSWT_  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
  END
END
// get kit identifier, add to bards list______________________________________________
//
OUTER_SET nu_loresinger_code = (0x4000 + %D5_LORESINGER%)
OUTER_SPRINT $bard_kits_list(~d5_lors~ ~%nu_loresinger_code%~) ~C~

//DEFINE SPHERE ACCESS_______________________________________________________________
//
LAF ~DEFINE_FNP_KIT_INFO~
  INT_VAR
	u_leather_armor 	= 1
	u_chain_armor 		= 1
	u_plate_armor 		= 0
	u_club_staff	 	= 1
	u_hammers	 		= 1
	u_maces 	 		= 1
	u_flails 			= 0
	u_axes 				= 0
	u_daggers 			= 1
	u_short_swords		= 1
	u_long_swords		= 1
	u_scimitars 		= 1
	u_katanas 			= 0
	u_bastard_swords 	= 0
	u_2hand_swords 		= 0
	u_halberds 			= 0
	u_spears 			= 0
	u_darts 			= 1
	u_slings 			= 1
	u_bows 				= 0
	u_crossbows 		= 1  
  STR_VAR
    clab_name 		= ~d5_lors~
	class 			= ~cleric~
	sphere_list 	= ~milil_spheres~
END

LAM ~READ_FNP_KIT_INFO~

ACTION_IF FILE_EXISTS_IN_GAME ~d5__spheres.d5~ BEGIN
  LAF apply_fnp_spheres STR_VAR clab_name = ~d5_lors~ END
END

ACTION_IF FILE_EXISTS_IN_GAME ~d5__fnp_usability.d5~ BEGIN
  LAF apply_fnp_usability STR_VAR clab_name = ~d5_lors~ END
END

ACTION_IF (FILE_EXISTS_IN_GAME ~d5__fnp_spont_option.d5~) AND (FILE_EXISTS ~faiths_and_powers/lib/system_fnp_spontaneous.tpa~) BEGIN
  ACTION_IF (FILE_EXISTS ~faiths_and_powers/language/%LANGUAGE%/fnp_spontaneous.tra~) BEGIN
    OUTER_SPRINT spont_lang ~%LANGUAGE%~
  END ELSE BEGIN
    OUTER_SPRINT spont_lang ~english~
  END
  ACTION_IF (FILE_EXISTS ~faiths_and_powers/language/%spont_lang%/fnp_spontaneous.tra~) BEGIN
    WITH_TRA ~faiths_and_powers/language/%spont_lang%/fnp_spontaneous.tra~ BEGIN
      INCLUDE ~faiths_and_powers/lib/system_fnp_spontaneous.tpa~
      LAF fnp_spontaneous STR_VAR kit_clab = ~d5_lors~ learn_res = ~d5lorz~ END
    END
  END
END

ACTION_IF (FILE_EXISTS_IN_GAME ~d5__cleric_umd.d5~) BEGIN
  APPEND ~d5_lors.2da~ ~NO_UMD      AP_D5_NUMD  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
END
//__________________________________________________________________________________

COPY ~might_and_guile/nubards/d5_lors.2da~ ~override/d5_lort.2da~

LAF check_kit_conflict END

ADD_KIT ~D5_LORESINGER_CT~

//WEAPON PROFICIENCIES_______________________________________________________________
//11           		                          T   S           F   Q             S S
//10           		  L S                     W   C           L   U             W I
//9            		  A M             B L S   O   I   W       A   A             O N
//8            		  R A             A O H   H   M   A       I   R C   S       R G
//7            		  G L           M S N O   A   I   R     H L   T R L H     2 D L 2                 E E E E E E E E E E E
//6            		  E L       S   I T G R   N K T D H     A M   E O O O     H A E W E E E E E E E E X X X X X X X X X X X
//5            		  S S   S B P   S A S T   D A A A A   S L O   R S N R   S A N W E X X X X X X X X T T T T T T T T T T T
//4            		  W W   P L I   S R W S   E T R G M C P B R M S S G T D L N D E A T T T T T T T T R R R R R R R R R R R
//3            		  O O B E U K A I D O W A D A W G M L E E N A T B B B A I D S A P R R R R R R R R A A A A A A A A A A A
//2            		  R R O A N E X L S R O X S N A E E U A R I C A O O O R N E H P O A A A A A A A A 1 1 1 1 1 1 1 1 1 1 2
//1            		  D D W R T D E E W D R E W A K R R B R D N E F W W W T G D I O N 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0
~D5_LORESINGER_CT     0 0 0 0 0 0 0 0~
~D5_LORESINGER_CT     0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 1 1 1 0 0 0 0 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~

//MINIMUM KIT STATS_________________________________________________________________
//                  STR DEX CON INT WIS CHR
~D5_LORESINGER_CT    0   0   0   9   12  15~

//KIT STAT MODIFIERS________________________________________________________________
//                  STR DEX CON INT WIS CHR
~D5_LORESINGER_CT    0   0   0   0   0   0~

//REQUIREMENTS TO DUAL TO THIS KIT__________________________________________________
//                  STR DEX CON INT WIS CHR
~D5_LORESINGER_CT    0   0   0   0   017  17~

//REQUIREMENTS TO DUAL FROM THIS KIT________________________________________________
//                  STR DEX CON INT WIS CHR
~D5_LORESINGER_CT    0   0   0   0   15  15~

//ALIGNMENT RESTRICTIONS____________________________________________________________
//                  LG LN LE NG TN NE CG CN CE
~D5_LORESINGER_CT    1  1  0  1  1  0  1  1  0~

//DUAL CLASS OPTIONS________________________________________________________________
//                  FT CL MA TH DR RA
~D5_LORESINGER_CT    0  1  0  1  0  0~

//KIT ABILITIES 2DA FILE____________________________________________________________
~override/d5_lort.2da~

//RACIAL KIT AVAILABILITY___________________________________________________________
~K_CT_D K_CT_E K_CT_G K_CT_H K_CT_HE K_CT_HL K_CT_HO~

//UNUSABLE FLAGS AND KIT BASE CLASS_________________________________________________
//CLASSES: Mage = 1, Fighter = 2, Cleric=3, Thief = 4, Bard = 5
//         Paladin 6, Druid = 11, Ranger = 12, Sorcerer = 19
//         Monk = 20, FT = 9, FC = 8, CT = 15, CR = 18, FM = 7, CM = 14, MT = 13
~0x00800000 15~

//HIGH LEVEL ABILITIES ABBREVIATION_________________________________________________
~CT0~

//TOB STARTING EQUIPMENT_____________________________________________________________
~LEAT14	* HELM07 BAG25 RING06 RING31 CLCK02 BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 BOW18 SW1H39 STAF08~

//CHARACTER CREATION KIT DESCRIPTION_________________________________________________
SAY @40866
SAY @40867
SAY @40868

//EE KIT EXTRAS______________________________________________________________________
// 
ACTION_IF GAME_IS ~bgee bg2ee eet iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@40868)
		STR_VAR
			kit_name = D5_LORESINGER_CT
			clswpbon = ~0 0 3~
			clsrcreq = ~1 1 1 0 0 1 0~
	END
END

//LORESINGER ABILITY FILES___________________________________________________________
//
//COPY ~might_and_guile/nubards/d5_lort.2da~ ~override~

//WILD TALENT_________________________________________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~d5__psionics.d5~) BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5_lort.2da~) BEGIN
	APPEND ~d5_lort.2da~ ~WILD_TLNT   AP_D5PSWT_  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
  END
END

// get kit identifier, add to bards list______________________________________________
//
OUTER_SET nu_loresinger_ct_code = (0x4000 + %D5_LORESINGER_CT%)
OUTER_SPRINT $bard_kits_list(~d5_lort~ ~%nu_loresinger_ct_code%~) ~C~

//DEFINE SPHERE ACCESS_______________________________________________________________
//
LAF ~DEFINE_FNP_KIT_INFO~
  INT_VAR
	u_leather_armor 	= 1
	u_chain_armor 		= 0
	u_plate_armor 		= 0
	u_club_staff	 	= 1
	u_hammers	 		= 1
	u_maces 	 		= 1
	u_flails 			= 0
	u_axes 				= 0
	u_daggers 			= 1
	u_short_swords		= 1
	u_long_swords		= 1
	u_scimitars 		= 1
	u_katanas 			= 0
	u_bastard_swords 	= 0
	u_2hand_swords 		= 0
	u_halberds 			= 0
	u_spears 			= 0
	u_darts 			= 1
	u_slings 			= 1
	u_bows 				= 0
	u_crossbows 		= 1  
  STR_VAR
    clab_name 		= ~d5_lort~
	class 			= ~cleric_thief~
	sphere_list 	= ~milil_spheres~
END

LAM ~READ_FNP_KIT_INFO~

ACTION_IF FILE_EXISTS_IN_GAME ~d5__spheres.d5~ BEGIN
  LAF apply_fnp_spheres STR_VAR clab_name = ~d5_lort~ END
END

ACTION_IF FILE_EXISTS_IN_GAME ~d5__fnp_usability.d5~ BEGIN
  LAF apply_fnp_usability STR_VAR clab_name = ~d5_lort~ END
END

ACTION_IF (FILE_EXISTS_IN_GAME ~d5__fnp_spont_option.d5~) AND (FILE_EXISTS ~faiths_and_powers/lib/system_fnp_spontaneous.tpa~) BEGIN
  ACTION_IF (FILE_EXISTS ~faiths_and_powers/language/%LANGUAGE%/fnp_spontaneous.tra~) BEGIN
    OUTER_SPRINT spont_lang ~%LANGUAGE%~
  END ELSE BEGIN
    OUTER_SPRINT spont_lang ~english~
  END
  ACTION_IF (FILE_EXISTS ~faiths_and_powers/language/%spont_lang%/fnp_spontaneous.tra~) BEGIN
    WITH_TRA ~faiths_and_powers/language/%spont_lang%/fnp_spontaneous.tra~ BEGIN
      INCLUDE ~faiths_and_powers/lib/system_fnp_spontaneous.tpa~
      LAF fnp_spontaneous STR_VAR kit_clab = ~d5_lort~ learn_res = ~d5lortz~ END
    END
  END
END

/* already done when copied d5_lors to this one
ACTION_IF (FILE_EXISTS_IN_GAME ~d5__cleric_umd.d5~) BEGIN
  APPEND ~d5_lort.2da~ ~NO_UMD      AP_D5_NUMD  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
END
*/
//__________________________________________________________________________________


//NEW "TRUECLASS" BARD________________________________________________________________
//
LAF check_kit_conflict END

ADD_KIT ~D5_BARD~

//WEAPON PROFICIENCIES________________________________________________________________
//11                                   T   S           F   Q             S S
//10           L S                     W   C           L   U             W I
//9            A M             B L S   O   I   W       A   A             O N
//8            R A             A O H   H   M   A       I   R C   S       R G
//7            G L           M S N O   A   I   R     H L   T R L H     2 D L 2                 E E E E E E E E E E E
//6            E L       S   I T G R   N K T D H     A M   E O O O     H A E W E E E E E E E E X X X X X X X X X X X
//5            S S   S B P   S A S T   D A A A A   S L O   R S N R   S A N W E X X X X X X X X T T T T T T T T T T T
//4            W W   P L I   S R W S   E T R G M C P B R M S S G T D L N D E A T T T T T T T T R R R R R R R R R R R
//3            O O B E U K A I D O W A D A W G M L E E N A T B B B A I D S A P R R R R R R R R A A A A A A A A A A A
//2            R R O A N E X L S R O X S N A E E U A R I C A O O O R N E H P O A A A A A A A A 1 1 1 1 1 1 1 1 1 1 2
//1            D D W R T D E E W D R E W A K R R B R D N E F W W W T G D I O N 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0
~D5_BARD       0 0 0 0 0 0 0 0~
~D5_BARD       0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~

//MINIMUM KIT STATS__________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_BARD    	   0   12  0   9   0   15~

//KIT STAT MODIFIERS_________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_BARD           0   0   0   0   0   0~

//REQUIREMENTS TO DUAL TO THIS KIT___________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_BARD           0   17  0   17  0   17~

//REQUIREMENTS TO DUAL FROM THIS KIT_________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_BARD  	       0   15  0   15  0   15~

//ALIGNMENT RESTRICTIONS_____________________________________________________________
//                 LG LN LE NG TN NE CG CN CE
~D5_BARD           1  1  1  1  1  1  1  1  1~

//DUAL CLASS OPTIONS_________________________________________________________________
//                 FT CL MA TH DR RA
~D5_BARD           0  0  0  1  0  0~

//KIT ABILITIES 2DA FILE_____________________________________________________________
~might_and_guile/nubards/d5_bard.2da~

//RACIAL KIT AVAILABILITY____________________________________________________________
~K_MT_H K_MT_E K_MT_HE K_MT_G~

//UNUSABLE FLAGS AND KIT BASE CLASS__________________________________________________
//CLASSES: Mage = 1, Fighter = 2, Cleric=3, Thief = 4, Bard = 5
//         Paladin 6, Druid = 11, Ranger = 12, Sorcerer = 19
//         Monk = 20
~0x00800200 13~

//HIGH LEVEL ABILITIES ABBREVIATION__________________________________________________
~D5BRD~

//TOB STARTING EQUIPMENT_____________________________________________________________
~LEAT14	* HELM07 BAG25 RING06 RING31 CLCK02 BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 BOW18 SW1H39 STAF08~

//CHARACTER CREATION KIT DESCRIPTION_________________________________________________
SAY @40801
SAY @40802
SAY @40803

//EE KIT EXTRAS______________________________________________________________________
// 
ACTION_IF GAME_IS ~bgee bg2ee eet iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@40803)
		STR_VAR
			kit_name = D5_BARD
			clswpbon = ~0 0 3~
			sneakatt = ~1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1~
			backstab = ~1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1~
			thiefskl = ~25 15~
			thiefscl = ~100 100 100 0 0 100 0 0~
			clsrcreq = ~1 1 1 0 0 1 0~
	END
END

//BARD ABILITY FILES_________________________________________________________________
//
COPY_EXISTING ~might_and_guile/nubards/d5_bard.2da~ ~override~

//WILD TALENT_________________________________________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~d5__psionics.d5~) BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5_bard.2da~) BEGIN
	APPEND ~d5_bard.2da~ ~WILD_TLNT   AP_D5PSWT_  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
  END
END

// get kit identifier, add to bards list______________________________________________
//
OUTER_SET nu_bard_code = (0x4000 + %D5_BARD%)
OUTER_SPRINT $bard_kits_list(~d5_bard~ ~%nu_bard_code%~) ~W~
//____________________________________________________________________________________


//ADD BLADE AS MAGE/THIEF_____________________________________________________________
//
LAF check_kit_conflict END

ADD_KIT ~D5_BLADE~

//WEAPON PROFICIENCIES________________________________________________________________
//11                                   T   S           F   Q             S S
//10           L S                     W   C           L   U             W I
//9            A M             B L S   O   I   W       A   A             O N
//8            R A             A O H   H   M   A       I   R C   S       R G
//7            G L           M S N O   A   I   R     H L   T R L H     2 D L 2                 E E E E E E E E E E E
//6            E L       S   I T G R   N K T D H     A M   E O O O     H A E W E E E E E E E E X X X X X X X X X X X
//5            S S   S B P   S A S T   D A A A A   S L O   R S N R   S A N W E X X X X X X X X T T T T T T T T T T T
//4            W W   P L I   S R W S   E T R G M C P B R M S S G T D L N D E A T T T T T T T T R R R R R R R R R R R
//3            O O B E U K A I D O W A D A W G M L E E N A T B B B A I D S A P R R R R R R R R A A A A A A A A A A A
//2            R R O A N E X L S R O X S N A E E U A R I C A O O O R N E H P O A A A A A A A A 1 1 1 1 1 1 1 1 1 1 2
//1            D D W R T D E E W D R E W A K R R B R D N E F W W W T G D I O N 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0
~D5_BLADE      0 0 0 0 0 0 0 0~
~D5_BLADE      0 0 0 0 0 0 0 0 0 2 2 0 0 0 2 2 1 1 0 0 1 1 1 1 0 1 1 1 0 0 2 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~

//MINIMUM KIT STATS__________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_BLADE          9   12  0   9   0   9~

//KIT STAT MODIFIERS_________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_BLADE          0   0   0   0   0   0~

//REQUIREMENTS TO DUAL TO THIS KIT___________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_BLADE          0   17  0   17  0   17~

//REQUIREMENTS TO DUAL FROM THIS KIT_________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_BLADE          0   15  0   15  0   15~

//ALIGNMENT RESTRICTIONS_____________________________________________________________
//                 LG LN LE NG TN NE CG CN CE
~D5_BLADE          1  1  1  1  1  1  1  1  1~

//DUAL CLASS OPTIONS_________________________________________________________________
//                 FT CL MA TH DR RA
~D5_BLADE          0  0  0  1  0  0~

//KIT ABILITIES 2DA FILE_____________________________________________________________
~might_and_guile/nubards/d5_blade.2da~

//RACIAL KIT AVAILABILITY____________________________________________________________
~K_MT_H K_MT_E K_MT_HE~

//UNUSABLE FLAGS AND KIT BASE CLASS__________________________________________________
//CLASSES: Mage = 1, Fighter = 2, Cleric=3, Thief = 4, Bard = 5
//         Paladin 6, Druid = 11, Ranger = 12, Sorcerer = 19
//         Monk = 20
~0x00800200 13~

//HIGH LEVEL ABILITIES ABBREVIATION__________________________________________________
~D5BRD~

//TOB STARTING EQUIPMENT_____________________________________________________________
~LEAT14	* HELM07 BAG25 RING06 RING31 CLCK02 BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 BOW18 SW1H39 STAF08~

//CHARACTER CREATION KIT DESCRIPTION_________________________________________________
SAY @40806
SAY @40807
SAY @40808

//EE KIT EXTRAS______________________________________________________________________
// 
ACTION_IF GAME_IS ~bgee bg2ee eet iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@40808)
		STR_VAR
			kit_name = D5_BLADE
			sneakatt = ~1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2~
			backstab = ~1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2~
			clswpbon = ~0 0 3~
			thiefskl = ~25 15~
			thiefscl = ~100 100 100 100 100 100 0 0~
			clsrcreq = ~1 1 1 0 0 0 0~
	END
END

//BLADE ABILITY FILES_________________________________________________________________
//
COPY ~might_and_guile/nubards/d5_blade.2da~ ~override~


//WILD TALENT_________________________________________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~d5__psionics.d5~) BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5_blade.2da~) BEGIN
	APPEND ~d5_blade.2da~ ~WILD_TLNT   AP_D5PSWT_  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
  END
END

// get kit identifier, add to bards list______________________________________________
//
OUTER_SET nu_blade_code = (0x4000 + %D5_BLADE%)
OUTER_SPRINT $bard_kits_list(~d5_blade~ ~%nu_blade_code%~) ~W~
//____________________________________________________________________________________


//ADD JESTER AS MAGE/THIEF_____________________________________________________________
//
LAF check_kit_conflict END

ADD_KIT ~D5_JESTER~

//WEAPON PROFICIENCIES________________________________________________________________
//11                                   T   S           F   Q             S S
//10           L S                     W   C           L   U             W I
//9            A M             B L S   O   I   W       A   A             O N
//8            R A             A O H   H   M   A       I   R C   S       R G
//7            G L           M S N O   A   I   R     H L   T R L H     2 D L 2                 E E E E E E E E E E E
//6            E L       S   I T G R   N K T D H     A M   E O O O     H A E W E E E E E E E E X X X X X X X X X X X
//5            S S   S B P   S A S T   D A A A A   S L O   R S N R   S A N W E X X X X X X X X T T T T T T T T T T T
//4            W W   P L I   S R W S   E T R G M C P B R M S S G T D L N D E A T T T T T T T T R R R R R R R R R R R
//3            O O B E U K A I D O W A D A W G M L E E N A T B B B A I D S A P R R R R R R R R A A A A A A A A A A A
//2            R R O A N E X L S R O X S N A E E U A R I C A O O O R N E H P O A A A A A A A A 1 1 1 1 1 1 1 1 1 1 2
//1            D D W R T D E E W D R E W A K R R B R D N E F W W W T G D I O N 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0
~D5_JESTER     0 1 0 0 1 1 1 0~
~D5_JESTER     0 0 0 0 0 0 0 0 1 1 1 1 0 1 1 1 1 1 0 0 1 1 1 1 1 1 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~

//MINIMUM KIT STATS__________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_JESTER          0   12  0   9   0   12~

//KIT STAT MODIFIERS_________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_JESTER          0   0   0   0   0   0~

//REQUIREMENTS TO DUAL TO THIS KIT___________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_JESTER          0   17  0   17  0   17~

//REQUIREMENTS TO DUAL FROM THIS KIT_________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_JESTER          0   15  0   15  0   15~

//ALIGNMENT RESTRICTIONS_____________________________________________________________
//                 LG LN LE NG TN NE CG CN CE
~D5_JESTER          0  0  0  1  1  1  1  1  1~

//DUAL CLASS OPTIONS_________________________________________________________________
//                 FT CL MA TH DR RA
~D5_JESTER          0  0  0  1  0  0~

//KIT ABILITIES 2DA FILE_____________________________________________________________
~might_and_guile/nubards/d5_jstr.2da~

//RACIAL KIT AVAILABILITY____________________________________________________________
~K_MT_H K_MT_E K_MT_HE K_MT_G~

//UNUSABLE FLAGS AND KIT BASE CLASS__________________________________________________
//CLASSES: Mage = 1, Fighter = 2, Cleric=3, Thief = 4, Bard = 5
//         Paladin 6, Druid = 11, Ranger = 12, Sorcerer = 19
//         Monk = 20
~0x00800200 13~

//HIGH LEVEL ABILITIES ABBREVIATION__________________________________________________
~D5BRD~

//TOB STARTING EQUIPMENT_____________________________________________________________
~LEAT14	* HELM07 BAG25 RING06 RING31 CLCK02 BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 BOW18 SW1H39 STAF08~

//CHARACTER CREATION KIT DESCRIPTION_________________________________________________
SAY @40811
SAY @40812
SAY @40813

//EE KIT EXTRAS______________________________________________________________________
// 
ACTION_IF GAME_IS ~bgee bg2ee eet iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@40813)
		STR_VAR
			kit_name = D5_JESTER
			clswpbon = ~0 0 3~
			sneakatt = ~1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1~
			backstab = ~1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1~
			thiefskl = ~25 15~
			thiefscl = ~100 100 100 0 0 100 0 0~
			clsrcreq = ~1 1 1 0 0 1 0~
	END
END

//JESTER ABILITY FILES________________________________________________________________
//
COPY ~might_and_guile/nubards/d5_jstr.2da~ ~override~

//WILD TALENT_________________________________________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~d5__psionics.d5~) BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5_jstr.2da~) BEGIN
	APPEND ~d5_jstr.2da~ ~WILD_TLNT   AP_D5PSWT_  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
  END
END

// get kit identifier, add to bards list______________________________________________
//
OUTER_SET nu_jester_code = (0x4000 + %D5_JESTER%)
OUTER_SPRINT $bard_kits_list(~d5_jstr~ ~%nu_jester_code%~) ~W~
//____________________________________________________________________________________


//ADD SKALD AS FIGHTER/MAGE___________________________________________________________
//
LAF check_kit_conflict END

ADD_KIT ~D5_SKALD~

//WEAPON PROFICIENCIES________________________________________________________________
//11           	                        T   S           F   Q             S S
//10           	L S                     W   C           L   U             W I
//9            	A M             B L S   O   I   W       A   A             O N
//8            	R A             A O H   H   M   A       I   R C   S       R G
//7            	G L           M S N O   A   I   R     H L   T R L H     2 D L 2                 E E E E E E E E E E E
//6            	E L       S   I T G R   N K T D H     A M   E O O O     H A E W E E E E E E E E X X X X X X X X X X X
//5            	S S   S B P   S A S T   D A A A A   S L O   R S N R   S A N W E X X X X X X X X T T T T T T T T T T T
//4            	W W   P L I   S R W S   E T R G M C P B R M S S G T D L N D E A T T T T T T T T R R R R R R R R R R R
//3            	O O B E U K A I D O W A D A W G M L E E N A T B B B A I D S A P R R R R R R R R A A A A A A A A A A A
//2            	R R O A N E X L S R O X S N A E E U A R I C A O O O R N E H P O A A A A A A A A 1 1 1 1 1 1 1 1 1 1 2
//1            	D D W R T D E E W D R E W A K R R B R D N E F W W W T G D I O N 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0
~D5_SKALD       2 2 2 2 2 2 2 2~
~D5_SKALD       0 0 0 0 0 0 0 0 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~

//MINIMUM KIT STATS_________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_SKALD          12  0   0   9   0   12~

//KIT STAT MODIFIERS________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_SKALD          0   0   0   0   0   0~

//REQUIREMENTS TO DUAL TO THIS KIT__________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_SKALD          17  0   0   0   0   17~

//REQUIREMENTS TO DUAL FROM THIS KIT________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_SKALD  	       15  0   0   0   0   15~

//ALIGNMENT RESTRICTIONS____________________________________________________________
//                 LG LN LE NG TN NE CG CN CE
~D5_SKALD          1  1  1  1  1  1  1  1  1~

//DUAL CLASS OPTIONS________________________________________________________________
//                 FT CL MA TH DR RA
~D5_SKALD          1  0  0  0  0  0~

//KIT ABILITIES 2DA FILE____________________________________________________________
~might_and_guile/nubards/d5_skld.2da~

//RACIAL KIT AVAILABILITY___________________________________________________________
~K_FM_D K_FM_H K_FM_HE~

//UNUSABLE FLAGS AND KIT BASE CLASS_________________________________________________
//CLASSES: Mage = 1, Fighter = 2, Cleric=3, Thief = 4, Bard = 5
//         Paladin 6, Druid = 11, Ranger = 12, Sorcerer = 19
//         Monk = 20, FM = 7, FC = 8, FT = 9, MT = 13, CM = 14, CT = 15, CR = 18
~0x00800200 7~

//HIGH LEVEL ABILITIES ABBREVIATION_________________________________________________
~D5BRD~

//TOB STARTING EQUIPMENT_____________________________________________________________
~LEAT14	* HELM07 BAG25 RING06 RING31 CLCK02 BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 BOW18 SW1H39 STAF08~

//CHARACTER CREATION KIT DESCRIPTION_________________________________________________
SAY @40816
SAY @40817
SAY @40818

//EE KIT EXTRAS______________________________________________________________________
// 
ACTION_IF GAME_IS ~bgee bg2ee eet iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@40818)
		STR_VAR
			kit_name = D5_SKALD
			clswpbon = ~1 0 3~
			hpclass = ~HPFT~
			clsrcreq = ~1 1 1 0 0 0 0~
	END
END

//SKALD ABILITY FILES________________________________________________________________
//
COPY ~might_and_guile/nubards/d5_skld.2da~ ~override~

//WILD TALENT_________________________________________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~d5__psionics.d5~) BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5_skld.2da~) BEGIN
	APPEND ~d5_skld.2da~ ~WILD_TLNT   AP_D5PSWT_  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
  END
END

// get kit identifier, add to bards list______________________________________________
//
OUTER_SET nu_skald_code = (0x4000 + %D5_SKALD%)
OUTER_SPRINT $bard_kits_list(~d5_skld~ ~%nu_skald_code%~) ~W~
//____________________________________________________________________________________


//ADD GALLANT AS FIGHTER/MAGE________________________________________________________
//
LAF check_kit_conflict END

ADD_KIT ~D5_GALLANT~

//WEAPON PROFICIENCIES_______________________________________________________________
//11           	                        T   S           F   Q             S S
//10           	L S                     W   C           L   U             W I
//9            	A M             B L S   O   I   W       A   A             O N
//8            	R A             A O H   H   M   A       I   R C   S       R G
//7            	G L           M S N O   A   I   R     H L   T R L H     2 D L 2                 E E E E E E E E E E E
//6            	E L       S   I T G R   N K T D H     A M   E O O O     H A E W E E E E E E E E X X X X X X X X X X X
//5            	S S   S B P   S A S T   D A A A A   S L O   R S N R   S A N W E X X X X X X X X T T T T T T T T T T T
//4            	W W   P L I   S R W S   E T R G M C P B R M S S G T D L N D E A T T T T T T T T R R R R R R R R R R R
//3            	O O B E U K A I D O W A D A W G M L E E N A T B B B A I D S A P R R R R R R R R A A A A A A A A A A A
//2            	R R O A N E X L S R O X S N A E E U A R I C A O O O R N E H P O A A A A A A A A 1 1 1 1 1 1 1 1 1 1 2
//1            	D D W R T D E E W D R E W A K R R B R D N E F W W W T G D I O N 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0
~D5_GALLANT     2 2 2 2 2 2 2 2~
~D5_GALLANT     0 0 0 0 0 0 0 0 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~

//MINIMUM KIT STATS_________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_GALLANT        0   0   12  0   0   15~

//KIT STAT MODIFIERS________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_GALLANT        0   0   0   0   0   0~

//REQUIREMENTS TO DUAL TO THIS KIT__________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_GALLANT        0   0   17  0   0   17~

//REQUIREMENTS TO DUAL FROM THIS KIT________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_GALLANT    	   0   0   15  0   0   15~

//ALIGNMENT RESTRICTIONS____________________________________________________________
//                 LG LN LE NG TN NE CG CN CE
~D5_GALLANT        1  1  0  1  1  0  1  1  0~

//DUAL CLASS OPTIONS________________________________________________________________
//                 FT CL MA TH DR RA
~D5_GALLANT        1  0  0  0  0  0~

//KIT ABILITIES 2DA FILE____________________________________________________________
~might_and_guile/nubards/d5_glnt.2da~

//RACIAL KIT AVAILABILITY___________________________________________________________
~K_FM_E K_FM_H K_FM_HE~

//UNUSABLE FLAGS AND KIT BASE CLASS_________________________________________________
//CLASSES: Mage = 1, Fighter = 2, Cleric=3, Thief = 4, Bard = 5
//         Paladin 6, Druid = 11, Ranger = 12, Sorcerer = 19
//         Monk = 20
~0x00800200 7~

//HIGH LEVEL ABILITIES ABBREVIATION_________________________________________________
~D5BRD~

//TOB STARTING EQUIPMENT____________________________________________________________
~LEAT14	* HELM07 BAG25 RING06 RING31 CLCK02 BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 BOW18 SW1H39 STAF08~

//CHARACTER CREATION KIT DESCRIPTION________________________________________________
SAY @40821
SAY @40822
SAY @40823

//EE KIT EXTRAS_____________________________________________________________________
// 
ACTION_IF GAME_IS ~bgee bg2ee eet iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@40823)
		STR_VAR
			kit_name = D5_GALLANT 
			clswpbon = ~1 0 3~
			hpclass = ~HPFT~
			clsrcreq = ~1 1 1 0 0 0 0~
	END
END

//GALLANT ABILITY FILES______________________________________________________________
//
COPY ~might_and_guile/nubards/d5_glnt.2da~ ~override~
COPY ~might_and_guile/misc/d5dsvbo.spl~ ~override~
COPY_EXISTING ~sppr409.spl~ ~override/d5galdw.spl~
	LPM spell_to_innate

//WILD TALENT_________________________________________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~d5__psionics.d5~) BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5_glnt.2da~) BEGIN
	APPEND ~d5_glnt.2da~ ~WILD_TLNT   AP_D5PSWT_  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
  END
END

// get kit identifier, add to bards list______________________________________________
//
OUTER_SET nu_gallant_code = (0x4000 + %D5_GALLANT%)
OUTER_SPRINT $bard_kits_list(~d5_glnt~ ~%nu_gallant_code%~) ~W~
//____________________________________________________________________________________


//ADD MEISTERSINGER AS MAGE/THIEF____________________________________________________
//
LAF check_kit_conflict END

ADD_KIT ~D5_MEISTER~

//WEAPON PROFICIENCIES_______________________________________________________________
//11                                   T   S           F   Q             S S
//10           L S                     W   C           L   U             W I
//9            A M             B L S   O   I   W       A   A             O N
//8            R A             A O H   H   M   A       I   R C   S       R G
//7            G L           M S N O   A   I   R     H L   T R L H     2 D L 2                 E E E E E E E E E E E
//6            E L       S   I T G R   N K T D H     A M   E O O O     H A E W E E E E E E E E X X X X X X X X X X X
//5            S S   S B P   S A S T   D A A A A   S L O   R S N R   S A N W E X X X X X X X X T T T T T T T T T T T
//4            W W   P L I   S R W S   E T R G M C P B R M S S G T D L N D E A T T T T T T T T R R R R R R R R R R R
//3            O O B E U K A I D O W A D A W G M L E E N A T B B B A I D S A P R R R R R R R R A A A A A A A A A A A
//2            R R O A N E X L S R O X S N A E E U A R I C A O O O R N E H P O A A A A A A A A 1 1 1 1 1 1 1 1 1 1 2
//1            D D W R T D E E W D R E W A K R R B R D N E F W W W T G D I O N 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0
~D5_MEISTER    0 1 1 0 1 0 1 1~
~D5_MEISTER    0 0 0 0 0 0 0 0 0 1 1 1 0 0 1 1 1 1 1 0 1 1 1 1 1 1 1 1 1 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~

//MINIMUM KIT STATS__________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_MEISTER         0   12  0   9   9   12~

//KIT STAT MODIFIERS_________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_MEISTER         0   0   0   0   0   0~

//REQUIREMENTS TO DUAL TO THIS KIT___________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_MEISTER         0   17  0   0   17  17~

//REQUIREMENTS TO DUAL FROM THIS KIT_________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_MEISTER         0   15  0   0   17  15~

//ALIGNMENT RESTRICTIONS_____________________________________________________________
//                 LG LN LE NG TN NE CG CN CE
~D5_MEISTER         0  0  0  1  1  1  1  1  1~

//DUAL CLASS OPTIONS_________________________________________________________________
//                 FT CL MA TH DR RA
~D5_MEISTER         0  0  0  1  0  0~

//KIT ABILITIES 2DA FILE_____________________________________________________________
~might_and_guile/nubards/d5_mstr.2da~

//RACIAL KIT AVAILABILITY____________________________________________________________
~K_MT_H K_MT_E K_MT_HE K_MT_HL K_MT_G~

//UNUSABLE FLAGS AND KIT BASE CLASS__________________________________________________
//CLASSES: Mage = 1, Fighter = 2, Cleric=3, Thief = 4, Bard = 5
//         Paladin 6, Druid = 11, Ranger = 12, Sorcerer = 19
//         Monk = 20
~0x00800200 13~

//HIGH LEVEL ABILITIES ABBREVIATION__________________________________________________
~D5BRD~

//TOB STARTING EQUIPMENT_____________________________________________________________
~LEAT14	* HELM07 BAG25 RING06 RING31 CLCK02 BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 BOW18 SW1H39 STAF08~

//CHARACTER CREATION KIT DESCRIPTION_________________________________________________
SAY @40831
SAY @40832
SAY @40833

//EE KIT EXTRAS______________________________________________________________________
// 
ACTION_IF GAME_IS ~bgee bg2ee eet iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@40833)
		STR_VAR
			kit_name = D5_MEISTER
			clswpbon = ~0 0 3~
			sneakatt = ~1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1~
			backstab = ~1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1~
			thiefskl = ~25 15~
			thiefscl = ~0 0 100 100 100 100 0 0~
			clsrcreq = ~1 1 1 0 1 1 0~
	END
END

//MEISTERSINGER ABILITY FILES________________________________________________________
//
COPY ~might_and_guile/nubards/d5_mstr.2da~ ~override~
COPY ~might_and_guile/nubards/d5meis1.bam~ ~override~
COPY ~might_and_guile/misc/d5_base.spl~ ~override/d5meis1.spl~
  LPF ALTER_SPELL_HEADER INT_VAR target = 5 STR_VAR icon = ~d5meis1~ END
  LPF ADD_SPELL_EFFECT INT_VAR opcode = 67 target = 1 parameter2 = 2 timing = 0 duration = 30 probability1 = 100 STR_VAR resource = ~d5ratsu~ END
  LPF ADD_SPELL_EFFECT INT_VAR opcode = 67 target = 1 parameter2 = 2 timing = 0 duration = 30 probability1 = 85 STR_VAR resource = ~d5ratsu~ END
  LPF ADD_SPELL_EFFECT INT_VAR opcode = 67 target = 1 parameter2 = 2 timing = 0 duration = 30 probability1 = 70 STR_VAR resource = ~d5ratsu~ END
  LPF ADD_SPELL_EFFECT INT_VAR opcode = 67 target = 1 parameter2 = 2 timing = 0 duration = 30 probability1 = 55 STR_VAR resource = ~d5ratsu~ END
  LPF ADD_SPELL_EFFECT INT_VAR opcode = 67 target = 1 parameter2 = 2 timing = 0 duration = 30 probability1 = 40 STR_VAR resource = ~d5ratsu~ END
  LPF ADD_SPELL_EFFECT INT_VAR opcode = 67 target = 1 parameter2 = 2 timing = 0 duration = 30 probability1 = 25 STR_VAR resource = ~d5ratsu~ END
COPY ~might_and_guile/nubards/d5ratsu.cre~ ~override~
  WRITE_BYTE 0x275 0

//WILD TALENT_________________________________________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~d5__psionics.d5~) BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5_mstr.2da~) BEGIN
	APPEND ~d5_mstr.2da~ ~WILD_TLNT   AP_D5PSWT_  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
  END
END

// get kit identifier, add to bards list______________________________________________
//
OUTER_SET nu_meister_code = (0x4000 + %D5_MEISTER%)
OUTER_SPRINT $bard_kits_list(~d5_mstr~ ~%nu_meister_code%~) ~W~
//____________________________________________________________________________________


//ADD JINXER AS MAGE/THIEF____________________________________________________________
//
LAF check_kit_conflict END

ADD_KIT ~D5_JINXER~

//WEAPON PROFICIENCIES________________________________________________________________
//11                                   T   S           F   Q             S S
//10           L S                     W   C           L   U             W I
//9            A M             B L S   O   I   W       A   A             O N
//8            R A             A O H   H   M   A       I   R C   S       R G
//7            G L           M S N O   A   I   R     H L   T R L H     2 D L 2                 E E E E E E E E E E E
//6            E L       S   I T G R   N K T D H     A M   E O O O     H A E W E E E E E E E E X X X X X X X X X X X
//5            S S   S B P   S A S T   D A A A A   S L O   R S N R   S A N W E X X X X X X X X T T T T T T T T T T T
//4            W W   P L I   S R W S   E T R G M C P B R M S S G T D L N D E A T T T T T T T T R R R R R R R R R R R
//3            O O B E U K A I D O W A D A W G M L E E N A T B B B A I D S A P R R R R R R R R A A A A A A A A A A A
//2            R R O A N E X L S R O X S N A E E U A R I C A O O O R N E H P O A A A A A A A A 1 1 1 1 1 1 1 1 1 1 2
//1            D D W R T D E E W D R E W A K R R B R D N E F W W W T G D I O N 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0
~D5_JINXER     0 0 0 0 0 0 0 0~
~D5_JINXER     0 0 0 0 0 0 0 0 0 1 1 1 0 1 1 1 1 1 0 0 0 1 1 1 0 1 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~

//MINIMUM KIT STATS__________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_JINXER          0   12  0   12  0   12~

//KIT STAT MODIFIERS_________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_JINXER          0   0   0   0   0   0~

//REQUIREMENTS TO DUAL TO THIS KIT___________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_JINXER          0   17  0   17  0   17~

//REQUIREMENTS TO DUAL FROM THIS KIT_________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_JINXER          0   15  0   15  0   15~

//ALIGNMENT RESTRICTIONS_____________________________________________________________
//                 LG LN LE NG TN NE CG CN CE
~D5_JINXER          0  0  0  1  1  1  1  1  1~

//DUAL CLASS OPTIONS_________________________________________________________________
//                 FT CL MA TH DR RA
~D5_JINXER          0  0  0  1  0  0~

//KIT ABILITIES 2DA FILE_____________________________________________________________
~might_and_guile/nubards/d5_jinx.2da~

//RACIAL KIT AVAILABILITY____________________________________________________________
~K_MT_H K_MT_E K_MT_HE K_MT_HL K_MT_G~

//UNUSABLE FLAGS AND KIT BASE CLASS__________________________________________________
//CLASSES: Mage = 1, Fighter = 2, Cleric=3, Thief = 4, Bard = 5
//         Paladin 6, Druid = 11, Ranger = 12, Sorcerer = 19
//         Monk = 20
~0x00800200 13~

//HIGH LEVEL ABILITIES ABBREVIATION__________________________________________________
~D5BRD~

//TOB STARTING EQUIPMENT_____________________________________________________________
~LEAT14	* HELM07 BAG25 RING06 RING31 CLCK02 BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 BOW18 SW1H39 STAF08~

//CHARACTER CREATION KIT DESCRIPTION_________________________________________________
SAY @40836
SAY @40837
SAY @40838

//EE KIT EXTRAS______________________________________________________________________
// 
ACTION_IF GAME_IS ~bgee bg2ee eet iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@40838)
		STR_VAR
			kit_name = D5_JINXER
			sneakatt = ~1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2~
			backstab = ~1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2~
			clswpbon = ~0 0 3~
			thiefskl = ~30 20~
			thiefscl = ~100 100 100 100 100 100 0 0~
			clsrcreq = ~1 1 1 0 1 0 0~
	END
END

//JINXER ABILITY FILES________________________________________________________________
//
COPY ~might_and_guile/nubards/d5_jinx.2da~ ~override~

//WILD TALENT_________________________________________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~d5__psionics.d5~) BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5_jinx.2da~) BEGIN
	APPEND ~d5_jinx.2da~ ~WILD_TLNT   AP_D5PSWT_  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
  END
END

// get kit identifier, add to bards list______________________________________________
//
OUTER_SET nu_jinxer_code = (0x4000 + %D5_JINXER%)
OUTER_SPRINT $bard_kits_list(~d5_jinx~ ~%nu_jinxer_code%~) ~W~
//____________________________________________________________________________________


//ADD ELEGIST AS MAGE/THIEF____________________________________________________________
//
LAF check_kit_conflict END

ADD_KIT ~D5_ELEGIST~

//WEAPON PROFICIENCIES________________________________________________________________
//11                                   T   S           F   Q             S S
//10           L S                     W   C           L   U             W I
//9            A M             B L S   O   I   W       A   A             O N
//8            R A             A O H   H   M   A       I   R C   S       R G
//7            G L           M S N O   A   I   R     H L   T R L H     2 D L 2                 E E E E E E E E E E E
//6            E L       S   I T G R   N K T D H     A M   E O O O     H A E W E E E E E E E E X X X X X X X X X X X
//5            S S   S B P   S A S T   D A A A A   S L O   R S N R   S A N W E X X X X X X X X T T T T T T T T T T T
//4            W W   P L I   S R W S   E T R G M C P B R M S S G T D L N D E A T T T T T T T T R R R R R R R R R R R
//3            O O B E U K A I D O W A D A W G M L E E N A T B B B A I D S A P R R R R R R R R A A A A A A A A A A A
//2            R R O A N E X L S R O X S N A E E U A R I C A O O O R N E H P O A A A A A A A A 1 1 1 1 1 1 1 1 1 1 2
//1            D D W R T D E E W D R E W A K R R B R D N E F W W W T G D I O N 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0
~D5_ELEGIST    0 0 0 0 0 0 0 0~
~D5_ELEGIST    0 0 0 0 0 0 0 0 0 1 1 1 0 1 1 1 1 1 0 0 0 1 1 1 0 1 1 1 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~

//MINIMUM KIT STATS__________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_ELEGIST         0   12  0   12  0   12~

//KIT STAT MODIFIERS_________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_ELEGIST         0   0   0   0   0   0~

//REQUIREMENTS TO DUAL TO THIS KIT___________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_ELEGIST         0   17  0   17  0   17~

//REQUIREMENTS TO DUAL FROM THIS KIT_________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_ELEGIST         0   15  0   15  0   15~

//ALIGNMENT RESTRICTIONS_____________________________________________________________
//                 LG LN LE NG TN NE CG CN CE
~D5_ELEGIST         0  0  0  1  1  1  1  1  1~

//DUAL CLASS OPTIONS_________________________________________________________________
//                 FT CL MA TH DR RA
~D5_ELEGIST         0  0  0  1  0  0~

//KIT ABILITIES 2DA FILE_____________________________________________________________
~might_and_guile/nubards/d5_eleg.2da~

//RACIAL KIT AVAILABILITY____________________________________________________________
~K_MT_H K_MT_E K_MT_HE K_MT_HL K_MT_G~

//UNUSABLE FLAGS AND KIT BASE CLASS__________________________________________________
//CLASSES: Mage = 1, Fighter = 2, Cleric=3, Thief = 4, Bard = 5
//         Paladin 6, Druid = 11, Ranger = 12, Sorcerer = 19
//         Monk = 20
~0x00009000 13~

//HIGH LEVEL ABILITIES ABBREVIATION__________________________________________________
~D5BRD~

//TOB STARTING EQUIPMENT_____________________________________________________________
~LEAT14	* HELM07 BAG25 RING06 RING31 CLCK02 BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 BOW18 SW1H39 STAF08~

//CHARACTER CREATION KIT DESCRIPTION_________________________________________________
SAY @40841
SAY @40842
SAY @40843

//EE KIT EXTRAS______________________________________________________________________
// 
ACTION_IF GAME_IS ~bgee bg2ee eet iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@40843)
		STR_VAR
			kit_name = D5_ELEGIST
			sneakatt = ~1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2~
			backstab = ~1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2~
			clswpbon = ~0 0 3~
			thiefskl = ~30 20~
			thiefscl = ~100 100 100 100 100 100 0 0~
			clsrcreq = ~1 1 1 0 1 0 0~
	END
END

//ELEGIST ABILITY FILES________________________________________________________________
//
COPY ~might_and_guile/nubards/d5_eleg.2da~ ~override~

//WILD TALENT_________________________________________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~d5__psionics.d5~) BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5_eleg.2da~) BEGIN
	APPEND ~d5_eleg.2da~ ~WILD_TLNT   AP_D5PSWT_  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
  END
END

// get kit identifier, add to bards list______________________________________________
//
OUTER_SET nu_elegist_code = (0x4000 + %D5_ELEGIST%)
OUTER_SPRINT $bard_kits_list(~d5_eleg~ ~%nu_elegist_code%~) ~W~
//___________________________________________________________________________________


//ADD AGENT AS FIGHTER/MAGE/THIEF_____________________________________________________
//
LAF check_kit_conflict END

ADD_KIT ~D5_AGENT~

//WEAPON PROFICIENCIES________________________________________________________________
//11                                   T   S           F   Q             S S
//10           L S                     W   C           L   U             W I
//9            A M             B L S   O   I   W       A   A             O N
//8            R A             A O H   H   M   A       I   R C   S       R G
//7            G L           M S N O   A   I   R     H L   T R L H     2 D L 2                 E E E E E E E E E E E
//6            E L       S   I T G R   N K T D H     A M   E O O O     H A E W E E E E E E E E X X X X X X X X X X X
//5            S S   S B P   S A S T   D A A A A   S L O   R S N R   S A N W E X X X X X X X X T T T T T T T T T T T
//4            W W   P L I   S R W S   E T R G M C P B R M S S G T D L N D E A T T T T T T T T R R R R R R R R R R R
//3            O O B E U K A I D O W A D A W G M L E E N A T B B B A I D S A P R R R R R R R R A A A A A A A A A A A
//2            R R O A N E X L S R O X S N A E E U A R I C A O O O R N E H P O A A A A A A A A 1 1 1 1 1 1 1 1 1 1 2
//1            D D W R T D E E W D R E W A K R R B R D N E F W W W T G D I O N 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0
~D5_AGENT      0 0 0 0 0 0 0 0~
~D5_AGENT      0 0 0 0 0 0 0 0 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~

//MINIMUM KIT STATS__________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_AGENT           0   12  0   12  0   12~

//KIT STAT MODIFIERS_________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_AGENT           0   0   0   0   0   0~

//REQUIREMENTS TO DUAL TO THIS KIT___________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_AGENT           0   17  0   17  0   17~

//REQUIREMENTS TO DUAL FROM THIS KIT_________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_AGENT           0   15  0   15  0   15~

//ALIGNMENT RESTRICTIONS_____________________________________________________________
//                 LG LN LE NG TN NE CG CN CE
~D5_AGENT           1  1  1  1  1  1  1  1  1~

//DUAL CLASS OPTIONS_________________________________________________________________
//                 FT CL MA TH DR RA
~D5_AGENT           0  0  0  0  0  0~

//KIT ABILITIES 2DA FILE_____________________________________________________________
~might_and_guile/nubards/d5_agnt.2da~

//RACIAL KIT AVAILABILITY____________________________________________________________
~K_FMT_H K_FMT_E K_FMT_HE~

//UNUSABLE FLAGS AND KIT BASE CLASS__________________________________________________
//CLASSES: Mage = 1, Fighter = 2, Cleric=3, Thief = 4, Bard = 5
//         Paladin 6, Druid = 11, Ranger = 12, Sorcerer = 19
//         Monk = 20
~0x00800200 10~

//HIGH LEVEL ABILITIES ABBREVIATION__________________________________________________
~D5BRD~

//TOB STARTING EQUIPMENT_____________________________________________________________
~LEAT14	* HELM07 BAG25 RING06 RING31 CLCK02 BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 BOW18 SW1H39 STAF08~

//CHARACTER CREATION KIT DESCRIPTION_________________________________________________
SAY @40851
SAY @40852
SAY @40853

//EE KIT EXTRAS______________________________________________________________________
// 
ACTION_IF GAME_IS ~bgee bg2ee eet iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@40838)
		STR_VAR
			kit_name = D5_AGENT
			sneakatt = ~1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2~
			backstab = ~1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2~
			clswpbon = ~0 0 3~
			thiefskl = ~30 20~
			thiefscl = ~100 100 100 100 100 100 0 0~
			clsrcreq = ~1 1 1 0 1 0 0~
	END
END

//AGENT ABILITY FILES_________________________________________________________________
//
COPY ~might_and_guile/nubards/d5_agnt.2da~ ~override~

//WILD TALENT_________________________________________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~d5__psionics.d5~) BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5_agnt.2da~) BEGIN
	APPEND ~d5_agnt.2da~ ~WILD_TLNT   AP_D5PSWT_  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
  END
END

// get kit identifier, add to bards list______________________________________________
//
OUTER_SET nu_agent_code = (0x4000 + %D5_AGENT%)
OUTER_SPRINT $bard_kits_list(~d5_agnt~ ~%nu_agent_code%~) ~T~

OUTER_SET nu_agent_code = (0x4000 + %D5_AGENT%)
//____________________________________________________________________________________


//ADD HEXBLADE AS F/M________________________________________________________________
//
LAF check_kit_conflict END

ADD_KIT ~D5_HEXBLADE~

//WEAPON PROFICIENCIES________________________________________________________________
//11           	                        T   S           F   Q             S S
//10           	L S                     W   C           L   U             W I
//9            	A M             B L S   O   I   W       A   A             O N
//8            	R A             A O H   H   M   A       I   R C   S       R G
//7            	G L           M S N O   A   I   R     H L   T R L H     2 D L 2                 E E E E E E E E E E E
//6            	E L       S   I T G R   N K T D H     A M   E O O O     H A E W E E E E E E E E X X X X X X X X X X X
//5            	S S   S B P   S A S T   D A A A A   S L O   R S N R   S A N W E X X X X X X X X T T T T T T T T T T T
//4            	W W   P L I   S R W S   E T R G M C P B R M S S G T D L N D E A T T T T T T T T R R R R R R R R R R R
//3            	O O B E U K A I D O W A D A W G M L E E N A T B B B A I D S A P R R R R R R R R A A A A A A A A A A A
//2            	R R O A N E X L S R O X S N A E E U A R I C A O O O R N E H P O A A A A A A A A 1 1 1 1 1 1 1 1 1 1 2
//1            	D D W R T D E E W D R E W A K R R B R D N E F W W W T G D I O N 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0
~D5_HEXBLADE    0 0 0 0 0 0 0 0~
~D5_HEXBLADE    0 0 0 0 0 0 0 0 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 0 2 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~

//MINIMUM KIT STATS_________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_HEXBLADE       9   0   0   9   0   12~

//KIT STAT MODIFIERS________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_HEXBLADE       0   0   0   0   0   0~

//REQUIREMENTS TO DUAL TO THIS KIT__________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_HEXBLADE       15  0   0   0   0   15~

//REQUIREMENTS TO DUAL FROM THIS KIT________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_HEXBLADE  	   15  0   0   0   0   15~

//ALIGNMENT RESTRICTIONS____________________________________________________________
//                 LG LN LE NG TN NE CG CN CE
~D5_HEXBLADE       0  0  0  1  1  1  1  1  1~

//DUAL CLASS OPTIONS________________________________________________________________
//                 FT CL MA TH DR RA
~D5_HEXBLADE       1  0  0  0  0  0~

//KIT ABILITIES 2DA FILE____________________________________________________________
~might_and_guile/nubards/d5_hxbl.2da~

//RACIAL KIT AVAILABILITY___________________________________________________________
~K_FM_H K_FM_HE~

//UNUSABLE FLAGS AND KIT BASE CLASS_________________________________________________
//CLASSES: Mage = 1, Fighter = 2, Cleric=3, Thief = 4, Bard = 5
//         Paladin 6, Druid = 11, Ranger = 12, Sorcerer = 19
//         Monk = 20
~0x00800200 7~

//HIGH LEVEL ABILITIES ABBREVIATION_________________________________________________
~D5BRD~

//TOB STARTING EQUIPMENT_____________________________________________________________
~LEAT14	* HELM07 BAG25 RING06 RING31 CLCK02 BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 BOW18 SW1H39 STAF08~

//CHARACTER CREATION KIT DESCRIPTION_________________________________________________
SAY @40846
SAY @40847
SAY @40848

//EE KIT EXTRAS______________________________________________________________________
// 
ACTION_IF GAME_IS ~bgee bg2ee eet iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@40848)
		STR_VAR
			kit_name = D5_HEXBLADE
			clswpbon = ~1 0 3~
			hpclass = ~HPFT~
	END
END

//HEXBLADE ABILITY FILES_____________________________________________________________
//
COPY ~might_and_guile/nubards/d5_hxbl.2da~ ~override~

//WILD TALENT_________________________________________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~d5__psionics.d5~) BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5_hxbl.2da~) BEGIN
	APPEND ~d5_hxbl.2da~ ~WILD_TLNT   AP_D5PSWT_  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
  END
END

// get kit identifier, add to bards list______________________________________________
//
OUTER_SET nu_hexblade_code = (0x4000 + %D5_HEXBLADE%)
OUTER_SPRINT $bard_kits_list(~d5_hxbl~ ~%nu_hexblade_code%~) ~W~
//____________________________________________________________________________________


//ADD HERALD AS FIGHTER/THIEF________________________________________________________
//
LAF check_kit_conflict END

ADD_KIT ~D5_HERALD~

//WEAPON PROFICIENCIES_______________________________________________________________
//11                                   T   S           F   Q             S S
//10           L S                     W   C           L   U             W I
//9            A M             B L S   O   I   W       A   A             O N
//8            R A             A O H   H   M   A       I   R C   S       R G
//7            G L           M S N O   A   I   R     H L   T R L H     2 D L 2                 E E E E E E E E E E E
//6            E L       S   I T G R   N K T D H     A M   E O O O     H A E W E E E E E E E E X X X X X X X X X X X
//5            S S   S B P   S A S T   D A A A A   S L O   R S N R   S A N W E X X X X X X X X T T T T T T T T T T T
//4            W W   P L I   S R W S   E T R G M C P B R M S S G T D L N D E A T T T T T T T T R R R R R R R R R R R
//3            O O B E U K A I D O W A D A W G M L E E N A T B B B A I D S A P R R R R R R R R A A A A A A A A A A A
//2            R R O A N E X L S R O X S N A E E U A R I C A O O O R N E H P O A A A A A A A A 1 1 1 1 1 1 1 1 1 1 2
//1            D D W R T D E E W D R E W A K R R B R D N E F W W W T G D I O N 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0
~D5_HERALD     2 2 2 2 2 2 2 2~
~D5_HERALD     0 0 0 0 0 0 0 0 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~

//MINIMUM KIT STATS__________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_HERALD         9   9  0   12  0   12~

//KIT STAT MODIFIERS_________________________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_HERALD         0   0   0   0   0   0~

//REQUIREMENTS TO DUAL TO THIS KIT___________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_HERALD         0   17  0   17  0   17~

//REQUIREMENTS TO DUAL FROM THIS KIT_________________________________________________
//                 STR DEX CON INT WIS CHR
~D5_HERALD         0   15  0   15  0   15~

//ALIGNMENT RESTRICTIONS_____________________________________________________________
//                 LG LN LE NG TN NE CG CN CE
~D5_HERALD         1  1  1  1  1  1  0  0  0~

//DUAL CLASS OPTIONS_________________________________________________________________
//                 FT CL MA TH DR RA
~D5_HERALD         1  0  0  1  0  0~

//KIT ABILITIES 2DA FILE_____________________________________________________________
~might_and_guile/nubards/d5_hrld.2da~

//RACIAL KIT AVAILABILITY____________________________________________________________
~K_FT_D K_FT_E K_FT_H K_FT_HE K_FT_G K_FT_HL K_FT_HO~

//UNUSABLE FLAGS AND KIT BASE CLASS__________________________________________________
//CLASSES: Mage = 1, Fighter = 2, Cleric=3, Thief = 4, Bard = 5
//         Paladin 6, Druid = 11, Ranger = 12, Sorcerer = 19
//         Monk = 20, FT = 9, FC = 8, CT = 15, CR = 18, FM = 7, CM = 14, MT = 13
~0x00004000 9~

//HIGH LEVEL ABILITIES ABBREVIATION__________________________________________________
~FT0~

//TOB STARTING EQUIPMENT_____________________________________________________________
~LEAT14	* HELM07 BAG25 RING06 RING31 CLCK02 BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 BOW18 SW1H39 STAF08~

//CHARACTER CREATION KIT DESCRIPTION_________________________________________________
SAY @40826
SAY @40827
SAY @40828

//EE KIT EXTRAS______________________________________________________________________
// 
ACTION_IF GAME_IS ~bgee bg2ee eet iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@40828)
		STR_VAR
			kit_name = D5_HERALD
			clswpbon = ~1 0 3~
			hpclass = ~HPFT~
			clsrcreq = ~1 1 1 0 0 0 0~
			sneakatt = ~1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2~
			backstab = ~1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2~
			thiefskl = ~40 20~
			thiefscl = ~100 100 100 100 100 100 0 0~
	END
END

//HERALD ABILITY FILES_______________________________________________________________
//
COPY ~might_and_guile/nubards/d5_hrld.2da~ ~override~

//WILD TALENT_________________________________________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~d5__psionics.d5~) BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5_hrld.2da~) BEGIN
	APPEND ~d5_hrld.2da~ ~WILD_TLNT   AP_D5PSWT_  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
  END
END

// get kit identifier, add to bards list______________________________________________
//
OUTER_SET nu_herald_code = (0x4000 + %D5_HERALD%)
OUTER_SPRINT $bard_kits_list(~d5_hrld~ ~%nu_herald_code%~) ~T~
//____________________________________________________________________________________


//ADD BLADESINGER AS F/M______________________________________________________________
//
LAF check_kit_conflict END

ADD_KIT ~D5_BLADESINGER~

//WEAPON PROFICIENCIES________________________________________________________________
//11            	                        T   S           F   Q             S S
//10            	L S                     W   C           L   U             W I
//9             	A M             B L S   O   I   W       A   A             O N
//8             	R A             A O H   H   M   A       I   R C   S       R G
//7             	G L           M S N O   A   I   R     H L   T R L H     2 D L 2                 E E E E E E E E E E E
//6             	E L       S   I T G R   N K T D H     A M   E O O O     H A E W E E E E E E E E X X X X X X X X X X X
//5             	S S   S B P   S A S T   D A A A A   S L O   R S N R   S A N W E X X X X X X X X T T T T T T T T T T T
//4             	W W   P L I   S R W S   E T R G M C P B R M S S G T D L N D E A T T T T T T T T R R R R R R R R R R R
//3             	O O B E U K A I D O W A D A W G M L E E N A T B B B A I D S A P R R R R R R R R A A A A A A A A A A A
//2             	R R O A N E X L S R O X S N A E E U A R I C A O O O R N E H P O A A A A A A A A 1 1 1 1 1 1 1 1 1 1 2
//1             	D D W R T D E E W D R E W A K R R B R D N E F W W W T G D I O N 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0
~D5_BLADESINGER     0 0 0 0 0 0 0 0~
~D5_BLADESINGER     0 0 0 0 0 0 0 0 2 2 2 2 0 2 2 2 2 2 2 2 2 2 2 0 0 0 0 0 2 0 2 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~

//MINIMUM KIT STATS_________________________________________________________________
//                  STR DEX CON INT WIS CHR
~D5_BLADESINGER     9   12  0   12  0   12~

//KIT STAT MODIFIERS________________________________________________________________
//                  STR DEX CON INT WIS CHR
~D5_BLADESINGER     0   0   0   0   0   0~

//REQUIREMENTS TO DUAL TO THIS KIT__________________________________________________
//                  STR DEX CON INT WIS CHR
~D5_BLADESINGER     0   17  0   17  0   17~

//REQUIREMENTS TO DUAL FROM THIS KIT________________________________________________
//                  STR DEX CON INT WIS CHR
~D5_BLADESINGER     0   15  0   15  0   15~

//ALIGNMENT RESTRICTIONS____________________________________________________________
//                  LG LN LE NG TN NE CG CN CE
~D5_BLADESINGER     1  1  1  1  1  1  0  0  0~

//DUAL CLASS OPTIONS________________________________________________________________
//                  FT CL MA TH DR RA
~D5_BLADESINGER     1  0  0  0  0  0~

//KIT ABILITIES 2DA FILE____________________________________________________________
~might_and_guile/nubards/d5_blads.2da~

//RACIAL KIT AVAILABILITY___________________________________________________________
~K_FM_E~

//UNUSABLE FLAGS AND KIT BASE CLASS_________________________________________________
//CLASSES: Mage = 1, Fighter = 2, Cleric=3, Thief = 4, Bard = 5
//         Paladin 6, Druid = 11, Ranger = 12, Sorcerer = 19
//         Monk = 20
~0x00004000 7~

//HIGH LEVEL ABILITIES ABBREVIATION_________________________________________________
~D5BRD~

//TOB STARTING EQUIPMENT_____________________________________________________________
~LEAT14	* HELM07 BAG25 RING06 RING31 CLCK02 BOOT01 AMUL19 BRAC16 BELT06 AROW11,40 BULL03,40 BOLT06,40 POTN52,5 POTN04,2 POTN14,5 BOW18 SW1H39 STAF08~

//CHARACTER CREATION KIT DESCRIPTION_________________________________________________
SAY @40856
SAY @40857
SAY @40858

//EE KIT EXTRAS______________________________________________________________________
// 
ACTION_IF GAME_IS ~bgee bg2ee eet iwdee~ THEN BEGIN
	LAF fl#add_kit_ee
		INT_VAR
			briefdesc = RESOLVE_STR_REF (@40858)
		STR_VAR
			kit_name = D5_BLADESINGER
			clswpbon = ~1 0 3~
			hpclass = ~HPFT~
	END
END

//BLADESINGER ABILITY FILES__________________________________________________________
//
COPY ~might_and_guile/nubards/d5_blads.2da~ ~override~

// imp. alacrity must cancel bladesong
COPY_EXISTING ~spwi921.spl~ ~override~
  LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd51b~ END
  LPF CLONE_EFFECT INT_VAR match_opcode = 188 opcode = 206 parameter1 = 0 parameter2 = (0 - 1) STR_VAR resource = ~d5bd51b~ END
IF_EXISTS BUT_ONLY

//WILD TALENT_________________________________________________________________________
//
ACTION_IF (FILE_EXISTS_IN_GAME ~d5__psionics.d5~) BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5_blads.2da~) BEGIN
	APPEND ~d5_blads.2da~ ~WILD_TLNT   AP_D5PSWT_  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
  END
END

// get kit identifier, add to bards list______________________________________________
//
OUTER_SET nu_bladesinger_code = (0x4000 + %D5_BLADESINGER%)
OUTER_SPRINT $bard_kits_list(~d5_blads~ ~%nu_bladesinger_code%~) ~W~
//____________________________________________________________________________________


// bladesinger weapon focus gives APR_________________________________________________
//
// patch all weapons to have 177 targeting bladesinger
COPY_EXISTING_REGEXP GLOB ~^.+\.itm$~ ~override~
  PATCH_IF (SOURCE_SIZE > 0x71) BEGIN
	READ_BYTE 0x31 proficiency
	PATCH_IF (proficiency = 89) BEGIN
	  LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 parameter1 = %nu_bladesinger_code% parameter2 = 9 timing = 2 STR_VAR resource = ~d5bs89b~ END
	END
	PATCH_IF (proficiency = 90) BEGIN
	  LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 parameter1 = %nu_bladesinger_code% parameter2 = 9 timing = 2 STR_VAR resource = ~d5bs90b~ END
	END
	PATCH_IF (proficiency = 91) BEGIN
	  LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 parameter1 = %nu_bladesinger_code% parameter2 = 9 timing = 2 STR_VAR resource = ~d5bs91b~ END
	END
	PATCH_IF (proficiency = 92) BEGIN
	  LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 parameter1 = %nu_bladesinger_code% parameter2 = 9 timing = 2 STR_VAR resource = ~d5bs92b~ END
	END
	PATCH_IF (proficiency = 93) BEGIN
	  LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 parameter1 = %nu_bladesinger_code% parameter2 = 9 timing = 2 STR_VAR resource = ~d5bs93b~ END
	END
	PATCH_IF (proficiency = 94) BEGIN
	  LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 parameter1 = %nu_bladesinger_code% parameter2 = 9 timing = 2 STR_VAR resource = ~d5bs94b~ END
	END
	PATCH_IF (proficiency = 95) BEGIN
	  LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 parameter1 = %nu_bladesinger_code% parameter2 = 9 timing = 2 STR_VAR resource = ~d5bs95b~ END
	END
	PATCH_IF (proficiency = 96) BEGIN
	  LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 parameter1 = %nu_bladesinger_code% parameter2 = 9 timing = 2 STR_VAR resource = ~d5bs96b~ END
	END
	PATCH_IF (proficiency = 97) BEGIN
	  LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 parameter1 = %nu_bladesinger_code% parameter2 = 9 timing = 2 STR_VAR resource = ~d5bs97b~ END
	END
	PATCH_IF (proficiency = 98) BEGIN
	  LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 parameter1 = %nu_bladesinger_code% parameter2 = 9 timing = 2 STR_VAR resource = ~d5bs98b~ END
	END
	PATCH_IF (proficiency = 99) BEGIN
	  LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 parameter1 = %nu_bladesinger_code% parameter2 = 9 timing = 2 STR_VAR resource = ~d5bs99b~ END
	END
	PATCH_IF (proficiency = 100) BEGIN
	  LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 parameter1 = %nu_bladesinger_code% parameter2 = 9 timing = 2 STR_VAR resource = ~d5bs100b~ END
	END
	PATCH_IF (proficiency = 101) BEGIN
	  LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 parameter1 = %nu_bladesinger_code% parameter2 = 9 timing = 2 STR_VAR resource = ~d5bs101b~ END
	END
	PATCH_IF (proficiency = 102) BEGIN
	  LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 parameter1 = %nu_bladesinger_code% parameter2 = 9 timing = 2 STR_VAR resource = ~d5bs102b~ END
	END
	PATCH_IF (proficiency = 115) BEGIN
	  LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 parameter1 = %nu_bladesinger_code% parameter2 = 9 timing = 2 STR_VAR resource = ~d5bs115b~ END
	END
  END
BUT_ONLY

// make EFFs giving extra APR
ACTION_FOR_EACH prof IN ~89~ ~90~ ~91~ ~92~ ~93~ ~94~ ~95~ ~96~ ~97~ ~98~ ~99~ ~100~ ~101~ ~102~ ~115~ BEGIN
  OUTER_TEXT_SPRINT this_prof ~%prof%~
  CREATE EFF ~d5%prof%b~
	WRITE_LONG 0x10 1
	WRITE_LONG 0x14 1
	WRITE_LONG 0x1c 6
	WRITE_LONG 0x20 0
	WRITE_LONG 0x24 2
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5%this_prof%B~ #8
END

// make spells with 206 against those EFFs
ACTION_FOR_EACH 206_prof IN ~89~ ~90~ ~91~ ~92~ ~93~ ~94~ ~95~ ~96~ ~97~ ~98~ ~99~ ~100~ ~101~ ~102~ ~115~ BEGIN
  COPY ~might_and_guile/misc/d5_base.spl~ ~override/D5BS%206_prof%6.spl~
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = EVAL ~D5BS%206_prof%B~ END
  BUT_ONLY
END

// have weapon focus spells cancel those 206 spells
ACTION_FOR_EACH spec IN ~1~ ~2~ ~3~ ~4~ ~5~ ~6~ BEGIN
  ACTION_FOR_EACH foc_prof IN ~89~ ~90~ ~91~ ~92~ ~93~ ~94~ ~95~ ~96~ ~97~ ~98~ ~99~ ~100~ ~101~ ~102~ ~115~ BEGIN
	COPY_EXISTING ~d5%spec%B%foc_prof%.spl~ ~override~
	  LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = EVAL ~D5BS%foc_prof%6~ END
	IF_EXISTS BUT_ONLY
  END
END

// make spell to cast those 206 spells
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bs206.spl~
  PATCH_FOR_EACH 146_prof IN ~89~ ~90~ ~91~ ~92~ ~93~ ~94~ ~95~ ~96~ ~97~ ~98~ ~99~ ~100~ ~101~ ~102~ ~115~ BEGIN
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter2 = 1 timing = 1 STR_VAR resource = EVAL ~D5BS%146_prof%6~ END
  END
BUT_ONLY

INCLUDE ~%MOD_FOLDER%/lib/dialprof.tpa~

OUTER_SPRINT prof_script_name ~d5bsfo~
OUTER_SET script_level_one = 0
OUTER_SET script_higher_levels = 0
OUTER_SPRINT class_dlgs ~fi_ma~

LAM PROF_DIALOGUE

COPY_EXISTING ~d5_blads.2da~ ~override~
	REPLACE_TEXTUALLY ~GA_D5BSWPF~ ~GA_D5BSFOA~
	REPLACE_TEXTUALLY ~GA_D5FTPRX~ ~GA_D5BSFOA~
BUT_ONLY

COPY ~might_and_guile/feats/d5_rfe9b.bam~ ~override~

COPY_EXISTING ~d5bsfoa.spl~ ~override~
	SAY NAME1 @20496
	SAY UNIDENTIFIED_DESC @20497
	WRITE_ASCII 0x3a ~d5_rfe9~ #8
	LPF ALTER_SPELL_HEADER STR_VAR icon = ~d5_rfe9~ END

//___________________________________________________________________________________


//ARCHERS USE ELVEN CHAIN____________________________________________________________
//
ACTION_IF NOT FILE_EXISTS_IN_GAME ~d5__echan.d5~ BEGIN
  INCLUDE ~might_and_guile/lib/elven_chain.tpa~
END
//___________________________________________________________________________________


// splprot kit check__________________________________________________________________
//
APPEND ~splprot.2da~ ~D5_KIT_IS%TAB%152%TAB%-1%TAB%1~ UNLESS ~D5_KIT_IS~
COPY_EXISTING ~splprot.2da~ ~override~
	COUNT_2DA_COLS cols
	READ_2DA_ENTRIES_NOW rows cols
	FOR (row = 1; row < rows; ++row) BEGIN
	  READ_2DA_ENTRY_FORMER rows row 0 ~stat~
	  PATCH_IF ~%stat%~ STRING_EQUAL_CASE ~D5_KIT_IS~ BEGIN
	    SET kit_is_row = %row%
	  END
	END
BUT_ONLY
//___________________________________________________________________________________


// item usability_____________________________________________________________________
//
// ***** this will mess up all C/Ts and F/Ts... and F/Cs 
// need to do new one for C/T
// and run the ...nuse spells through 177
// NOTE: 180 effects like this this do not play nice with FnP

COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bdnuse.spl~
  LPF ADD_SPELL_EFFECT INT_VAR opcode = 326 target = 1 parameter1 = 7 parameter2 = 105 timing = 9 STR_VAR resource = ~d5fmnuse~ END
  LPF ADD_SPELL_EFFECT INT_VAR opcode = 326 target = 1 parameter1 = 13 parameter2 = 105 timing = 9 STR_VAR resource = ~d5mtnuse~ END
//  LPF ADD_SPELL_EFFECT INT_VAR opcode = 326 target = 1 parameter1 = 15 parameter2 = 105 timing = 9 STR_VAR resource = ~d5ctnuse~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5fmnuse.spl~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5mtnuse.spl~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ctnuse.spl~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bnuse.spl~

COPY_EXISTING_REGEXP GLOB ~^.+\.itm$~ ~override~
  READ_SHORT 0x1c item_type
  READ_BYTE 0x1e bard_use
  READ_BYTE 0x1f f_c_use
  READ_BYTE 0x20 m_t_use
//  PATCH_IF NOT (item_type = 11) && NOT (item_type = 35) BEGIN
	PATCH_IF ((%bard_use% BOR 0b10111111) = 0b10111110) && ((%f_c_use% BAND 0b00100000) = 0b00100000) BEGIN 	// if usable by bards but not by F/M...
	  WRITE_BYTE 0x1f (THIS BAND 0b11011111)						// make usable by fighter/mages
	  SPRINT item_res ~%SOURCE_RES%~
	  INNER_ACTION BEGIN
		COPY_EXISTING ~d5fmnuse.spl~ ~override~
		  LPF ADD_SPELL_EFFECT INT_VAR opcode = 180 target = 1 parameter1 = (0 - 1) parameter2 = 0 timing = 9 STR_VAR resource = EVAL ~%item_res%~ END
		BUT_ONLY
	  END
	END
	PATCH_IF ((%bard_use% BOR 0b10111111) = 0b10111111) && ((%m_t_use% BAND 0b00001000) = 0b00001000) BEGIN 	// if usable by bards but not by M/T...
	  WRITE_BYTE 0x20 (THIS BAND 0b11110110)						// make usable by mage/thieves
	  SPRINT item_res ~%SOURCE_RES%~
	  INNER_ACTION BEGIN
		COPY_EXISTING ~d5mtnuse.spl~ ~override~
		  LPF ADD_SPELL_EFFECT INT_VAR opcode = 180 target = 1 parameter1 = (0 - 1) parameter2 = 0 timing = 9 STR_VAR resource = EVAL ~%item_res%~ END
		BUT_ONLY
	  END
	END
	PATCH_IF ((%bard_use% BOR 0b10111111) = 0b10111111) && ((%f_c_use% BAND 0b00000010) = 0b00000010) BEGIN 	// if usable by bards but not by C/T...
	  WRITE_BYTE 0x1f (THIS BAND 0b11011111)						// make usable by fighter/mages
	  SPRINT item_res ~%SOURCE_RES%~
	  INNER_ACTION BEGIN
		COPY_EXISTING ~d5ctnuse.spl~ ~override~
		  LPF ADD_SPELL_EFFECT INT_VAR opcode = 180 target = 1 parameter1 = (0 - 1) parameter2 = 0 timing = 9 STR_VAR resource = EVAL ~%item_res%~ END
		BUT_ONLY
	  END
	END
	PATCH_IF ((%bard_use% BAND 0b01000000) = 0b01000000) && ((%f_c_use% BOR 0b11011111) = 0b11011111) && ((%m_t_use% BOR 0b11110111) = 0b11110111) BEGIN 	// if usable by F/M + M/T but not by bards...
	  SPRINT item_res ~%SOURCE_RES%~
	  INNER_ACTION BEGIN
		COPY_EXISTING ~d5bnuse.spl~ ~override~
		  LPF ADD_SPELL_EFFECT INT_VAR opcode = 180 target = 1 parameter1 = (0 - 1) parameter2 = 0 timing = 9 STR_VAR resource = EVAL ~%item_res%~ END
		BUT_ONLY
	  END
	END
//  END
BUT_ONLY

ACTION_FOR_EACH usability_spell IN ~d5fmnuse~ ~d5mtnuse~ ~d5ctnuse~ BEGIN
  COPY_EXISTING  ~%usability_spell%.spl~ ~override~
// ***** bards list
  	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 321 target = 1 timing = 1 STR_VAR resource = EVAL ~%usability_spell%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = %nu_bard_code% parameter2 = %kit_is_row% timing = 9 STR_VAR resource = EVAL ~%usability_spell%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = %nu_blade_code% parameter2 = %kit_is_row% timing = 9 STR_VAR resource = EVAL ~%usability_spell%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = %nu_jester_code% parameter2 = %kit_is_row% timing = 9 STR_VAR resource = EVAL ~%usability_spell%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = %nu_skald_code% parameter2 = %kit_is_row% timing = 9 STR_VAR resource = EVAL ~%usability_spell%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = %nu_gallant_code% parameter2 = %kit_is_row% timing = 9 STR_VAR resource = EVAL ~%usability_spell%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = %nu_herald_code% parameter2 = %kit_is_row% timing = 9 STR_VAR resource = EVAL ~%usability_spell%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = %nu_meister_code% parameter2 = %kit_is_row% timing = 9 STR_VAR resource = EVAL ~%usability_spell%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = %nu_jinxer_code% parameter2 = %kit_is_row% timing = 9 STR_VAR resource = EVAL ~%usability_spell%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = %nu_elegist_code% parameter2 = %kit_is_row% timing = 9 STR_VAR resource = EVAL ~%usability_spell%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = %nu_agent_code% parameter2 = %kit_is_row% timing = 9 STR_VAR resource = EVAL ~%usability_spell%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = %nu_hexblade_code% parameter2 = %kit_is_row% timing = 9 STR_VAR resource = EVAL ~%usability_spell%~ END
//	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = %nu_loresinger_code% parameter2 = %kit_is_row% timing = 9 STR_VAR resource = EVAL ~%usability_spell%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = %nu_bladesinger_code% parameter2 = %kit_is_row% timing = 9 STR_VAR resource = EVAL ~%usability_spell%~ END
END

APPEND ~clabfi01.2da~ ~BARD_USE    AP_D5BDNUSE ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
APPEND ~clabth01.2da~ ~BARD_USE    AP_D5BDNUSE ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
//APPEND ~clabth01.2da~ ~BARD_USE    AP_D5CTNUSE ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~

/* don't need to do this since only worried about multiclasses (for now?)
COPY_EXISTING ~kitlist.2da~ ~override~
  COUNT_2DA_ROWS ~9~ "rows"
  FOR ( index = 2 ; index < rows ; index = index + 1 ) BEGIN
	READ_2DA_ENTRY %index% 5 9 modclab
	READ_2DA_ENTRY %index% 8 9 modclass
	DEFINE_ASSOCIATIVE_ARRAY d5_180_array BEGIN "%modclab%" => "%modclass%" END
  END
BUT_ONLY

// ***** use bard_kits_list vv
ACTION_PHP_EACH d5_180_array AS bo => zo BEGIN
// omit bard kits
  ACTION_IF (%zo% = 4) && FILE_EXISTS_IN_GAME ~%bo%.2da~ && NOT (~%bo%~ STRING_EQUAL_CASE ~d5_bard~) && NOT (~%bo%~ STRING_EQUAL_CASE ~d5_blade~) && NOT (~%bo%~ STRING_EQUAL_CASE ~d5_jstr~) && NOT (~%bo%~ STRING_EQUAL_CASE ~d5_skld~) && NOT (~%bo%~ STRING_EQUAL_CASE ~d5_glnt~) && NOT (~%bo%~ STRING_EQUAL_CASE ~d5_hrld~) && NOT (~%bo%~ STRING_EQUAL_CASE ~d5_mstr~) && NOT (~%bo%~ STRING_EQUAL_CASE ~d5_jinx~) && NOT (~%bo%~ STRING_EQUAL_CASE ~d5_eleg~) && NOT (~%bo%~ STRING_EQUAL_CASE ~d5_hxbl~) && NOT (~%bo%~ STRING_EQUAL_CASE ~d5_agnt~) BEGIN
	APPEND ~%bo%.2da~ ~BARD_USE    AP_D5TNUSE  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
  END
END
*/
//____________________________________________________________________________________


// fix UAI_____________________________________________________________________________
//
// if UAI is in the game, have it 321 d5mtnuse and d5fmnuse 
ACTION_IF FILE_EXISTS_IN_GAME ~spcl915.spl~ BEGIN
  COPY_EXISTING ~spcl915.spl~ ~override~
  	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5mtnuse~ END
  	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5fmnuse~ END
END
//____________________________________________________________________________________


// define spell access________________________________________________________________
//
// restrict access to schools of... necromancy, evocation, wild magic
// ...and restrict all 8th/9th level spells
// ...and also restrict sequencers and contingency (unless TnB option #5)
// need kits to have the usability flag for both a specialist kit and the skald kit
// spells just need to be restricted from skalds

COPY_EXISTING_REGEXP GLOB ~^.+\.spl$~ ~override~
  READ_SHORT 0x1c spell_type
  PATCH_IF spell_type = 1 BEGIN
	READ_BYTE 0x25 spell_school
	READ_LONG 0x34 spell_level
	READ_BYTE 0x20 bard_excludes
	PATCH_IF spell_school = 7 	OR 		//	necromancy
			spell_school = 6 	OR 		//	invocation
//			spell_school = 2 	OR 		//	conjuration
			spell_school = 9 	OR		//	wild magic
//			spell_level = 8 	OR
			spell_level = 9 	BEGIN
	  WRITE_BYTE 0x20 (%bard_excludes% BOR ~0b10000000~) 		// unusable by skalds
	END
  END
BUT_ONLY

COPY_EXISTING_REGEXP GLOB ~^.+\.spl$~ ~override~
  READ_SHORT 0x1c spell_type
  PATCH_IF spell_type = 1 BEGIN
	READ_BYTE 0x25 spell_school
	READ_LONG 0x34 spell_level
	READ_BYTE 0x20 bard_excludes
	PATCH_IF (d5_bards_5E_casting = 1) AND !(MOD_IS_INSTALLED ~TomeAndBlood.tp2~ ~55~) BEGIN
	  PATCH_IF  ~%SOURCE_RES%~ STRING_EQUAL_CASE ~spwi420~	OR		// minor sequencer
				~%SOURCE_RES%~ STRING_EQUAL_CASE ~spwi710~	OR 		// sequencer
				~%SOURCE_RES%~ STRING_EQUAL_CASE ~spwi617~	BEGIN 	// contingency
		WRITE_BYTE 0x20 (%bard_excludes% BOR ~0b10000000~)  		// unusable by skalds
	  END
	END
	PATCH_IF (d5_bards_5E_casting = 1) AND !(MOD_IS_INSTALLED ~TomeAndBlood.tp2~ ~16~) BEGIN
	  PATCH_IF ~%SOURCE_RES%~ STRING_EQUAL_CASE ~spwi110~ 	BEGIN	// identify
		WRITE_BYTE 0x20 (%bard_excludes% BOR ~0b10000000~)  		// unusable by skalds
	  END
	END
  END
BUT_ONLY

// ***** need to shift the base skald to trueclass usability... I guess?  Maybe not.  Who cares?
COPY_EXISTING ~kitlist.2da~ ~override~
  READ_2DA_ENTRIES_NOW r2en_kitlist 9
  FOR (row = 2; row < r2en_kitlist; ++row) BEGIN
	READ_2DA_ENTRY_FORMER r2en_kitlist row 1 kit_name
	PATCH_IF (~%kit_name%~ STRING_EQUAL_CASE ~SKALD~) BEGIN
	  SET_2DA_ENTRY row 7 9 ~0x00004000~
	END
  END
IF_EXISTS BUT_ONLY

// use the, uh... archer kit for elegists
COPY_EXISTING_REGEXP GLOB ~^.+\.spl$~ ~override~
  READ_SHORT 0x1c spell_type
  PATCH_IF spell_type = 1 BEGIN
	READ_BYTE 0x25 spell_school
	READ_LONG 0x34 spell_level
	READ_BYTE 0x1f bard_excludes
	PATCH_IF spell_school = 5 	OR 		//	illusion
			spell_school = 6 	OR 		//	invocation
//			spell_school = 2 	OR 		//	conjuration
			spell_school = 9 	OR		//	wild magic
			spell_level = 8 	OR
			spell_level = 9 	BEGIN
//	  WRITE_BYTE 0x1f (%bard_excludes% BOR ~0b10000000~) 		// unusable by archers
	  WRITE_BYTE 0x1f (THIS BOR ~0b10000000~) 					// is there a better way to do this...?
	END
  END
BUT_ONLY

// ***** use a different flag than archer, if archer can be made into a fighter kit
COPY_EXISTING_REGEXP GLOB ~^.+\.spl$~ ~override~
  READ_SHORT 0x1c spell_type
  PATCH_IF spell_type = 1 BEGIN
	READ_BYTE 0x25 spell_school
	READ_LONG 0x34 spell_level
	READ_BYTE 0x1f bard_excludes
	PATCH_IF (d5_bards_5E_casting = 1) AND !(MOD_IS_INSTALLED ~TomeAndBlood.tp2~ ~55~) BEGIN
	  PATCH_IF  ~%SOURCE_RES%~ STRING_EQUAL_CASE ~spwi420~	OR		// minor sequencer
				~%SOURCE_RES%~ STRING_EQUAL_CASE ~spwi710~	OR 		// sequencer
				~%SOURCE_RES%~ STRING_EQUAL_CASE ~spwi617~	BEGIN 	// contingency
		WRITE_BYTE 0x1f (%bard_excludes% BOR ~0b10000000~)  		// unusable by archers
	  END
	END
	PATCH_IF (d5_bards_5E_casting = 1) AND !(MOD_IS_INSTALLED ~TomeAndBlood.tp2~ ~16~) BEGIN
	  PATCH_IF ~%SOURCE_RES%~ STRING_EQUAL_CASE ~spwi110~ 	BEGIN	// identify
		WRITE_BYTE 0x1f (%bard_excludes% BOR ~0b10000000~)  		// unusable by archers
	  END
	END
  END
BUT_ONLY


// make .2da file for shared effects__________________________________________________
//
//COPY ~might_and_guile/nubards/d5_bard.2da~ ~override/d5nubard.2da~
<<<<<<<< d5/d5nubard.2da

NU_BARDS    AP_D5_1HP   AP_D5_1HP   AP_D5_1HP   AP_D5_1HP   AP_D5_1HP   AP_D5_1HP   AP_D5_1HP   AP_D5_1HP   AP_D5_1HP   AP_D5_1HP   ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** 

>>>>>>>> 
COPY ~d5/d5nubard.2da~ ~override/d5nubard.2da~


// immunity to backstab bonus_________________________________________________________
//
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5nbstb.spl~
  LPF ADD_SPELL_EFFECT INT_VAR opcode = 101 target = 1 parameter2 = 263 END

APPEND ~d5nubard.2da~ ~NOBKSTAB    AP_D5NBSTB  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~


//ARMORED CASTING FOR BARDS__________________________________________________________
//
// ***** NOTE: this is not currently compatible with broader armored casting mods
// ...well, it is now compatible with YARAS
/*
INCLUDE ~%MOD_FOLDER%/lib/d5_armored_casting.tpa~

LAM D5_ARMORED_CASTING

APPEND ~d5nubard.2da~ ~ARMOR_CAST  AP_D5ARCA1  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
*/

/*
CREATE EFF ~d5bncast~										// 	disable casting button
	WRITE_LONG 0x10 144
	WRITE_LONG 0x14 1
	WRITE_LONG 0x20 2
	WRITE_LONG 0x24 2
	WRITE_SHORT 0x2c 100

COPY_EXISTING_REGEXP GLOB ~^.+\.itm$~ ~override~
  PATCH_IF (SOURCE_SIZE > 0x71) BEGIN
	READ_SHORT 0x1c type
	READ_LONG 0x22 appearance
	PATCH_IF (type = 2) BEGIN 								// armor
	  PATCH_IF (appearance = 16691) BEGIN 					// chain appearance
		PATCH_IF !(FILE_EXISTS_IN_GAME ~d5__armcast.d5~) BEGIN
		  PHP_EACH bard_kits_list AS clab => kind BEGIN
		    PATCH_IF (~%kind%~ STRING_EQUAL_CASE ~w~) BEGIN
		      LPF CLONE_EFFECT INT_VAR silent = 1 multi_match = 1 match_opcode = 145 opcode = 177 parameter1 = %clab_1% parameter2 = 9 STR_VAR resource = ~d5bncast~ END
		    END
		  END
		END
		PATCH_IF (FILE_EXISTS_IN_GAME ~d5__armcast.d5~) BEGIN
		  PHP_EACH bard_kits_list AS clab => kind BEGIN
		    PATCH_IF (~%kind%~ STRING_EQUAL_CASE ~w~) BEGIN
		      LPF CLONE_EFFECT INT_VAR silent = 1 multi_match = 1 match_opcode = 177 opcode = 177 parameter1 = %clab_1% parameter2 = 9 STR_VAR match_resource = ~d5arcac~ resource = ~d5bncast~ END
		    END
		  END
		END
	  END
	  PATCH_IF (appearance = 16692) BEGIN 					// plate appearance
		PATCH_IF !(FILE_EXISTS_IN_GAME ~d5__armcast.d5~) BEGIN
		  PHP_EACH bard_kits_list AS clab => kind BEGIN
		    PATCH_IF (~%kind%~ STRING_EQUAL_CASE ~w~) BEGIN
		      LPF CLONE_EFFECT INT_VAR silent = 1 multi_match = 1 match_opcode = 145 opcode = 177 parameter1 = %clab_1% parameter2 = 9 STR_VAR resource = ~d5bncast~ END
		    END
		  END
		END
		PATCH_IF (FILE_EXISTS_IN_GAME ~d5__armcast.d5~) BEGIN
		  PHP_EACH bard_kits_list AS clab => kind BEGIN
		    PATCH_IF (~%kind%~ STRING_EQUAL_CASE ~w~) BEGIN
		      LPF CLONE_EFFECT INT_VAR silent = 1 multi_match = 1 match_opcode = 177 opcode = 177 parameter1 = %clab_1% parameter2 = 9 STR_VAR match_resource = ~d5arcap~ resource = ~d5bncast~ END
		    END
		  END
		END
	  END
	END
  END
BUT_ONLY
*/

// I think this vv is all it needs, now...?
//APPEND ~d5nubard.2da~ ~CAST_LEAT   AP_D5ZBARM  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~

// nope, just this
//ACTION_IF (FILE_EXISTS_IN_GAME ~d5__semi_spont.d5~) BEGIN
 COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5zblar.spl~
    LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5zw172l~ END
    LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5zarml~ END
    LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5zarm1l~ END
    LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5zarm2l~ END

 APPEND ~d5nubard.2da~ ~BARD_CAST   AP_D5ZBLAR  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****       ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****  ~ UNLESS ~D5ZBLAR~
//END
//___________________________________________________________________________________


//INSTALL NEW BARD AURAS_____________________________________________________________
//
// set these up as innate abilities. 
// need 206 spells for each, and an overarching 206 spell to apply them
// and learn spells to cancel the 206 spells
// and a 'stop song' ability
// 'stop song' has 171 effects for every song
// every song activation has 172 effects for every song

//bard inspirations___________________________________________________________________
//
COPY ~might_and_guile/nubards/d5_bd01b.bam~ ~override~			//		song icon
COPY ~might_and_guile/nubards/d5bd01a.spl~ ~override~			//		luck inspiration
	SAY NAME1 @40011
	SAY UNIDENTIFIED_DESC @40012
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd01b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 4096 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd01b.eff~ ~override~			//		232 eff triggered by song
COPY ~might_and_guile/nubards/d5bd01b.spl~ ~override~			//		aura triggered by 232 eff
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub01.spl~	//		learn song
	SAY NAME1 @40011
	SAY UNIDENTIFIED_DESC @40012
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 2
	END ELSE BEGIN
	  WRITE_LONG 0x34 1
	END
	WRITE_ASCII 0x3a ~d5_bd01b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd01b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd01z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd01z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 2 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD01Y~ END
// 146 to cast new spell
// new spell removes all songs and gives all songs
// all songs, while in effect, should protect from new spell (in 'a' spells?)
//	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
//	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd01z.spl~	//		206 vs. give song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd01z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD01Y~ END
CREATE EFF ~d5bd01y~											// 		give song
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd01a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD01Y~ #8
COPY_EXISTING ~d5ub01.spl~ ~override/d5vb01.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~01~) ~I~

COPY ~might_and_guile/nubards/d5_bd02b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd02a.spl~ ~override~			//		courage inspiration
	SAY NAME1 @40021
	SAY UNIDENTIFIED_DESC @40022
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd02b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd02b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd02b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub02.spl~
	SAY NAME1 @40021
	SAY UNIDENTIFIED_DESC @40022
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 2
	END ELSE BEGIN
	  WRITE_LONG 0x34 1
	END
	WRITE_ASCII 0x3a ~d5_bd02b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd02b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd02z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd02z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD02Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd02z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd02z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD02Y~ END
CREATE EFF ~d5bd02y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd02a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD02Y~ #8
COPY_EXISTING ~d5ub02.spl~ ~override/d5vb02.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~02~) ~I~

COPY ~might_and_guile/nubards/d5_bd03b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd03a.spl~ ~override~			//		power inspiration
	SAY NAME1 @40031
	SAY UNIDENTIFIED_DESC @40032
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd03b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd03b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd03b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub03.spl~
	SAY NAME1 @40031
	SAY UNIDENTIFIED_DESC @40032
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 2
	END ELSE BEGIN
	  WRITE_LONG 0x34 1
	END
	WRITE_ASCII 0x3a ~d5_bd03b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd03b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd03z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd03z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD03Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd03z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd03z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD03Y~ END
CREATE EFF ~d5bd03y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd03a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD03Y~ #8
COPY_EXISTING ~d5ub03.spl~ ~override/d5vb03.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~03~) ~I~

COPY ~might_and_guile/nubards/d5_bd05b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd05a.spl~ ~override~			//		RI inspiration
	SAY NAME1 @40051
	SAY UNIDENTIFIED_DESC @40052
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd05b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd05b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd05b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub05.spl~
	SAY NAME1 @40051
	SAY UNIDENTIFIED_DESC @40052
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 4
	END ELSE BEGIN
	  WRITE_LONG 0x34 2
	END
	WRITE_ASCII 0x3a ~d5_bd05b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd05b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd05z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd05z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD05Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd05z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd05z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD05Y~ END
CREATE EFF ~d5bd05y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd05a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD05Y~ #8
COPY_EXISTING ~d5ub05.spl~ ~override/d5vb05.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~05~) ~I~

COPY ~might_and_guile/nubards/d5_bd06b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd06a.spl~ ~override~			//		bless inspiration
	SAY NAME1 @40061
	SAY UNIDENTIFIED_DESC @40062
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd06b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd06b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd06b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub06.spl~
	SAY NAME1 @40061
	SAY UNIDENTIFIED_DESC @40062
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 2
	END ELSE BEGIN
	  WRITE_LONG 0x34 1
	END
	WRITE_ASCII 0x3a ~d5_bd06b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd06b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd06z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd06z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD06Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd06z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd06z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD06Y~ END
CREATE EFF ~d5bd06y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd06a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD06Y~ #8
COPY_EXISTING ~d5ub06.spl~ ~override/d5vb06.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~06~) ~I~

COPY ~might_and_guile/nubards/d5_bd07b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd07a.spl~ ~override~			//		NPP inspiration
	SAY NAME1 @40071
	SAY UNIDENTIFIED_DESC @40072
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd07b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd07b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd07b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub07.spl~
	SAY NAME1 @40071
	SAY UNIDENTIFIED_DESC @40072
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 2
	END ELSE BEGIN
	  WRITE_LONG 0x34 1
	END
	WRITE_ASCII 0x3a ~d5_bd07b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd07b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd07z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd07z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD07Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd07z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd07z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD07Y~ END
CREATE EFF ~d5bd07y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd07a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD07Y~ #8
COPY_EXISTING ~d5ub07.spl~ ~override/d5vb07.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~07~) ~I~

COPY ~might_and_guile/nubards/d5_bd08b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd08a.spl~ ~override~			//		mind shield inspiration
	SAY NAME1 @40081
	SAY UNIDENTIFIED_DESC @40082
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd08b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd08b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd08b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub08.spl~
	SAY NAME1 @40081
	SAY UNIDENTIFIED_DESC @40082
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 4
	END ELSE BEGIN
	  WRITE_LONG 0x34 2
	END
	WRITE_ASCII 0x3a ~d5_bd08b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd08b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd08z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd08z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD08Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd08z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd08z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD08Y~ END
CREATE EFF ~d5bd08y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd08a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD08Y~ #8
COPY_EXISTING ~d5ub08.spl~ ~override/d5vb08.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~08~) ~I~

COPY ~might_and_guile/nubards/d5_bd09b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd09a.spl~ ~override~			//		death ward inspiration
	SAY NAME1 @40091
	SAY UNIDENTIFIED_DESC @40092
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd09b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd09b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd09b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub09.spl~
	SAY NAME1 @40091
	SAY UNIDENTIFIED_DESC @40092
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 4
	END ELSE BEGIN
	  WRITE_LONG 0x34 2
	END
	WRITE_ASCII 0x3a ~d5_bd09b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd09b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd09z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd09z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD09Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd09z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd09z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD09Y~ END
CREATE EFF ~d5bd09y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd09a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD09Y~ #8
COPY_EXISTING ~d5ub09.spl~ ~override/d5vb09.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~09~) ~I~

/*
COPY ~might_and_guile/nubards/d5_bd10b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd10a.spl~ ~override~			//		electric charge inspiration
	SAY NAME1 @40101
	SAY UNIDENTIFIED_DESC @40102
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd10b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd10b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd10b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub10.spl~
	SAY NAME1 @40101
	SAY UNIDENTIFIED_DESC @40102
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 4
	END ELSE BEGIN
	  WRITE_LONG 0x34 2
	END
	WRITE_ASCII 0x3a ~d5_bd10b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd10b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd10z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd10z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD10Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd10z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd10z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD10Y~ END
CREATE EFF ~d5bd10y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd10a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD10Y~ #8
COPY_EXISTING ~d5ub10.spl~ ~override/d5vb10.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~10~) ~I~
*/

COPY ~might_and_guile/nubards/d5_bd20b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd20a.spl~ ~override~			//		casting interference emanation
	SAY NAME1 @40201
	SAY UNIDENTIFIED_DESC @40202
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd20b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd20b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd20b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub20.spl~
	SAY NAME1 @40201
	SAY UNIDENTIFIED_DESC @40202
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 2
	END ELSE BEGIN
	  WRITE_LONG 0x34 1
	END
	WRITE_ASCII 0x3a ~d5_bd20b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd20b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd20z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd20z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD20Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd20z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd20z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD20Y~ END
CREATE EFF ~d5bd20y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd20a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD20Y~ #8
COPY_EXISTING ~d5ub20.spl~ ~override/d5vb20.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~20~) ~E~

COPY ~might_and_guile/nubards/d5_bd21b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd21a.spl~ ~override~			//		combat penalties emanation
	SAY NAME1 @40211
	SAY UNIDENTIFIED_DESC @40212
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd21b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd21b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd21b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub21.spl~
	SAY NAME1 @40211
	SAY UNIDENTIFIED_DESC @40212
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 2
	END ELSE BEGIN
	  WRITE_LONG 0x34 1
	END
	WRITE_ASCII 0x3a ~d5_bd21b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd21b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd21z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd21z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD21Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd21z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd21z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD21Y~ END
CREATE EFF ~d5bd21y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd21a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD21Y~ #8
COPY_EXISTING ~d5ub21.spl~ ~override/d5vb21.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~21~) ~E~

COPY ~might_and_guile/nubards/d5_bd22b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd22a.spl~ ~override~			//		save penalties emanation
	SAY NAME1 @40221
	SAY UNIDENTIFIED_DESC @40222
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd22b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd22b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd22b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub22.spl~
	SAY NAME1 @40221
	SAY UNIDENTIFIED_DESC @40222
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 2
	END ELSE BEGIN
	  WRITE_LONG 0x34 1
	END
	WRITE_ASCII 0x3a ~d5_bd22b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd22b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd22z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd22z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD22Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd22z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd22z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD22Y~ END
CREATE EFF ~d5bd22y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd22a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD22Y~ #8
COPY_EXISTING ~d5ub22.spl~ ~override/d5vb22.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~22~) ~E~

COPY ~might_and_guile/nubards/d5_bd23b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd23a.spl~ ~override~			//		confusion emanation
	SAY NAME1 @40231
	SAY UNIDENTIFIED_DESC @40232
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd23b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd23b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd23b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub23.spl~
	SAY NAME1 @40231
	SAY UNIDENTIFIED_DESC @40232
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 4
	END ELSE BEGIN
	  WRITE_LONG 0x34 2
	END
	WRITE_ASCII 0x3a ~d5_bd23b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd23b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd23z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd23z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD23Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd23z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd23z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD23Y~ END
CREATE EFF ~d5bd23y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd23a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD23Y~ #8
COPY_EXISTING ~d5ub23.spl~ ~override/d5vb23.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~23~) ~E~

COPY ~might_and_guile/nubards/d5_bd24b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd24a.spl~ ~override~			//		hold undead emanation
	SAY NAME1 @40241
	SAY UNIDENTIFIED_DESC @40242
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd24b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd24b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd24b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub24.spl~
	SAY NAME1 @40241
	SAY UNIDENTIFIED_DESC @40242
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 4
	END ELSE BEGIN
	  WRITE_LONG 0x34 2
	END
	WRITE_ASCII 0x3a ~d5_bd24b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd24b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd24z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd24z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD24Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd24z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd24z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD24Y~ END
CREATE EFF ~d5bd24y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd24a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD24Y~ #8
COPY_EXISTING ~d5ub24.spl~ ~override/d5vb24.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~24~) ~E~

COPY ~might_and_guile/nubards/d5_bd25b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd25a.spl~ ~override~			//		entangle emanation
	SAY NAME1 @40251
	SAY UNIDENTIFIED_DESC @40252
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd25b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd25b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd25b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub25.spl~
	SAY NAME1 @40251
	SAY UNIDENTIFIED_DESC @40252
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 2
	END ELSE BEGIN
	  WRITE_LONG 0x34 1
	END
	WRITE_ASCII 0x3a ~d5_bd25b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd25b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd25z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd25z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD25Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd25z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd25z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD25Y~ END
CREATE EFF ~d5bd25y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd25a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD25Y~ #8
COPY_EXISTING ~d5ub25.spl~ ~override/d5vb25.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~25~) ~E~

COPY ~might_and_guile/nubards/d5_bd41b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd41a.spl~ ~override~			//		blur aura
	SAY NAME1 @40411
	SAY UNIDENTIFIED_DESC @40412
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd41b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
//COPY ~might_and_guile/nubards/d5bd41a.eff~ ~override~
COPY ~might_and_guile/nubards/d5bd41b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd41b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub41.spl~
	SAY NAME1 @40411
	SAY UNIDENTIFIED_DESC @40412
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 2
	END ELSE BEGIN
	  WRITE_LONG 0x34 1
	END
	WRITE_ASCII 0x3a ~d5_bd41b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd41b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd41z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd41z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD41Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd41z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd41z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD41Y~ END
CREATE EFF ~d5bd41y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd41a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD41Y~ #8
COPY_EXISTING ~d5ub41.spl~ ~override/d5vb41.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~41~) ~A~

COPY ~might_and_guile/nubards/d5_bd42b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd42a.spl~ ~override~			//		mind blank aura
	SAY NAME1 @40421
	SAY UNIDENTIFIED_DESC @40422
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd42b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd42b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd42b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub42.spl~
	SAY NAME1 @40421
	SAY UNIDENTIFIED_DESC @40422
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 2
	END ELSE BEGIN
	  WRITE_LONG 0x34 1
	END
	WRITE_ASCII 0x3a ~d5_bd42b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd42b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd42z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd42z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD42Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd42z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd42z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD42Y~ END
CREATE EFF ~d5bd42y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd42a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD42Y~ #8
COPY_EXISTING ~d5ub42.spl~ ~override/d5vb42.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~42~) ~A~

COPY ~might_and_guile/nubards/d5_bd43b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd43a.spl~ ~override~			//		MGOI aura
	SAY NAME1 @40431
	SAY UNIDENTIFIED_DESC @40432
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd43b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd43b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd43b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub43.spl~
	SAY NAME1 @40431
	SAY UNIDENTIFIED_DESC @40432
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 4
	END ELSE BEGIN
	  WRITE_LONG 0x34 2
	END
	WRITE_ASCII 0x3a ~d5_bd43b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd43b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd43z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd43z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD43Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd43z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd43z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD43Y~ END
CREATE EFF ~d5bd43y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd43a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD43Y~ #8
COPY_EXISTING ~d5ub43.spl~ ~override/d5vb43.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~43~) ~A~

COPY ~might_and_guile/nubards/d5_bd45b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd45a.spl~ ~override~			//		harmonic strike aura
	SAY NAME1 @40451
	SAY UNIDENTIFIED_DESC @40452
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd45b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
//COPY ~might_and_guile/nubards/d5bd45a.eff~ ~override~
COPY ~might_and_guile/nubards/d5bd45b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd45b.eff~ ~override~
COPY ~might_and_guile/nubards/d5bd45c.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub45.spl~
	SAY NAME1 @40451
	SAY UNIDENTIFIED_DESC @40452
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 2
	END ELSE BEGIN
	  WRITE_LONG 0x34 1
	END
	WRITE_ASCII 0x3a ~d5_bd45b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd45b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd45z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd45z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD45Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd45z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd45z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD45Y~ END
CREATE EFF ~d5bd45y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd45a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD45Y~ #8
COPY_EXISTING ~d5ub45.spl~ ~override/d5vb45.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~45~) ~A~

COPY ~might_and_guile/nubards/d5_bd46b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd46a.spl~ ~override~			//		fear aura
	SAY NAME1 @40461
	SAY UNIDENTIFIED_DESC @40462
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd46b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd46b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd46b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub46.spl~
	SAY NAME1 @40461
	SAY UNIDENTIFIED_DESC @40462
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 4
	END ELSE BEGIN
	  WRITE_LONG 0x34 2
	END
	WRITE_ASCII 0x3a ~d5_bd46b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd46b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd46z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd46z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD46Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd46z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd46z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD46Y~ END
CREATE EFF ~d5bd46y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd46a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD46Y~ #8
COPY_EXISTING ~d5ub46.spl~ ~override/d5vb46.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~46~) ~A~

COPY ~might_and_guile/nubards/d5_bd47b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd47a.spl~ ~override~			//		slow aura
	SAY NAME1 @40471
	SAY UNIDENTIFIED_DESC @40472
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd47b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd47b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd47b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub47.spl~
	SAY NAME1 @40471
	SAY UNIDENTIFIED_DESC @40472
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 4
	END ELSE BEGIN
	  WRITE_LONG 0x34 2
	END
	WRITE_ASCII 0x3a ~d5_bd47b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd47b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd47z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd47z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD47Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd47z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd47z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD47Y~ END
CREATE EFF ~d5bd47y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd47a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD47Y~ #8
COPY_EXISTING ~d5ub47.spl~ ~override/d5vb47.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~47~) ~A~

COPY ~might_and_guile/nubards/d5_bd48b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd48a.spl~ ~override~			//		dispel illusions aura
	SAY NAME1 @40481
	SAY UNIDENTIFIED_DESC @40482
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd48b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd48b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd48b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub48.spl~
	SAY NAME1 @40481
	SAY UNIDENTIFIED_DESC @40482
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 4
	END ELSE BEGIN
	  WRITE_LONG 0x34 2
	END
	WRITE_ASCII 0x3a ~d5_bd48b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd48b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd48z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd48z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD48Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd48z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd48z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD48Y~ END
CREATE EFF ~d5bd48y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd48a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD48Y~ #8
COPY_EXISTING ~d5ub48.spl~ ~override/d5vb48.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~48~) ~A~

COPY ~might_and_guile/nubards/d5_bd49b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd49a.spl~ ~override~			//		hex aura
	SAY NAME1 @40491
	SAY UNIDENTIFIED_DESC @40492
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd49b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd49b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd49b.eff~ ~override~
COPY ~might_and_guile/nubards/d5bd49c.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd49c.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub49.spl~
	SAY NAME1 @40491
	SAY UNIDENTIFIED_DESC @40492
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 4
	END ELSE BEGIN
	  WRITE_LONG 0x34 2
	END
	WRITE_ASCII 0x3a ~d5_bd49b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd49b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd49z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd49z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD49Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd49z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd49z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD49Y~ END
CREATE EFF ~d5bd49y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd49a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD49Y~ #8
COPY_EXISTING ~d5ub49.spl~ ~override/d5vb49.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~49~) ~A~

COPY ~might_and_guile/nubards/d5_bd51b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd51a.spl~ ~override~			//		bladesong
	SAY NAME1 @40511
	SAY UNIDENTIFIED_DESC @40512
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd51b~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
//COPY ~might_and_guile/nubards/d5bd51a.eff~ ~override~
COPY ~might_and_guile/nubards/d5bd51b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd51b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub51.spl~
	SAY NAME1 @40511
	SAY UNIDENTIFIED_DESC @40512
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 4
	END ELSE BEGIN
	  WRITE_LONG 0x34 2
	END
	WRITE_ASCII 0x3a ~d5_bd51b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd51b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd51z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd51z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD51Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd51z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd51z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD51Y~ END
CREATE EFF ~d5bd51y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd51a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD51Y~ #8
COPY_EXISTING ~d5ub51.spl~ ~override/d5vb51.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~51~) ~A~

COPY ~might_and_guile/nubards/d5_bd61b.bam~ ~override~
COPY ~might_and_guile/nubards/d5bd61a.spl~ ~override~			//		maze aura
	SAY NAME1 @40611
	SAY UNIDENTIFIED_DESC @40612
	LPF ALTER_SPELL_HEADER INT_VAR target = 5 location = 4 STR_VAR icon = ~d5_bd61~ END
	WRITE_SHORT 0x1c 4
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 1 STR_VAR resource = ~d5bdyyy~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 0x00001000 parameter2 = 138 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = 38 parameter2 = 110 timing = 0 duration = 1 STR_VAR resource = EVAL ~%SOURCE_RES%~ END
COPY ~might_and_guile/nubards/d5bd61b.spl~ ~override~
COPY ~might_and_guile/nubards/d5bd61b.eff~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5ub61.spl~
	SAY NAME1 @40611
	SAY UNIDENTIFIED_DESC @40612
	WRITE_SHORT 0x1c 2
	PATCH_IF GAME_IS ~iwdee~ BEGIN
	  WRITE_LONG 0x34 4
	END ELSE BEGIN
	  WRITE_LONG 0x34 2
	END
	WRITE_ASCII 0x3a ~d5_bd61b~ #8
	LPF ALTER_SPELL_HEADER INT_VAR location = 4 STR_VAR icon = ~d5_bd61b~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = ~d5bd61z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd61z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter1 = 0 parameter2 = 1 timing = 4 duration = 1 STR_VAR resource = ~d5bdyyy~ END
//	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter2 = 0 parameter2 = 2 timing = 9 STR_VAR resource = ~D5BD61Y~ END
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd61z.spl~	//		206 song
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 1 STR_VAR resource = ~d5bd61z~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~D5BD61Y~ END
CREATE EFF ~d5bd61y~
	WRITE_LONG 0x10 171
	WRITE_LONG 0x14 1
	WRITE_LONG 0x24 9
	WRITE_LONG 0x28 0
	WRITE_SHORT 0x2c 100
	WRITE_EVALUATED_ASCII 0x30 ~d5bd61a~ #8
	WRITE_LONG 0x90 1
	WRITE_EVALUATED_ASCII 0x94 ~D5BD61Y~ #8
COPY_EXISTING ~d5ub61.spl~ ~override/d5vb61.spl~
	WRITE_SHORT 0x1c 1

OUTER_SPRINT $bard_songs_list(~61~) ~A~
//___________________________________________________________________________________


//bard song helper files______________________________________________________________
//
ACTION_PHP_EACH bard_songs_list AS song_a => type_a BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5bd%song_a%a.spl~) BEGIN
    COPY_EXISTING ~d5bd%song_a%a.spl~ ~override~
      PHP_EACH bard_songs_list AS song => type BEGIN
        LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 172 target = 1 timing = 9 STR_VAR resource = EVAL ~d5bd%song%a~ END
      END
    BUT_ONLY
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5ub%song_a%.spl~) BEGIN
    COPY_EXISTING ~d5ub%song_a%.spl~ ~override~
    			  ~d5vb%song_a%.spl~ ~override~
      PHP_EACH bard_songs_list AS song => type BEGIN
        LPF CLONE_EFFECT INT_VAR match_opcode = 146 STR_VAR match_resource = ~d5bdyyy~ resource = EVAL ~d5bd%song%z~ END
      END
    BUT_ONLY
  END
END

COPY ~might_and_guile/nubards/d5bdmusx.bam~ ~override~			//		no song icon
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bdxxx.spl~	//		stop song
  SAY NAME1 @40003
  SAY UNIDENTIFIED_DESC @40003
  LPF ALTER_ITEM_HEADER INT_VAR target = 7 STR_VAR icon = ~d5bdmusx~ END
//  PATCH_FOR_EACH nu_song_a IN ~01a~ ~02a~ ~03a~ ~05a~ ~06a~ ~07a~ ~08a~ ~20a~ ~21a~ ~22a~ ~23a~ ~24a~ ~25a~ ~41a~ ~42a~ ~43a~ ~45a~ ~46a~ ~47a~ ~48a~ ~49a~ ~51a~ ~61a~ BEGIN
  PHP_EACH bard_songs_list AS song => type BEGIN
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 321 target = 1 timing = 9 STR_VAR resource = EVAL ~d5bd%song%a~ END
    LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter2 = 1 timing = 9 STR_VAR resource = EVAL ~d5bd%song%z~ END
  END
//  PATCH_FOR_EACH nu_song_y IN ~01y~ ~02y~ ~03y~ ~05y~ ~06y~ ~07y~ ~08y~ ~20y~ ~21y~ ~22y~ ~23y~ ~24y~ ~25y~ ~41y~ ~42y~ ~43y~ ~45y~ ~46y~ ~47y~ ~48y~ ~49y~ ~51y~ ~61y~ BEGIN
  PHP_EACH bard_songs_list AS song => type BEGIN
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter1 = 0 parameter2 = 2 timing = 9 STR_VAR resource = EVAL ~d5bd%song%y~ END
  END
  LPF ADD_SPELL_EFFECT INT_VAR opcode = 172 target = 1 timing = 9 STR_VAR resource = ~d5bdxxx~ END

COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bdyyy.spl~	//		add new learned songs
//  PATCH_FOR_EACH nu_song IN ~01a~ ~02a~ ~03a~ ~05a~ ~06a~ ~07a~ ~08a~ ~20a~ ~21a~ ~22a~ ~23a~ ~24a~ ~25a~ ~41a~ ~42a~ ~43a~ ~45a~ ~46a~ ~47a~ ~48a~ ~49a~ ~51a~ ~61a~ BEGIN
  PHP_EACH bard_songs_list AS song => type BEGIN
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 172 target = 1 timing = 9 STR_VAR resource = EVAL ~d5bd%song%a~ END
  END
//  PATCH_FOR_EACH nu_song_y IN ~01y~ ~02y~ ~03y~ ~05y~ ~06y~ ~07y~ ~08y~ ~20y~ ~21y~ ~22y~ ~23y~ ~24y~ ~25y~ ~41y~ ~42y~ ~43y~ ~45y~ ~46y~ ~47y~ ~48y~ ~49y~ ~51y~ ~61y~ BEGIN
  PHP_EACH bard_songs_list AS song => type BEGIN
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 target = 1 parameter1 = 0 parameter2 = 2 timing = 9 STR_VAR resource = EVAL ~d5bd%song%y~ END
  END

OUTER_SET spell_op38_ind = 0
OUTER_SPRINT $opcode_38_spells(~%spell_op38_ind%~) ~opcode_38_spell~
COPY_EXISTING_REGEXP GLOB ~^.+\.spl$~ ~override~
  PATCH_IF (%SOURCE_SIZE% > 0x71) BEGIN
  	SET opcode_38 = 0
	READ_BYTE     0x2f current ELSE 0
	READ_BYTE     0x2b current2 ELSE 0
	READ_LONG 0x64 headoffset  ELSE 0
	READ_SHORT 0x68 headcount  ELSE 0
	READ_LONG 0x6a effectsoffset  ELSE 0
	FOR (headcyc = 0; headcyc < headcount ; headcyc = headcyc + 1) BEGIN
      this_head = 0
	  READ_SHORT (headoffset + (headcyc * 0x28) + 0x1e) effcount  ELSE 0
	  READ_SHORT (headoffset + (headcyc * 0x28) + 0x20) effectsindex  ELSE 0
	  FOR (effcyc = 0; effcyc < effcount; effcyc = effcyc + 1) BEGIN
		READ_SHORT (effectsoffset + (effectsindex + effcyc)* 0x30) opcode ELSE 0
		PATCH_IF (opcode = 38) AND (this_head = 0) BEGIN
		  SET opcode_38 = 1
		  SET this_head = 1
		END
	  END
	END
	PATCH_IF (opcode_38 = 1) BEGIN
	  SPRINT $opcode_38_spells(~%spell_op38_ind%~) ~%SOURCE_RES%~
	  SET ++spell_op38_ind
	END
  END
BUT_ONLY

ACTION_PHP_EACH opcode_38_spells AS ind => op38_spell BEGIN
  COPY_EXISTING ~%op38_spell%.spl~ ~override~
//	PATCH_FOR_EACH nu_song_a IN ~01a~ ~02a~ ~03a~ ~05a~ ~06a~ ~07a~ ~08a~ ~20a~ ~21a~ ~22a~ ~23a~ ~24a~ ~25a~ ~41a~ ~42a~ ~43a~ ~45a~ ~46a~ ~47a~ ~48a~ ~49a~ ~51a~ ~61a~ BEGIN
    PHP_EACH bard_songs_list AS song => type BEGIN
	  LPF CLONE_EFFECT INT_VAR silent = 1 multi_match = 1 match_opcode = 38 opcode = 321 timing = 1 duration = 0 STR_VAR resource = ~%song%a~ END
	END
  BUT_ONLY
END
//___________________________________________________________________________________


// add new auras to world_____________________________________________________________
//
COPY ~might_and_guile/nubards/d5bd05.itm~ ~override~			//		mirror images
  SAY NAME2 @40051
  SAY IDENTIFIED_DESC @40052
  LPF ALTER_ITEM_HEADER INT_VAR target = 5 END
  LPF ALTER_EFFECT INT_VAR silent = 1 match_opcode = 177 parameter1 = %nu_bard_code% parameter2 = 9 STR_VAR resource = ~d5bd05ib~ END
  PHP_EACH bard_kits_list AS clab => kind BEGIN
	PATCH_IF !(~%clab%~ STRING_EQUAL_CASE ~d5_bard~) BEGIN
	  PATCH_IF !(~%kind%~ STRING_EQUAL_CASE ~c~) BEGIN
	    LPF CLONE_EFFECT INT_VAR silent = 1 multi_match = 1 match_opcode = 177 match_parameter1 = %nu_bard_code% match_parameter2 = 9 parameter1 = %clab_1% END
	  END
	  PATCH_IF (~%kind%~ STRING_EQUAL_CASE ~c~) BEGIN
	    LPF CLONE_EFFECT INT_VAR silent = 1 multi_match = 1 match_opcode = 177 match_parameter1 = %nu_bard_code% match_parameter2 = 9 parameter1 = %clab_1% STR_VAR resource = ~d5bd05ic~ END
	  END
	END
  END
CREATE EFF ~d5bd05ib~
	WRITE_LONG 0x10 146
	WRITE_LONG 0x14 1
	WRITE_LONG 0x20 1
	WRITE_LONG 0x24 9
	WRITE_SHORT 0x2c 100
	WRITE_ASCII 0x30 ~d5ub05l~ #8
CREATE EFF ~d5bd05ic~
	WRITE_LONG 0x10 146
	WRITE_LONG 0x14 1
	WRITE_LONG 0x20 1
	WRITE_LONG 0x24 9
	WRITE_SHORT 0x2c 100
	WRITE_ASCII 0x30 ~d5vb05l~ #8
/*
ACTION_IF FILE_EXISTS_IN_GAME ~pwarden.cre~ BEGIN
  COPY_EXISTING ~pwarden.cre~ ~override~
	ADD_CRE_ITEM ~d5bd05~ #1 #0 #0 ~IDENTIFIED~ ~INV~
END
*/
ACTION_IF FILE_EXISTS_IN_GAME ~raelis.dlg~ BEGIN
  COMPILE ~might_and_guile/nubards/raelisadd.d~
END
ACTION_IF (FILE_EXISTS_IN_GAME ~edion.sto~)THEN BEGIN
  COPY_EXISTING ~edion.sto~ ~override~
	ADD_STORE_ITEM ~d5bd05~ #1 #0 #0 ~identified~ #1
END

COPY ~might_and_guile/nubards/d5bd08.itm~ ~override~			//		mind shield
  SAY NAME2 @40081
  SAY IDENTIFIED_DESC @40082
  LPF ALTER_ITEM_HEADER INT_VAR target = 5 END
  LPF ALTER_EFFECT INT_VAR silent = 1 match_opcode = 177 parameter1 = %nu_bard_code% parameter2 = 9 STR_VAR resource = ~d5bd08ib~ END
  PHP_EACH bard_kits_list AS clab => kind BEGIN
	PATCH_IF !(~%clab%~ STRING_EQUAL_CASE ~d5_bard~) BEGIN
	  PATCH_IF !(~%kind%~ STRING_EQUAL_CASE ~c~) BEGIN
	    LPF CLONE_EFFECT INT_VAR silent = 1 multi_match = 1 match_opcode = 177 match_parameter1 = %nu_bard_code% match_parameter2 = 9 parameter1 = %clab_1% END
	  END
	  PATCH_IF (~%kind%~ STRING_EQUAL_CASE ~c~) BEGIN
	    LPF CLONE_EFFECT INT_VAR silent = 1 multi_match = 1 match_opcode = 177 match_parameter1 = %nu_bard_code% match_parameter2 = 9 parameter1 = %clab_1% STR_VAR resource = ~d5bd08ic~ END
	  END
	END
  END
CREATE EFF ~d5bd08ib~
	WRITE_LONG 0x10 146
	WRITE_LONG 0x14 1
	WRITE_LONG 0x20 1
	WRITE_LONG 0x24 9
	WRITE_SHORT 0x2c 100
	WRITE_ASCII 0x30 ~d5ub08l~ #8
CREATE EFF ~d5bd08ic~
	WRITE_LONG 0x10 146
	WRITE_LONG 0x14 1
	WRITE_LONG 0x20 1
	WRITE_LONG 0x24 9
	WRITE_SHORT 0x2c 100
	WRITE_ASCII 0x30 ~d5vb08l~ #8

ACTION_IF FILE_EXISTS_IN_GAME ~pirmur01.cre~ BEGIN
  COPY_EXISTING ~pirmur01.cre~ ~override~
	ADD_CRE_ITEM ~d5bd08~ #1 #0 #0 ~IDENTIFIED~ ~INV~
END

COPY ~might_and_guile/nubards/d5bd24.itm~ ~override~			//		hold undead
  SAY NAME2 @40241
  SAY IDENTIFIED_DESC @40242
  LPF ALTER_ITEM_HEADER INT_VAR target = 5 END
  LPF ALTER_EFFECT INT_VAR silent = 1 match_opcode = 177 parameter1 = %nu_bard_code% parameter2 = 9 STR_VAR resource = ~d5bd24ib~ END
  PHP_EACH bard_kits_list AS clab => kind BEGIN
	PATCH_IF !(~%clab%~ STRING_EQUAL_CASE ~d5_bard~) BEGIN
	  PATCH_IF !(~%kind%~ STRING_EQUAL_CASE ~c~) BEGIN
	    LPF CLONE_EFFECT INT_VAR silent = 1 multi_match = 1 match_opcode = 177 match_parameter1 = %nu_bard_code% match_parameter2 = 9 parameter1 = %clab_1% END
	  END
	  PATCH_IF (~%kind%~ STRING_EQUAL_CASE ~c~) BEGIN
	    LPF CLONE_EFFECT INT_VAR silent = 1 multi_match = 1 match_opcode = 177 match_parameter1 = %nu_bard_code% match_parameter2 = 9 parameter1 = %clab_1% STR_VAR resource = ~d5bd24ic~ END
	  END
	END
  END
CREATE EFF ~d5bd24ib~
	WRITE_LONG 0x10 146
	WRITE_LONG 0x14 1
	WRITE_LONG 0x20 1
	WRITE_LONG 0x24 9
	WRITE_SHORT 0x2c 100
	WRITE_ASCII 0x30 ~d5ub24l~ #8
CREATE EFF ~d5bd24ic~
	WRITE_LONG 0x10 146
	WRITE_LONG 0x14 1
	WRITE_LONG 0x20 1
	WRITE_LONG 0x24 9
	WRITE_SHORT 0x2c 100
	WRITE_ASCII 0x30 ~d5vb24l~ #8

ACTION_IF FILE_EXISTS_IN_GAME ~theshal.cre~ BEGIN
  COPY_EXISTING ~theshal.cre~ ~override~
	ADD_CRE_ITEM ~d5bd24~ #0 #0 #0 ~IDENTIFIED~ ~INV~
END
ACTION_IF (FILE_EXISTS_IN_GAME ~shlehlan.sto~)THEN BEGIN
  COPY_EXISTING ~shlehlan.sto~ ~override~
	ADD_STORE_ITEM ~d5bd24~ #1 #0 #0 ~identified~ #1
END

COPY ~might_and_guile/nubards/d5bd25.itm~ ~override~			//		entangle
  SAY NAME2 @40251
  SAY IDENTIFIED_DESC @40252
  LPF ALTER_ITEM_HEADER INT_VAR target = 5 END
  LPF ALTER_EFFECT INT_VAR silent = 1 match_opcode = 177 parameter1 = %nu_bard_code% parameter2 = 9 STR_VAR resource = ~d5bd25ib~ END
  PHP_EACH bard_kits_list AS clab => kind BEGIN
	PATCH_IF !(~%clab%~ STRING_EQUAL_CASE ~d5_bard~) BEGIN
	  PATCH_IF !(~%kind%~ STRING_EQUAL_CASE ~c~) BEGIN
	    LPF CLONE_EFFECT INT_VAR silent = 1 multi_match = 1 match_opcode = 177 match_parameter1 = %nu_bard_code% match_parameter2 = 9 parameter1 = %clab_1% END
	  END
	  PATCH_IF (~%kind%~ STRING_EQUAL_CASE ~c~) BEGIN
	    LPF CLONE_EFFECT INT_VAR silent = 1 multi_match = 1 match_opcode = 177 match_parameter1 = %nu_bard_code% match_parameter2 = 9 parameter1 = %clab_1% STR_VAR resource = ~d5bd25ic~ END
	  END
	END
  END
CREATE EFF ~d5bd25ib~
	WRITE_LONG 0x10 146
	WRITE_LONG 0x14 1
	WRITE_LONG 0x20 1
	WRITE_LONG 0x24 9
	WRITE_SHORT 0x2c 100
	WRITE_ASCII 0x30 ~d5ub25l~ #8
CREATE EFF ~d5bd25ic~
	WRITE_LONG 0x10 146
	WRITE_LONG 0x14 1
	WRITE_LONG 0x20 1
	WRITE_LONG 0x24 9
	WRITE_SHORT 0x2c 100
	WRITE_ASCII 0x30 ~d5vb25l~ #8

ACTION_IF FILE_EXISTS_IN_GAME ~jugmim01.cre~ BEGIN
  COPY_EXISTING ~jugmim01.cre~ ~override~
	ADD_CRE_ITEM ~d5bd25~ #1 #0 #0 ~IDENTIFIED~ ~INV~
END

COPY ~might_and_guile/nubards/d5bd48.itm~ ~override~			//		dispel illusions
  SAY NAME2 @40481
  SAY IDENTIFIED_DESC @40482
  LPF ALTER_ITEM_HEADER INT_VAR target = 5 END
  LPF ALTER_EFFECT INT_VAR silent = 1 match_opcode = 177 parameter1 = %nu_bard_code% parameter2 = 9 STR_VAR resource = ~d5bd48ib~ END
  PHP_EACH bard_kits_list AS clab => kind BEGIN
	PATCH_IF !(~%clab%~ STRING_EQUAL_CASE ~d5_bard~) BEGIN
	  PATCH_IF !(~%kind%~ STRING_EQUAL_CASE ~c~) BEGIN
	    LPF CLONE_EFFECT INT_VAR silent = 1 multi_match = 1 match_opcode = 177 match_parameter1 = %nu_bard_code% match_parameter2 = 9 parameter1 = %clab_1% END
	  END
	  PATCH_IF (~%kind%~ STRING_EQUAL_CASE ~c~) BEGIN
	    LPF CLONE_EFFECT INT_VAR silent = 1 multi_match = 1 match_opcode = 177 match_parameter1 = %nu_bard_code% match_parameter2 = 9 parameter1 = %clab_1% STR_VAR resource = ~d5bd48ic~ END
	  END
	END
  END
CREATE EFF ~d5bd48ib~
	WRITE_LONG 0x10 146
	WRITE_LONG 0x14 1
	WRITE_LONG 0x20 1
	WRITE_LONG 0x24 9
	WRITE_SHORT 0x2c 100
	WRITE_ASCII 0x30 ~d5ub48l~ #8
CREATE EFF ~d5bd48ic~
	WRITE_LONG 0x10 146
	WRITE_LONG 0x14 1
	WRITE_LONG 0x20 1
	WRITE_LONG 0x24 9
	WRITE_SHORT 0x2c 100
	WRITE_ASCII 0x30 ~d5vb48l~ #8

ACTION_IF (FILE_EXISTS_IN_GAME ~stoblack.sto~)THEN BEGIN
  COPY_EXISTING ~stoblack.sto~ ~override~
	ADD_STORE_ITEM ~d5bd48~ #0 #0 #0 ~identified~ #1
END

/*
// need to put the scroll somewhere...
COPY ~might_and_guile/nubards/d5bd51.itm~ ~override~			//		bladesong
  SAY NAME2 @40511
  SAY IDENTIFIED_DESC @40512
  LPF ALTER_ITEM_HEADER INT_VAR target = 5 END
  LPF ALTER_EFFECT INT_VAR silent = 1 match_opcode = 177 parameter1 = %nu_bard_code% parameter2 = 9 STR_VAR resource = ~d5bd51ib~ END
  PHP_EACH bard_kits_list AS clab => kind BEGIN
	PATCH_IF !(~%clab%~ STRING_EQUAL_CASE ~d5_bard~) BEGIN
	  PATCH_IF !(~%kind%~ STRING_EQUAL_CASE ~c~) BEGIN
	    LPF CLONE_EFFECT INT_VAR silent = 1 multi_match = 1 match_opcode = 177 match_parameter1 = %nu_bard_code% match_parameter2 = 9 parameter1 = %clab_1% END
	  END
	  PATCH_IF (~%kind%~ STRING_EQUAL_CASE ~c~) BEGIN
	    LPF CLONE_EFFECT INT_VAR silent = 1 multi_match = 1 match_opcode = 177 match_parameter1 = %nu_bard_code% match_parameter2 = 9 parameter1 = %clab_1% STR_VAR resource = ~d5bd51ic~ END
	  END
	END
  END
CREATE EFF ~d5bd51ib~
	WRITE_LONG 0x10 146
	WRITE_LONG 0x14 1
	WRITE_LONG 0x20 1
	WRITE_LONG 0x24 9
	WRITE_SHORT 0x2c 100
	WRITE_ASCII 0x30 ~d5ub51l~ #8
CREATE EFF ~d5bd51ic~
	WRITE_LONG 0x10 146
	WRITE_LONG 0x14 1
	WRITE_LONG 0x20 1
	WRITE_LONG 0x24 9
	WRITE_SHORT 0x2c 100
	WRITE_ASCII 0x30 ~d5vb51l~ #8
*/
//___________________________________________________________________________________


// add support for feat system________________________________________________________
//
ACTION_DEFINE_ASSOCIATIVE_ARRAY feat_nums_lets BEGIN
	1	=> a
	2	=> b
	3	=> c
	4	=> d
	5	=> e
	6	=> f
	7	=> g
	8	=> h
	9	=> i
	10	=> j
	11	=> k
	12	=> l
	13	=> m
	14	=> n
	15	=> o
	16	=> p
	17	=> q
	18	=> r
	19	=> s
	20	=> t
END

//INCLUDE ~might_and_guile/lib/sequencer_menu_d5.tpa~
INCLUDE ~might_and_guile/lib/sequencer_menu.tpa~

COPY ~might_and_guile/feats/d5flstb.2da~ ~override~

ACTION_IF !(FILE_EXISTS_IN_GAME ~d5ftskn.2da~) BEGIN
 ACTION_IF !(GAME_IS ~iwdee~) BEGIN
  COPY ~might_and_guile/feats/d5ftskn.2da~ ~override~
 END
 ACTION_IF (GAME_IS ~iwdee~) BEGIN
  COPY ~might_and_guile/feats/d5ftskn_iwd.2da~ ~override/d5ftskn.2da~
 END
END

OUTER_SPRINT feat_select_string @20011 // ~Feat Selection~ 
OUTER_SET feat_select_strref = RESOLVE_STR_REF (%feat_select_string%)
OUTER_SPRINT feat_title_string @20012 
OUTER_SPRINT feat_label_string @20013 

ACTION_IF !(FILE_EXISTS_IN_GAME ~d5__rfeat.d5~) BEGIN

  COPY ~might_and_guile/feats/d5_feat.bam~ ~override~

  ACTION_PHP_EACH feat_nums_lets AS num => let BEGIN
	ACTION_IF !(FILE_EXISTS_IN_GAME ~d5feat%num%.spl~) BEGIN
	  COPY ~might_and_guile/feats/d5feat1.spl~ ~override/d5feat%num%.spl~ 
		LPF DELETE_EFFECT INT_VAR match_opcode = 206 END
		LPF ALTER_EFFECT INT_VAR match_opcode = 177 STR_VAR match_resource = ~d5feat1~ resource = EVAL ~d5feat%num%~ END
	END
	ACTION_IF !(FILE_EXISTS_IN_GAME ~d5feat%num%.eff~) BEGIN
	  COPY ~might_and_guile/feats/d5feat1.eff~ ~override/d5feat%num%.eff~ 
		WRITE_EVALUATED_ASCII 0x30 ~d5feat%let%~ #8
	END
	ACTION_IF !(FILE_EXISTS_IN_GAME ~d5feat%let%.spl~) BEGIN
	  COPY ~might_and_guile/misc/d5_base.spl~ ~override/d5feat%let%.spl~
		SAY NAME1 @20099
		SAY UNIDENTIFIED_DESC @20100
		WRITE_ASCII 0x3a ~d5_feat~ #8
		LPF ALTER_SPELL_HEADER INT_VAR target = 7 STR_VAR icon = ~d5_feat~ END
		LPF ADD_SPELL_CFEFFECT INT_VAR insert_point = 0 opcode = 172 target = 1 timing = 9 STR_VAR resource = EVAL ~d5feat%let%~ END
		LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = EVAL ~d5feat%num%~ END
	END
  END

  COPY_EXISTING ~kitlist.2da~ ~override~
	READ_2DA_ENTRIES_NOW r2en_kitlist 10
	FOR (row = 2; row < r2en_kitlist; ++row) BEGIN
	  READ_2DA_ENTRY_FORMER r2en_kitlist row 5 kitlist_2da
	  PATCH_IF (~%kitlist_2da%~ STRING_EQUAL_CASE ~d5_bard~) BEGIN
		READ_2DA_ENTRY_FORMER r2en_kitlist row 0 kitlist_index
		READ_2DA_ENTRY_FORMER r2en_kitlist row 3 kitlist_name
		READ_2DA_ENTRY_FORMER r2en_kitlist row 9 kitids_num
		GET_STRREF %kitlist_name% kit_name_strref
		SPRINT feat_select_name ~%kit_name_strref% %feat_select_string%~
		SET kit_seq_name = RESOLVE_STR_REF (~%feat_select_name%~) 
		SET kit_seq_tip = RESOLVE_STR_REF (~%feat_select_name%~) 
		SET kit_seq_index = %kitlist_index% 
		INNER_ACTION BEGIN
		  COPY_EXISTING ~d5flstb.2da~ ~override~
			COUNT_2DA_COLS cols
			COUNT_2DA_ROWS cols rows
			FOR (col = 1; col < (cols - 1); ++col) BEGIN
			  READ_2DA_ENTRY 0 (col - 1) (cols - 1) feat_kit_2da
			  PATCH_IF (~%feat_kit_2da%~ STRING_EQUAL_CASE ~d5_bard~) BEGIN
				SET this_col = %col%
				INNER_ACTION BEGIN
				  LAF CREATE_SEQUENCER_MENU 
				   INT_VAR 
					name = %kit_seq_name%
					tip = %kit_seq_tip%
					desc = RESOLVE_STR_REF (~blah~) 
					column = %this_col% 
					class = 2
				   STR_VAR 
					resref = EVAL ~d5ft%kit_seq_index%~
					icon = ~spcl919b~
					spelltable = ~d5ftskn~ 
					spelllist = ~d5flstb~
					title = EVAL ~%feat_title_string%~
					label = EVAL ~%feat_label_string%~
				  END
				  COPY_EXISTING ~d5ft%kit_seq_index%.spl~ ~override~
					LPF DELETE_EFFECT INT_VAR match_opcode = 171 STR_VAR match_resource = EVAL ~d5ft%kit_seq_index%~ END
				  BUT_ONLY IF_EXISTS
				END
			  END
			END
		  BUT_ONLY
		  ACTION_FOR_EACH letter IN ~A~ ~B~ ~C~ ~D~ ~E~ ~F~ ~G~ ~H~ ~I~ ~J~ ~K~ ~L~ ~M~ ~N~ ~O~ ~P~ ~Q~ ~R~ ~S~ ~T~ BEGIN
			COPY_EXISTING ~d5feat%letter%.spl~ ~override~
			  LPF ADD_SPELL_EFFECT INT_VAR opcode = 326 target = 1 parameter1 = %kitids_num% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = EVAL ~d5ft%kit_seq_index%~ END
			IF_EXISTS BUT_ONLY
		  END
		END
	  END
	END
  BUT_ONLY
  COPY_EXISTING ~d5flstb.2da~ ~override~
	COUNT_2DA_COLS cols
	COUNT_2DA_ROWS cols rows
	FOR (row = 1; row < rows; ++row) BEGIN
  	  READ_2DA_ENTRY row 0 cols ~book_feat~
	  INNER_ACTION BEGIN
		COPY_EXISTING ~%book_feat%.spl~ ~override/%book_feat%L.spl~
		  WRITE_SHORT 0x1c 4
		  WRITE_LONG 0x34 1
		  LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 171 target = 1 timing = 9 STR_VAR resource = EVAL ~%book_feat%~ END
		IF_EXISTS BUT_ONLY
	  END
	END
  BUT_ONLY

 ACTION_PHP_EACH feat_bard_list AS ind => ids BEGIN
  COPY_EXISTING ~d5ft%ind%.spl~ ~override~
	LPF DELETE_EFFECT INT_VAR match_opcode = 171 STR_VAR match_resource = EVAL ~d5ft%ind%~ END
  IF_EXISTS BUT_ONLY
 END

  APPEND ~d5_bard.2da~ ~D5_SONGS    ****        ****        GA_D5FEATD  ****        ****        GA_D5FEATE  ****        ****        GA_D5FEATF  ****        ****        GA_D5FEATG  ****        ****        GA_D5FEATH  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****       ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****  ~

END

ACTION_IF (FILE_EXISTS_IN_GAME ~d5__rfeat.d5~) BEGIN
 COPY ~might_and_guile/feats/d5flstbf.2da~ ~override~
 COPY_EXISTING ~d5flstbf.2da~ ~override~
  COUNT_2DA_COLS cols
  COUNT_2DA_ROWS cols rows
  FOR (col = 1; col < cols; ++col) BEGIN
	READ_2DA_ENTRY 0 (col - 1) (cols - 1) feat_kit_2da
	INNER_ACTION BEGIN
	  COPY_EXISTING ~kitlist.2da~ ~override~
		READ_2DA_ENTRIES_NOW rows 10
		FOR (row = 1; row < rows; ++row) BEGIN
	      READ_2DA_ENTRY_FORMER rows row 0 kitlist_index
	      READ_2DA_ENTRY_FORMER rows row 3 kitlist_name
	      READ_2DA_ENTRY_FORMER rows row 5 kitlist_2da
	      READ_2DA_ENTRY_FORMER rows row 9 kitids_num
	      PATCH_IF (~%kitlist_2da%~ STRING_EQUAL_CASE ~%feat_kit_2da%~) BEGIN
	        SPRINT $feat_bard_list(~%kitlist_index%~)~%kitids_num%~
			GET_STRREF %kitlist_name% kit_name_strref
			SPRINT feat_select_name ~%kit_name_strref% %feat_select_string%~
			SET kit_seq_name = RESOLVE_STR_REF (~%feat_select_name%~) 
			SET kit_seq_tip = RESOLVE_STR_REF (~%feat_select_name%~) 
			SET kit_seq_index = %kitlist_index% 
			INNER_ACTION BEGIN
			  LAF CREATE_SEQUENCER_MENU 
			   INT_VAR 
				name = %kit_seq_name%
				tip = %kit_seq_tip%
				desc = RESOLVE_STR_REF (~blah~) 
				column = %col% 
				class = 2
			   STR_VAR 
				resref = EVAL ~d5ft%kit_seq_index%~
				icon = ~spcl919b~
				spelltable = ~d5ftskn~ 
				spelllist = ~d5flstbf~
				title = EVAL ~%feat_title_string%~
				label = EVAL ~%feat_label_string%~
			  END
			END
		  END
		END
	  BUT_ONLY
	END
  END
 BUT_ONLY
 COPY_EXISTING ~d5flstbf.2da~ ~override~
	COUNT_2DA_COLS cols
	COUNT_2DA_ROWS cols rows
	FOR (row = 1; row < rows; ++row) BEGIN
  	  READ_2DA_ENTRY row 0 cols ~book_feat~
	  INNER_ACTION BEGIN
		COPY_EXISTING ~%book_feat%.spl~ ~override/%book_feat%L.spl~
		  WRITE_SHORT 0x1c 4
		  WRITE_LONG 0x34 1
		  LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 171 target = 1 timing = 9 STR_VAR resource = EVAL ~%book_feat%~ END
		IF_EXISTS BUT_ONLY
	  END
	END
 BUT_ONLY

 ACTION_PHP_EACH feat_nums_lets AS num => let BEGIN
/*
  COPY_EXISTING ~d5feat%num%.spl~ ~override~
    PHP_EACH bard_kits_list AS clab => kind BEGIN
	  LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 177 target = 1 parameter1 = %clab_1% parameter2 = 9 STR_VAR resource = EVAL ~d5feat%num%~ END
	END
  IF_EXISTS BUT_ONLY
*/
  COPY_EXISTING ~d5feat%let%.spl~ ~override~
	PHP_EACH feat_bard_list AS ind => ids BEGIN
	  LPF ADD_SPELL_EFFECT INT_VAR opcode = 326 target = 1 parameter1 = %ids% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = EVAL ~d5ft%ind%~ END
	END
  IF_EXISTS BUT_ONLY
 END

COPY ~might_and_guile/feats/d5mcft1.spl~ ~override/d5mcfb1.spl~
  LPF ALTER_EFFECT INT_VAR silent = 1 match_opcode = 318 parameter2 = %kit_is_row% END
  LPF CLONE_EFFECT INT_VAR silent = 1 match_opcode = 177 match_parameter1 = 15 parameter1 = 10 END
  LPF CLONE_EFFECT INT_VAR silent = 1 match_opcode = 177 match_parameter1 = 9 parameter1 = 7 END
  LPF CLONE_EFFECT INT_VAR silent = 1 match_opcode = 177 match_parameter1 = 9 parameter1 = 3 END
//  LPF ALTER_EFFECT INT_VAR silent = 1 match_opcode = 206 STR_VAR resource = EVAL ~d5mcfb1~ END
  LPF DELETE_EFFECT INT_VAR match_opcode = 206 END

ACTION_IF !(FILE_EXISTS_IN_GAME ~d5mcft1.eff~) BEGIN
  COPY ~might_and_guile/feats/d5mcft1.eff~ ~override~
END

ACTION_PHP_EACH feat_nums_lets AS num => let BEGIN
  ACTION_IF (num > 1) && (num < 10) BEGIN
	ACTION_IF !(FILE_EXISTS_IN_GAME ~d5mcft%num%.eff~) BEGIN
	  COPY_EXISTING ~d5mcft1.eff~ ~override/d5mcft%num%.eff~
		WRITE_EVALUATED_ASCII 0x30 ~d5feat%let%~ #8
	  BUT_ONLY
	END
	COPY_EXISTING ~d5mcfb1.spl~ ~override/d5mcfb%num%.spl~
	  LPF ALTER_EFFECT INT_VAR silent = 1 match_opcode = 318 STR_VAR resource = EVAL ~d5mcfb%num%~ END
	  LPF ALTER_EFFECT INT_VAR silent = 1 match_opcode = 177 STR_VAR resource = EVAL ~d5mcft%num%~ END
	  LPF ALTER_EFFECT INT_VAR silent = 1 match_opcode = 206 STR_VAR resource = EVAL ~d5mcfb%num%~ END
	BUT_ONLY
//    COPY_EXISTING ~d5mcft%num%.spl~ ~override~
//	  LPF ADD_SPELL_EFFECT INT_VAR target = 1 opcode = 206 parameter1 = (0 - 1) timing = 9 STR_VAR resource = EVAL ~d5mcfb%num%~ END
//    IF_EXISTS BUT_ONLY
    COPY_EXISTING ~d5feat%let%.spl~ ~override~
	  LPF ADD_SPELL_EFFECT INT_VAR target = 1 opcode = 206 parameter1 = (0 - 1) timing = 9 STR_VAR resource = EVAL ~d5mcfb%num%~ END
    IF_EXISTS BUT_ONLY
  END
END

 ACTION_PHP_EACH feat_bard_list AS ind => ids BEGIN
  COPY_EXISTING ~d5ft%ind%.spl~ ~override~
	LPF DELETE_EFFECT INT_VAR match_opcode = 171 STR_VAR match_resource = EVAL ~d5ft%ind%~ END
  IF_EXISTS BUT_ONLY
 END

 ACTION_PHP_EACH bard_kits_list AS clab => kind BEGIN
  COPY_EXISTING ~%clab%.2da~ ~override~
	LPM remove_blank_lines
	APPEND_FILE ~might_and_guile/feats/feats_multibard.txt~
  IF_EXISTS BUT_ONLY
 END
 APPEND ~d5_bard.2da~ ~D5_SONGS      GA_D5FEATK  ****        ****        ****        GA_D5FEATL  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****       ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****  ~

// *****
// need to add 318 effects for bard kits to existing multiclass feat abilities (D5MCFT1-6)

END

ACTION_IF !(FILE_EXISTS_IN_GAME ~d5featx.spl~) BEGIN
  COPY ~might_and_guile/misc/d5_base.spl~ ~override/d5featx.spl~
END
COPY ~might_and_guile/feats/d5flstb.2da~ ~might_and_guile/temp/d5flstb.2da~
  COUNT_2DA_COLS cols
  COUNT_2DA_ROWS cols rows
  FOR (row = 1; row < rows; ++row) BEGIN
  	READ_2DA_ENTRY row 0 cols spellbook_feat
	INNER_ACTION BEGIN
	  COPY_EXISTING ~d5featx.spl~ ~override~
		LPF ADD_SPELL_EFFECT INT_VAR opcode = 172 target = 1 timing = 9 STR_VAR resource = EVAL ~%spellbook_feat%~ END
	  BUT_ONLY
	END
  END
BUT_ONLY

ACTION_PHP_EACH bard_songs_list AS song => type BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5ub%song%.spl~) && !(FILE_EXISTS_IN_GAME ~d5ub%song%l.spl~) BEGIN
	COPY_EXISTING ~d5ub%song%.spl~ ~override/d5ub%song%l.spl~
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5vb%song%.spl~) && !(FILE_EXISTS_IN_GAME ~d5vb%song%l.spl~) BEGIN
	COPY_EXISTING ~d5vb%song%.spl~ ~override/d5vb%song%l.spl~
  END
END
//___________________________________________________________________________________


// initialize songs___________________________________________________________________
//
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bd000.spl~
    LPF ADD_SPELL_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5bsong~ END

COPY ~might_and_guile/nubards/d5bcast.bam~ ~override~
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5bsong.spl~
    SAY NAME1 @40981 											// ~initialize bardic spellcasting~
    SAY UNIDENTIFIED_DESC @40981 								// ~initialize bardic spellcasting~
    LPF ALTER_SPELL_HEADER INT_VAR target = 5 STR_VAR icon = ~d5bcast~ END
    LPF ADD_SPELL_EFFECT INT_VAR opcode = 172 target = 1 timing = 9 STR_VAR resource = ~spcl412~ END
    LPF ADD_SPELL_EFFECT INT_VAR opcode = 172 target = 1 timing = 9 STR_VAR resource = ~d5bsong~ END
    LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bd000~ END
    LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5bsong~ END

//APPEND ~d5nubard.2da~ ~BARD_INIT   AP_D5BD000  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****       ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****  ~

/* should be in clabma01.2da, and thus unnecessary
ACTION_IF MOD_IS_INSTALLED ~tomeandblood.tp2~ ~51~ BEGIN	//	innate sequencers
  APPEND ~d5nubard.2da~ ~METAMAGIC   ****        ****        ****        ****        ****        ****        AP_D5ADSQ1M ****        ****        AP_D5ADCNTM ****        ****        AP_D5ADSQ2M ****        ****        AP_D5ADSQ3M ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~ UNLESS ~METAMAGIC~
END
ACTION_IF MOD_IS_INSTALLED ~tomeandblood.tp2~ ~61~ BEGIN	//	innate cantrips
  APPEND ~d5nubard.2da~ ~CANTRIPS 	GA_D5_CANT1 ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~ UNLESS ~CANTRIPS~
END
ACTION_IF MOD_IS_INSTALLED ~tomeandblood.tp2~ ~63~ BEGIN	//	cantrip wand
  APPEND ~d5nubard.2da~ ~CANTRIPS	AP_D5CANTW1 ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~ UNLESS ~CANTRIPS~
END
ACTION_IF MOD_IS_INSTALLED ~tomeandblood.tp2~ ~66~ BEGIN	//	innate familiars
  APPEND ~d5nubard.2da~ ~FAMILIAR 	AP_D5FMINN  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~ UNLESS ~FAMILIAR~
END
*/


// 5E-style casting___________________________________________________________________
//
ACTION_IF (d5_bards_5E_casting = 1) BEGIN	//	5E casting, glom onto d5zzini to initialize everything

  ACTION_IF !(FILE_CONTAINS_EVALUATED (~clabma01.2da~ ~AP_D5ZZ000~)) BEGIN
    APPEND ~d5nubard.2da~ 
~SPELL_INIT  AP_D5ZZ000  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****       ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** 
LESSPREP    AP_D5Z0SLT  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** 
NO_ASPLS    AP_D5Z0SPL  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** 
~
  END

COPY ~might_and_guile/nubards/d5cstmbd.2da~ ~override~
  LPF arcane_casting_slots STR_VAR table_spl = ~d5zltmb~ END
BUT_ONLY

ACTION_IF (FILE_EXISTS_IN_GAME ~d5zltmb.spl~) BEGIN
  COPY_EXISTING ~d5zltmb.spl~ ~override~
    WRITE_SHORT 0x1c 1
END

COPY ~might_and_guile/nubards/d5cstprs.2da~ ~override~
  LPF divine_casting_slots STR_VAR table_spl = ~d5zltbc~ END
BUT_ONLY

ACTION_IF (FILE_EXISTS_IN_GAME ~d5zltbc.spl~) BEGIN
  COPY_EXISTING ~d5zltbc.spl~ ~override~
    WRITE_SHORT 0x1c 2
END

/*
APPEND ~d5nubard.2da~ ~CASTSLOTS   AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  AP_D5ZLTMB  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
*/

COPY_EXISTING ~d5zprpd.spl~ ~override~
			  ~d5zrfsh.spl~ ~override~
  PATCH_PHP_EACH bard_kits_list AS clab => kind BEGIN
    PATCH_IF (~%kind%~ STRING_EQUAL_CASE ~W~) BEGIN 
      LPF ADD_SPELL_EFFECT INT_VAR insert_point = 2 opcode = 326 target = 1 parameter1 = %clab_1% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zltmbz~ END
    END
    PATCH_IF (~%kind%~ STRING_EQUAL_CASE ~C~) BEGIN 
      LPF ADD_SPELL_EFFECT INT_VAR insert_point = 2 opcode = 326 target = 1 parameter1 = %clab_1% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zltbcz~ END
    END
  END
IF_EXISTS BUT_ONLY

// add 318 effects to exempt bards from other 5E casting slots
ACTION_IF (FILE_EXISTS_IN_GAME ~d5zltwz.spl~) AND (FILE_CONTAINS_EVALUATED (~clabma01.2da~ ~AP_D5ZLTWZ~)) BEGIN
  COPY_EXISTING ~d5zltwz.spl~ ~override~
    PHP_EACH bard_kits_list AS clab => kind BEGIN
      PATCH_IF (~%kind%~ STRING_EQUAL_CASE ~W~) BEGIN
	    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = %clab_1% parameter2 = %kit_is_row% timing = 0 duration = 1 STR_VAR resource = ~d5zltwz~ END
	  END
	END
  BUT_ONLY
END
ACTION_IF (FILE_EXISTS_IN_GAME ~d5zltcl.spl~) AND (FILE_CONTAINS_EVALUATED (~clabpr01.2da~ ~AP_D5ZLTCL~)) BEGIN
  COPY_EXISTING ~d5zltcl.spl~ ~override~
    PHP_EACH bard_kits_list AS clab => kind BEGIN
      PATCH_IF (~%kind%~ STRING_EQUAL_CASE ~C~) BEGIN
	    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = %clab_1% parameter2 = %kit_is_row% timing = 0 duration = 1 STR_VAR resource = ~d5zltcl~ END
	  END
	END
  BUT_ONLY
END

ACTION_IF (MOD_IS_INSTALLED ~tomeandblood.tp2~ ~62~) BEGIN	//	L1Cantrips
  COPY_EXISTING ~d5bdslt.spl~ ~override~
    LPF ALTER_EFFECT INT_VAR match_opcode = 233 match_parameter1 = (2 << 4) paramater1 = (1 << 4) END
    LPF ALTER_EFFECT INT_VAR match_opcode = 233 match_parameter1 = (3 << 4) paramater1 = (1 << 4) END
    LPF ALTER_EFFECT INT_VAR match_opcode = 233 match_parameter1 = (4 << 4) paramater1 = (1 << 4) END
    LPF ALTER_EFFECT INT_VAR match_opcode = 233 match_parameter1 = (5 << 4) paramater1 = (1 << 4) END
    LPF ALTER_EFFECT INT_VAR match_opcode = 233 match_parameter1 = (6 << 8) paramater1 = (7 << 8) END
    LPF ALTER_EFFECT INT_VAR match_opcode = 233 match_parameter1 = (5 << 8) paramater1 = (6 << 8) END
    LPF ALTER_EFFECT INT_VAR match_opcode = 233 match_parameter1 = (4 << 8) paramater1 = (5 << 8) END
    LPF ALTER_EFFECT INT_VAR match_opcode = 233 match_parameter1 = (3 << 8) paramater1 = (4 << 8) END
    LPF ALTER_EFFECT INT_VAR match_opcode = 233 match_parameter1 = (2 << 8) paramater1 = (3 << 8) END
    LPF ALTER_EFFECT INT_VAR match_opcode = 233 match_parameter1 = (1 << 8) paramater1 = (2 << 8) END
    LPF ADD_SPELL_EFFECT INT_VAR header = 3 opcode = 233 target = 1 parameter1 = (1 << 8) parameter2 = (108 + (0x10000 * 1)) timing = 9 END
  IF_EXISTS BUT_ONLY

END

// metamagic scrolls__________________________________________________________________
//
ACTION_IF (d5_bards_5E_casting = 1) AND !(MOD_IS_INSTALLED ~tomeandblood.tp2~ ~55~) BEGIN
 ACTION_FOR_EACH meta_scroll IN ~scrl6p~ ~scrl8l~ ~scrl9d~ ~scrl7u~ ~scrl9q~ BEGIN
  ACTION_IF FILE_EXISTS_IN_GAME ~%meta_scroll%.itm~ BEGIN
	COPY_EXISTING ~%meta_scroll%.itm~ ~override~
	  WRITE_BYTE 0x2b (THIS BOR 0b10000000) // set unusable by skalds
	BUT_ONLY
  END
 END
END

END	//	end if 5E casting enabled


//stat-based bonus spells_____________________________________________________________
//
ACTION_IF (d5_bards_5E_casting = 1) AND (FILE_EXISTS_IN_GAME ~qdtnb_attrbon.qd~) BEGIN

  LAM semi_int_slots

/* is this vv not necessary anymore? I think it's folded into semi_int_slots
  COPY_EXISTING ~d5bsong.spl~ ~override~
	PHP_EACH int_nums_lets AS int => slot BEGIN
	  LPF ADD_SPELL_EFFECT INT_VAR insert_point = 2 opcode = 326 target = 1 parameter1 = %int% parameter2 = 128 timing = 1 STR_VAR resource = EVAL ~d5intb%slot%~ END
	END
	PATCH_FOR_EACH lev IN ~1a~ ~1b~ ~2a~ ~2b~ ~3a~ ~3b~ ~4a~ ~4b~ ~5a~ ~5b~ ~6a~ ~6b~ ~7a~ BEGIN
	  LPF ADD_SPELL_EFFECT INT_VAR insert_point = 2 opcode = 321 target = 1 timing = 1 STR_VAR resource = EVAL ~d5intb%lev%~ END
	END
  IF_EXISTS BUT_ONLY

  APPEND ~d5nubard.2da~ ~LESSSLOTS   AP_D5NABSW  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
  APPEND ~d5nubard.2da~ ~LESSSLOTS   AP_D5Z0SLT  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
  APPEND ~d5nubard.2da~ ~LESSSLOTS   AP_D5Z1SLT  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
*/

END


// bonus spell slot items_____________________________________________________________
//
// don't do this... or, maybe make add a setting for it?


//make sure no level 9 slots________________________________________________________
//
COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5zx9bd.spl~
  LPF ADD_SPELL_EFFECT INT_VAR opcode = 42 target = 1 parameter1 = (0 - 1) parameter2 = 256 timing = 9 END

COPY ~might_and_guile/lib/d5_base.spl~ ~override/d5x9spl.spl~
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter2 = 1 timing = 9 STR_VAR resource = ~d5zx9bd~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter2 = 1 timing = 9 STR_VAR resource = ~d5zx9bd~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter2 = 1 timing = 9 STR_VAR resource = ~d5zx9bd~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter2 = 1 timing = 9 STR_VAR resource = ~d5zx9bd~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter2 = 1 timing = 9 STR_VAR resource = ~d5zx9bd~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter2 = 1 timing = 9 STR_VAR resource = ~d5zx9bd~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter2 = 1 timing = 9 STR_VAR resource = ~d5zx9bd~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter2 = 1 timing = 9 STR_VAR resource = ~d5zx9bd~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter2 = 1 timing = 9 STR_VAR resource = ~d5zx9bd~ END
	LPF ADD_SPELL_EFFECT INT_VAR opcode = 146 target = 1 parameter2 = 1 timing = 9 STR_VAR resource = ~d5zx9bd~ END
	PATCH_IF (FILE_EXISTS_IN_GAME ~d5zltwz.spl~) BEGIN
	  LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = ~d5zltwz~ END
	END

APPEND ~d5nubard.2da~ ~BARD_INIT   AP_D5X9SPL  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****       ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****  ~
//____________________________________________________________________________________


// add more bard spells_______________________________________________________________
//
// BARD:

// Command:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr102.spl~ BEGIN
  COPY_EXISTING ~sppr102.spl~ ~override/d5bp102.spl~
	WRITE_SHORT 0x1c 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp102~ cast_spell = ~sppr102~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $bard_free_spells(~d5bp102~)  ~1~
END

// Vocalize - lvl 1:
ACTION_IF FILE_EXISTS_IN_GAME ~spwi219.spl~ BEGIN
  COPY_EXISTING ~spwi219.spl~ ~override/d5bw219.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bw219~ cast_spell = ~spwi219~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $bard_free_spells(~d5bw219~)~1~
END

// Silence:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr211.spl~ BEGIN
  COPY_EXISTING ~sppr211.spl~ ~override/d5bp211.spl~
	WRITE_SHORT 0x1c 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp211~ cast_spell = ~sppr211~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $bard_free_spells(~d5bp211~) ~1~
END

// IWD Shout:
ADD_PROJECTILE ~might_and_guile/nubards/d5shout.pro~
COPY ~might_and_guile/nubards/#tra_08.wav~ ~override~
COPY ~might_and_guile/nubards/spwi431c.bam~ ~override/d5bw431c.bam~
COPY ~might_and_guile/nubards/spwi431b.bam~ ~override/d5bw431b.bam~
COPY ~might_and_guile/nubards/d5shout.spl~ ~override/d5bw431.spl~
	SAY NAME1 @40905
	SAY UNIDENTIFIED_DESC @40906
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 3
	WRITE_ASCII 0x3a ~D5BW431C~ #8
	LPF ALTER_SPELL_HEADER INT_VAR projectile = %d5shout% STR_VAR icon = ~D5BW431B~ END
ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bw431~ cast_spell = ~d5bw431~ spell_type = ~arcane~ END
END
OUTER_SPRINT $bard_free_spells(~d5bw431~) ~1~

// Exaltation/Break Enchantment:
ACTION_IF !(FILE_EXISTS_IN_GAME ~dvsrv4here.mrk~) AND (FILE_EXISTS_IN_GAME ~ohtyr1.spl~) BEGIN
  COPY_EXISTING ~ohtyr1.spl~ ~override/d5bp321.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 4
	LPF ALTER_SPELL_HEADER INT_VAR speed = 3 END
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp321~ cast_spell = ~ohtyr1~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $bard_free_spells(~d5bp321~) ~1~
END
ACTION_IF (FILE_EXISTS_IN_GAME ~dvsrv4here.mrk~) AND (FILE_EXISTS_IN_GAME ~spwi410.spl~) BEGIN
/*
  COPY_EXISTING ~spwi410.spl~ ~override/d5bw410.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 4
	LPF ALTER_SPELL_HEADER INT_VAR speed = 3 END  
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bw410~ cast_spell = ~spwi410~ spell_type = ~arcane~ END
  END
*/
  OUTER_SPRINT $bard_free_spells(~spwi410~) ~1~
END

// Greater Command:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr512.spl~ BEGIN
  COPY_EXISTING ~sppr512.spl~ ~override/d5bp512.spl~
	WRITE_SHORT 0x1c 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp512~ cast_spell = ~sppr512~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $bard_free_spells(~d5bp512~) ~1~
END

// IWD Great Shout:
COPY ~might_and_guile/nubards/#tra_08.wav~ ~override~
COPY ~might_and_guile/nubards/spwi806c.bam~ ~override/d5bw806c.bam~
COPY ~might_and_guile/nubards/spwi806b.bam~ ~override/d5bw806b.bam~
COPY ~might_and_guile/nubards/d5gshou.spl~ ~override/d5bw806.spl~
	SAY NAME1 @40907
	SAY UNIDENTIFIED_DESC @40908
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 6
	WRITE_ASCII 0x3a ~D5BW806C~ #8
	LPF ALTER_SPELL_HEADER INT_VAR projectile = %d5shout% STR_VAR icon = ~D5BW806B~ END
ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bw806~ cast_spell = ~d5bw806~ spell_type = ~arcane~ END
END
OUTER_SPRINT $bard_free_spells(~d5bw806~) ~1~

// Earthquake:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr720.spl~ BEGIN
  COPY_EXISTING ~sppr720.spl~ ~override/d5bp720.spl~
	WRITE_SHORT 0x1c 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp720~ cast_spell = ~sppr720~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $bard_free_spells(~d5bp720~) ~1~
END

ACTION_IF (FILE_EXISTS_IN_GAME ~spwi612.spl~) BEGIN
  OUTER_SPRINT $bard_free_spells(~spwi612~) ~1~
END

// JESTER:

// Miscast Magic:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr310.spl~ BEGIN
  COPY_EXISTING ~sppr310.spl~ ~override/d5bp310.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp310~ cast_spell = sppr310~~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $jester_free_spells(~d5bp310~) ~1~
END

// Rigid Thinking:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr311.spl~ BEGIN
  COPY_EXISTING ~sppr311.spl~ ~override/d5bp311.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 2
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp311~ cast_spell = ~sppr311~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $jester_free_spells(~d5bp311~) ~1~
END

// Free Action:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr403.spl~ BEGIN
  COPY_EXISTING ~sppr403.spl~ ~override/d5bp403.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 3
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp403~ cast_spell = ~sppr403~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $jester_free_spells(~d5bp403~) ~1~
END

// Chaotic Commands:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr508.spl~ BEGIN
  COPY_EXISTING ~sppr508.spl~ ~override/d5bp508.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 4
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp508~ cast_spell = ~sppr508~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $jester_free_spells(~d5bp508~) ~1~
END

// Physical Mirror:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr613.spl~ BEGIN
  COPY_EXISTING ~sppr613.spl~ ~override/d5bp613.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 5
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp613~ cast_spell = ~sppr613~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $jester_free_spells(~d5bp613~) ~1~
END

// Entropy Shield:
OUTER_SET spell_ids = IDS_OF_SYMBOL (~spell~ ~CLERIC_ENTROPY_SHIELD~)
ACTION_IF !(spell_ids = 0 - 1) BEGIN
  LAF RES_NUM_OF_SPELL_NAME STR_VAR spell_name = ~CLERIC_ENTROPY_SHIELD~ RET spell_res END
  COPY_EXISTING ~%spell_res%.spl~ ~override/d5bp615.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 6
	WRITE_BYTE 0x27 1
	LPF DELETE_EFFECT INT_VAR match_opcode = 83 match_parameter2 = 55 END
	LPF CLONE_EFFECT INT_VAR multi_match = 1 match_opcode = 318 opcode = 101 parameter2 = 58 END
	LPF CLONE_EFFECT INT_VAR multi_match = 1 match_opcode = 318 STR_VAR resource = ~spwi513~ END
	LPF CLONE_EFFECT INT_VAR multi_match = 1 match_opcode = 318 STR_VAR resource = ~spwi910~ END
	LPF CLONE_EFFECT INT_VAR multi_match = 1 match_opcode = 318 opcode = 328 parameter1 = 0 parameter2 = 66 special = 1 STR_VAR resource = ~EFF_E04~ END
	LPF CLONE_EFFECT INT_VAR multi_match = 1 match_opcode = 318 opcode = 328 parameter1 = 0 parameter2 = 66 special = 1 STR_VAR resource = ~EFF_M02~ END
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp615~ cast_spell = EVAL ~%spell_res%~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $jester_free_spells(~d5bp615~) ~1~
END
ACTION_IF (spell_ids = 0 - 1) BEGIN
  COPY ~might_and_guile/nubards/d5bp615.spl~ ~override~
	SAY NAME1 @40909
	SAY UNIDENTIFIED_DESC @40910
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 6
	WRITE_BYTE 0x27 1
	LPF DELETE_EFFECT INT_VAR match_opcode = 83 match_parameter2 = 55 END
	LPF CLONE_EFFECT INT_VAR multi_match = 1 match_opcode = 318 opcode = 101 parameter2 = 58 END
	LPF CLONE_EFFECT INT_VAR multi_match = 1 match_opcode = 318 STR_VAR resource = ~spwi513~ END
	LPF CLONE_EFFECT INT_VAR multi_match = 1 match_opcode = 318 STR_VAR resource = ~spwi910~ END
	LPF CLONE_EFFECT INT_VAR multi_match = 1 match_opcode = 318 opcode = 328 parameter1 = 0 parameter2 = 66 special = 1 STR_VAR resource = ~EFF_E04~ END
	LPF CLONE_EFFECT INT_VAR multi_match = 1 match_opcode = 318 opcode = 328 parameter1 = 0 parameter2 = 66 special = 1 STR_VAR resource = ~EFF_M02~ END
  COPY ~might_and_guile/nubards/sppr615b.bam~ ~override~
  COPY ~might_and_guile/nubards/#entropy.vvc~ ~override~
  COPY ~might_and_guile/nubards/eshielc.bam~ ~override~
  COPY ~might_and_guile/nubards/aft_p03.wav~ ~override~
  COPY ~might_and_guile/nubards/abjurh.vvc~ ~override~
  COPY ~might_and_guile/nubards/abjurh.bam~ ~override~
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp615~ cast_spell = ~d5bp615~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $jester_free_spells(~d5bp615~) ~1~
END

// SKALD:

// Remove Fear:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr108.spl~ BEGIN
  COPY_EXISTING ~sppr108.spl~ ~override/d5bp108.spl~
	WRITE_SHORT 0x1c 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp108~ cast_spell = ~sppr108~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $skald_free_spells(~d5bp108~) ~1~
END

// Flame Blade:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr206.spl~ BEGIN
  COPY_EXISTING ~sppr206.spl~ ~override/d5bp206.spl~
	WRITE_SHORT 0x1c 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp206~ cast_spell = ~sppr206~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $skald_free_spells(~d5bp206~) ~1~
END

// DUHM:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr214.spl~ BEGIN
  COPY_EXISTING ~sppr214.spl~ ~override/d5bp214.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 3
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp214~ cast_spell = ~sppr214~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $skald_free_spells(~d5bp214~) ~1~
END

// Def. Harmony:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr406.spl~ BEGIN
  COPY_EXISTING ~sppr406.spl~ ~override/d5bp406.spl~
	WRITE_SHORT 0x1c 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp406~ cast_spell = ~sppr406~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $skald_free_spells(~d5bp406~) ~1~
END

// Righteous Magic:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr513.spl~ BEGIN
  COPY_EXISTING ~sppr513.spl~ ~override/d5bp513.spl~
	WRITE_SHORT 0x1c 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp513~ cast_spell = ~sppr513~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $skald_free_spells(~d5bp513~) ~1~
END

// Magic Resistance:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr509.spl~ BEGIN
  COPY_EXISTING ~sppr509.spl~ ~override/d5bp509.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 6
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp509~ cast_spell = ~sppr509~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $skald_free_spells(~d5bp509~) ~1~
END

// Blade Barrier:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr603.spl~ BEGIN
  COPY_EXISTING ~sppr603.spl~ ~override/d5bp603.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 7
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp603~ cast_spell = ~sppr603~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $skald_free_spells(~d5bp603~) ~1~
END

// GALLANT:

// Armor of Faith:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr111.spl~ BEGIN
  COPY_EXISTING ~sppr111.spl~ ~override/d5bp111.spl~
	WRITE_SHORT 0x1c 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp111~ cast_spell = ~sppr111~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $gallant_free_spells(~d5bp111~) ~1~
END

// Aid:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr201.spl~ BEGIN
  COPY_EXISTING ~sppr201.spl~ ~override/d5bp201.spl~
	WRITE_SHORT 0x1c 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp201~ cast_spell = ~sppr201~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $gallant_free_spells(~d5bp201~) ~1~
END

// Cure Disease:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr317.spl~ BEGIN
  COPY_EXISTING ~sppr317.spl~ ~override/d5bp317.spl~
	WRITE_SHORT 0x1c 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp317~ cast_spell = ~sppr317~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $gallant_free_spells(~d5bp317~) ~1~
END

// Pro Evil 10':
ACTION_IF FILE_EXISTS_IN_GAME ~sppr408.spl~ BEGIN
  COPY_EXISTING ~sppr408.spl~ ~override/d5bp408.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 4
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp408~ cast_spell = ~sppr408~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $gallant_free_spells(~d5bp408~) ~1~
END

// NPP - level 5:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr413.spl~ BEGIN
  COPY_EXISTING ~sppr413.spl~ ~override/d5bp413.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 5
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp413~ cast_spell = ~sppr413~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $gallant_free_spells(~d5bp413~) ~1~
END

// Mass Cure - level 6:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr514.spl~ BEGIN
  COPY_EXISTING ~sppr514.spl~ ~override/d5bp514.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 6
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp514~ cast_spell = ~sppr514~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $gallant_free_spells(~d5bp514~) ~1~
END

OUTER_SPRINT $gallant_free_spells(~spwi113~) ~1~

// MEISTERSINGER:

// Entangle:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr105.spl~ BEGIN
  COPY_EXISTING ~sppr105.spl~ ~override/d5bp105.spl~
	WRITE_SHORT 0x1c 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp105~ cast_spell = ~sppr105~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $meister_free_spells(~d5bp105~) ~1~
END

// Goodberry:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr207.spl~ BEGIN
  COPY_EXISTING ~sppr207.spl~ ~override/d5bp207.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp207~ cast_spell = ~sppr207~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $meister_free_spells(~d5bp207~) ~1~
END

// Barkskin:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr202.spl~ BEGIN
  COPY_EXISTING ~sppr202.spl~ ~override/d5bp202.spl~
	WRITE_SHORT 0x1c 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp202~ cast_spell = ~sppr202~ spell_type = ~arcane~ END
   END
 OUTER_SPRINT $meister_free_spells(~d5bp202~) ~1~
END

// ZoSA:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr318.spl~ BEGIN
  COPY_EXISTING ~sppr318.spl~ ~override/d5bp318.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 2
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp318~ cast_spell = ~sppr318~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $meister_free_spells(~d5bp318~) ~1~
END

// IWD Thorn Spray
OUTER_SET spell_ids = IDS_OF_SYMBOL (~spell~ ~CLERIC_THORN_SPRAY~)
ACTION_IF !(spell_ids = 0 - 1) BEGIN
  LAF RES_NUM_OF_SPELL_NAME STR_VAR spell_name = ~CLERIC_THORN_SPRAY~ RET spell_res END
  COPY_EXISTING ~%spell_res%.spl~ ~override/d5bp427.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 3
	WRITE_ASCII 0x3a ~sppr427b~ #8
	LPF ALTER_SPELL_HEADER STR_VAR icon = ~sppr427b~ END
  COPY_EXISTING ~%spell_res%.spl~ ~override~
	LPF ALTER_EFFECT INT_VAR match_opcode = 12 dicenumber = 4 /*dicesize = 8*/ END
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp427~ cast_spell = EVAL ~%spell_res%~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $meister_free_spells(~d5bp427~) ~1~
END
ACTION_IF (spell_ids = 0 - 1) BEGIN
  ADD_PROJECTILE ~might_and_guile/nubards/IDPRO303.pro~
  COPY ~might_and_guile/nubards/d5bp427.spl~ ~override~
	SAY NAME1 @40911
	SAY UNIDENTIFIED_DESC @40912
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 3
	WRITE_ASCII 0x3a ~sppr427b~ #8
	LPF ALTER_SPELL_HEADER STR_VAR icon = ~sppr427b~ END
	LPF ALTER_SPELL_HEADER INT_VAR projectile = %IDPRO303% END
	LPF ALTER_EFFECT INT_VAR match_opcode = 12 dicenumber = 4 decesize = 8 END
  COPY ~might_and_guile/nubards/sppr427b.bam~ ~override~
  COPY ~might_and_guile/nubards/sppr427c.bam~ ~override~
  COPY ~might_and_guile/nubards/tsprayt.bam~ ~override~
  COPY ~might_and_guile/nubards/#tra_61.wav~ ~override~
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp427~ cast_spell = ~d5bp427~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $meister_free_spells(~d5bp427~) ~1~
END

// IWD Spike Growth
OUTER_SET spell_ids = IDS_OF_SYMBOL (~spell~ ~CLERIC_SPIKE_GROWTH~)
ACTION_IF !(spell_ids = 0 - 1) BEGIN
  LAF RES_NUM_OF_SPELL_NAME STR_VAR spell_name = ~CLERIC_SPIKE_GROWTH~ RET spell_res END
  COPY_EXISTING ~%spell_res%.spl~ ~override/d5bp324.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 4
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp324~ cast_spell = EVAL ~%spell_res%~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $meister_free_spells(~d5bp324~) ~1~
END
ACTION_IF (spell_ids = 0 - 1) BEGIN
//  COPY ~might_and_guile/nubards/IDPRO300.pro~ ~override~
  ADD_PROJECTILE ~might_and_guile/nubards/IDPRO300.pro~
  COPY ~might_and_guile/nubards/d5bp324.spl~ ~override~
	SAY NAME1 @40913
	SAY UNIDENTIFIED_DESC @40914
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 4
	LPF ALTER_SPELL_HEADER INT_VAR projectile = %IDPRO300% END
  COPY ~might_and_guile/nubards/sppr324b.bam~ ~override~
  COPY ~might_and_guile/nubards/sppr324c.bam~ ~override~
  COPY ~might_and_guile/nubards/sgrowta.bam~ ~override~
  COPY ~might_and_guile/nubards/sgrowtx.bam~ ~override~
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp324~ cast_spell = ~d5bp324~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $meister_free_spells(~d5bp324~) ~1~
END

// Woodland Beings:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr410.spl~ BEGIN
  COPY_EXISTING ~sppr410.spl~ ~override/d5bp410.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 5
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp410~ cast_spell = ~sppr410~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $meister_free_spells(~d5bp410~) ~1~
END

// Nature's Beauty:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr704.spl~ BEGIN
  COPY_EXISTING ~sppr704.spl~ ~override/d5bp704.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 6
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp704~ cast_spell = ~sppr704~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $meister_free_spells(~d5bp704~) ~1~
END

ACTION_IF (FILE_EXISTS_IN_GAME ~dvsrv4here.mrk~) BEGIN
// SR AS 1
  OUTER_SET spell_ids = IDS_OF_SYMBOL (~spell~ ~CLERIC_ANIMAL_SUMMONING_LEVEL_1~)
  ACTION_IF !(spell_ids = 0 - 1) BEGIN
    LAF RES_NUM_OF_SPELL_NAME STR_VAR spell_name = ~CLERIC_ANIMAL_SUMMONING_LEVEL_1~ RET spell_res END
    COPY_EXISTING ~%spell_res%.spl~ ~override/d5bp149.spl~
	  WRITE_SHORT 0x1c 1
    ACTION_IF (d5_bards_5E_casting = 1) BEGIN
      LAF add_semi_spells STR_VAR new_spell = ~d5bp149~ cast_spell = EVAL ~%spell_res%~ spell_type = ~arcane~ END
    END
    OUTER_SPRINT $meister_free_spells(~d5bp149~) ~1~
  END

// SR AS 2
  OUTER_SET spell_ids = IDS_OF_SYMBOL (~spell~ ~CLERIC_ANIMAL_SUMMONING_LEVEL_2~)
  ACTION_IF !(spell_ids = 0 - 1) BEGIN
    LAF RES_NUM_OF_SPELL_NAME STR_VAR spell_name = ~CLERIC_ANIMAL_SUMMONING_LEVEL_2~ RET spell_res END
    COPY_EXISTING ~%spell_res%.spl~ ~override/d5bp249.spl~
	  WRITE_SHORT 0x1c 1
    ACTION_IF (d5_bards_5E_casting = 1) BEGIN
      LAF add_semi_spells STR_VAR new_spell = ~d5bp249~ cast_spell = EVAL ~%spell_res%~ spell_type = ~arcane~ END
    END
    OUTER_SPRINT $meister_free_spells(~d5bp249~) ~1~
  END

// SR AS 3
  OUTER_SET spell_ids = IDS_OF_SYMBOL (~spell~ ~CLERIC_ANIMAL_SUMMONING_LEVEL_3~)
  ACTION_IF !(spell_ids = 0 - 1) BEGIN
    LAF RES_NUM_OF_SPELL_NAME STR_VAR spell_name = ~CLERIC_ANIMAL_SUMMONING_LEVEL_3~ RET spell_res END
    COPY_EXISTING ~%spell_res%.spl~ ~override/d5bp349.spl~
	  WRITE_SHORT 0x1c 1
    ACTION_IF (d5_bards_5E_casting = 1) BEGIN
      LAF add_semi_spells STR_VAR new_spell = ~d5bp349~ cast_spell = EVAL ~%spell_res%~ spell_type = ~arcane~ END
    END
    OUTER_SPRINT $meister_free_spells(~d5bp349~) ~1~
  END

// SR AS 4
  OUTER_SET spell_ids = IDS_OF_SYMBOL (~spell~ ~CLERIC_ANIMAL_SUMMONING_LEVEL_4~)
  ACTION_IF !(spell_ids = 0 - 1) BEGIN
    LAF RES_NUM_OF_SPELL_NAME STR_VAR spell_name = ~CLERIC_ANIMAL_SUMMONING_LEVEL_4~ RET spell_res END
    COPY_EXISTING ~%spell_res%.spl~ ~override/d5bp449.spl~
	  WRITE_SHORT 0x1c 1
    ACTION_IF (d5_bards_5E_casting = 1) BEGIN
      LAF add_semi_spells STR_VAR new_spell = ~d5bp449~ cast_spell = EVAL ~%spell_res%~ spell_type = ~arcane~ END
    END
    OUTER_SPRINT $meister_free_spells(~d5bp449~) ~1~
  END

// SR AS 5
  OUTER_SET spell_ids = IDS_OF_SYMBOL (~spell~ ~CLERIC_ANIMAL_SUMMONING_LEVEL_5~)
  ACTION_IF !(spell_ids = 0 - 1) BEGIN
    LAF RES_NUM_OF_SPELL_NAME STR_VAR spell_name = ~CLERIC_ANIMAL_SUMMONING_LEVEL_5~ RET spell_res END
    COPY_EXISTING ~%spell_res%.spl~ ~override/d5bp549.spl~
	  WRITE_SHORT 0x1c 1
    ACTION_IF (d5_bards_5E_casting = 1) BEGIN
      LAF add_semi_spells STR_VAR new_spell = ~d5bp549~ cast_spell = EVAL ~%spell_res%~ spell_type = ~arcane~ END
    END
    OUTER_SPRINT $meister_free_spells(~d5bp549~) ~1~
  END

// SR AS 6
  OUTER_SET spell_ids = IDS_OF_SYMBOL (~spell~ ~CLERIC_ANIMAL_SUMMONING_LEVEL_6~)
  ACTION_IF !(spell_ids = 0 - 1) BEGIN
    LAF RES_NUM_OF_SPELL_NAME STR_VAR spell_name = ~CLERIC_ANIMAL_SUMMONING_LEVEL_6~ RET spell_res END
    COPY_EXISTING ~%spell_res%.spl~ ~override/d5bp649.spl~
	  WRITE_SHORT 0x1c 1
    ACTION_IF (d5_bards_5E_casting = 1) BEGIN
      LAF add_semi_spells STR_VAR new_spell = ~d5bp649~ cast_spell = EVAL ~%spell_res%~ spell_type = ~arcane~ END
    END
    OUTER_SPRINT $meister_free_spells(~d5bp649~) ~1~
  END

// SR AS 7
  OUTER_SET spell_ids = IDS_OF_SYMBOL (~spell~ ~CLERIC_ANIMAL_SUMMONING_LEVEL_7~)
  ACTION_IF !(spell_ids = 0 - 1) BEGIN
    LAF RES_NUM_OF_SPELL_NAME STR_VAR spell_name = ~CLERIC_ANIMAL_SUMMONING_LEVEL_7~ RET spell_res END
    COPY_EXISTING ~%spell_res%.spl~ ~override/d5bp749.spl~
	  WRITE_SHORT 0x1c 1
    ACTION_IF (d5_bards_5E_casting = 1) BEGIN
      LAF add_semi_spells STR_VAR new_spell = ~d5bp749~ cast_spell = EVAL ~%spell_res%~ spell_type = ~arcane~ END
    END
    OUTER_SPRINT $meister_free_spells(~d5bp749~) ~1~
  END
END

ACTION_IF !(FILE_EXISTS_IN_GAME ~dvsrv4here.mrk~) BEGIN
// AS I:
  ACTION_IF FILE_EXISTS_IN_GAME ~sppr402.spl~ BEGIN
	COPY_EXISTING ~sppr402.spl~ ~override/d5bp402.spl~
	  WRITE_SHORT 0x1c 1
    ACTION_IF (d5_bards_5E_casting = 1) BEGIN
      LAF add_semi_spells STR_VAR new_spell = ~d5bp402~ cast_spell = ~sppr402~ spell_type = ~arcane~ END
    END
    OUTER_SPRINT $meister_free_spells(~d5bp402~) ~1~
  END

// ASII:
  ACTION_IF FILE_EXISTS_IN_GAME ~sppr501.spl~ BEGIN
	COPY_EXISTING ~sppr501.spl~ ~override/d5bp501.spl~
	  WRITE_SHORT 0x1c 1
    ACTION_IF (d5_bards_5E_casting = 1) BEGIN
      LAF add_semi_spells STR_VAR new_spell = ~d5bp501~ cast_spell = ~sppr501~ spell_type = ~arcane~ END
    END
    OUTER_SPRINT $meister_free_spells(~d5bp501~) ~1~
  END

// AS III:
  ACTION_IF FILE_EXISTS_IN_GAME ~sppr602.spl~ BEGIN
	COPY_EXISTING ~sppr602.spl~ ~override/d5bp602.spl~
	  WRITE_SHORT 0x1c 1
    ACTION_IF (d5_bards_5E_casting = 1) BEGIN
      LAF add_semi_spells STR_VAR new_spell = ~d5bp602~ cast_spell = ~sppr602~ spell_type = ~arcane~ END
    END
    OUTER_SPRINT $meister_free_spells(~d5bp602~) ~1~
  END
END

// JINXER:

// Doom:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr113.spl~ BEGIN
  COPY_EXISTING ~sppr113.spl~ ~override/d5bp113.spl~
	WRITE_SHORT 0x1c 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp113~ cast_spell = ~sppr113~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $jinxer_free_spells(~d5bp113~) ~1~
END

// IWD Curse:
COPY ~might_and_guile/nubards/d5curse.spl~ ~override/d5bp112.spl~
	SAY NAME1 @40903
	SAY UNIDENTIFIED_DESC @40904
	WRITE_LONG 0x34 2
	WRITE_ASCII 0x3a ~SPPR112C~ #8
	LPF ALTER_SPELL_HEADER INT_VAR projectile = 171 STR_VAR icon = ~SPPR112B~ END
COPY ~might_and_guile/nubards/sppr112c.bam~ ~override~
COPY ~might_and_guile/nubards/sppr112b.bam~ ~override~
ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp112~ cast_spell = ~d5bp112~ spell_type = ~arcane~ END
END
OUTER_SPRINT $jinxer_free_spells(~d5bp112~) ~1~

// Spiritual Clarity/Break Enchantment:
ACTION_IF !(FILE_EXISTS_IN_GAME ~dvsrv4here.mrk~) AND (FILE_EXISTS_IN_GAME ~sppr350.spl~) BEGIN
  COPY_EXISTING ~sppr350.spl~ ~override/d5bp350.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 3
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp350~ cast_spell = ~sppr350~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $jinxer_free_spells(~d5bp350~) ~1~
END
ACTION_IF (FILE_EXISTS_IN_GAME ~dvsrv4here.mrk~) AND (FILE_EXISTS_IN_GAME ~spwi410.spl~) BEGIN
  COPY_EXISTING ~spwi410.spl~ ~override/d5bp350.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 4
	LPF ALTER_SPELL_HEADER INT_VAR speed = 3 END  
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp350~ cast_spell = ~spwi410~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $jinxer_free_spells(~d5bp350~) ~1~
END

// Greater Malison:
ACTION_IF FILE_EXISTS_IN_GAME ~spwi412.spl~ BEGIN
  COPY_EXISTING ~spwi412.spl~ ~override/d5bw412.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 4
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bw412~ cast_spell = ~spwi412~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $jinxer_free_spells(~d5bw412~) ~1~
END

// Pixie Dust:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr516.spl~ BEGIN
  COPY_EXISTING ~sppr516.spl~ ~override/d5bp516.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 5
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp516~ cast_spell = ~sppr516~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $jinxer_free_spells(~d5bp516~) ~1~
END

// Insect Plague - level 6:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr517.spl~ BEGIN
  COPY_EXISTING ~sppr517.spl~ ~override/d5bp517.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 6
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp517~ cast_spell = ~sppr517~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $jinxer_free_spells(~d5bp517~) ~1~
END

// ELEGIST:

// Spirit Ward:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr150.spl~ BEGIN
  COPY_EXISTING ~sppr150.spl~ ~override/d5bp150.spl~
	WRITE_SHORT 0x1c 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp150~ cast_spell = ~sppr150~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $elegist_free_spells(~d5bp150~) ~1~
END

// Chant:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr203.spl~ BEGIN
  COPY_EXISTING ~sppr203.spl~ ~override/d5bp203.spl~
	WRITE_SHORT 0x1c 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~~ cast_spell = ~~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $elegist_free_spells(~~) ~1~
END

// Spirit Fire:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr450.spl~ BEGIN
  COPY_EXISTING ~sppr450.spl~ ~override/d5bp450.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 3
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~~ cast_spell = ~~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $elegist_free_spells(~~) ~1~
END

// Death Ward:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr409.spl~ BEGIN
  COPY_EXISTING ~sppr409.spl~ ~override/d5bp409.spl~
	WRITE_SHORT 0x1c 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~~ cast_spell = ~~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $elegist_free_spells(~~) ~1~
END

// Slay Living:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr511.spl~ BEGIN
  COPY_EXISTING ~sppr511.spl~ ~override/d5bp511.spl~
	WRITE_SHORT 0x1c 1
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp511~ cast_spell = ~sppr511~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $elegist_free_spells(~d5bp511~) ~1~
END

// Recall Spirit - level 6:
ACTION_IF FILE_EXISTS_IN_GAME ~sppr550.spl~ BEGIN
  COPY_EXISTING ~sppr550.spl~ ~override/d5bp550.spl~
	WRITE_SHORT 0x1c 1
	WRITE_LONG 0x34 6
  ACTION_IF (d5_bards_5E_casting = 1) BEGIN
    LAF add_semi_spells STR_VAR new_spell = ~d5bp550~ cast_spell = ~sppr550~ spell_type = ~arcane~ END
  END
  OUTER_SPRINT $elegist_free_spells(~d5bp550~) ~1~
END


// apply free spells__________________________________________________________________
//
ACTION_PHP_EACH bard_free_spells AS spl => ind BEGIN
  LAF free_known_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zjstr~ END
END
ACTION_PHP_EACH bard_free_spells AS spl => ind BEGIN
  LAF free_known_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zskld~ END
END
ACTION_PHP_EACH bard_free_spells AS spl => ind BEGIN
  LAF free_known_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zglnt~ END
END
ACTION_PHP_EACH bard_free_spells AS spl => ind BEGIN
  LAF free_known_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zmstr~ END
END
ACTION_PHP_EACH bard_free_spells AS spl => ind BEGIN
  LAF free_known_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zjinx~ END
END
ACTION_PHP_EACH bard_free_spells AS spl => ind BEGIN
  LAF free_known_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zeleg~ END
END
ACTION_PHP_EACH bard_free_spells AS spl => ind BEGIN
  LAF free_known_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zblde~ END
END
ACTION_PHP_EACH bard_free_spells AS spl => ind BEGIN
  LAF free_known_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zagnt~ END
END
ACTION_PHP_EACH bard_free_spells AS spl => ind BEGIN
  LAF free_known_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zblds~ END
END

ACTION_IF (d5_bards_5E_casting = 1) BEGIN
  ACTION_PHP_EACH bard_free_spells AS spl => ind BEGIN
    LAF free_cast_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zbard~ END
  END
  ACTION_PHP_EACH jester_free_spells AS spl => ind BEGIN
    LAF free_cast_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zjstr~ END
  END
  ACTION_PHP_EACH skald_free_spells AS spl => ind BEGIN
    LAF free_cast_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zskld~ END
  END
  ACTION_PHP_EACH gallant_free_spells AS spl => ind BEGIN
    LAF free_cast_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zglnt~ END
  END
  ACTION_PHP_EACH meister_free_spells AS spl => ind BEGIN
    LAF free_cast_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zmstr~ END
  END
  ACTION_PHP_EACH jinxer_free_spells AS spl => ind BEGIN
    LAF free_cast_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zjinx~ END
  END
  ACTION_PHP_EACH elegist_free_spells AS spl => ind BEGIN
    LAF free_cast_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zeleg~ END
  END

  ACTION_FOR_EACH kit_spl IN ~d5zbard~ ~d5zjstr~ ~d5zskld~ ~d5zglnt~ ~d5zmstr~ ~d5zjinx~ ~d5zeleg~ BEGIN
    COPY_EXISTING ~%kit_spl%.spl~ ~override~
      LPF ADD_SPELL_EFFECT INT_VAR opcode = 206 target = 1 parameter1 = (0 - 1) timing = 9 STR_VAR resource = EVAL ~%kit_spl%~ END
    IF_EXISTS BUT_ONLY
  END

//  COPY_EXISTING ~d5zzini.spl~ ~override~ 
  COPY_EXISTING ~d5zltmbz.spl~ ~override~ 
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_bard_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zbard~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_jester_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zjstr~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_skald_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zskld~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_gallant_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zglnt~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_meister_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zmstr~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_jinxer_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zjinx~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_hexblade_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zjinx~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_elegist_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zeleg~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_blade_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zblde~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_agent_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zagnt~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_bladesinger_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zblds~ END

  ACTION_IF (FILE_CONTAINS_EVALUATED (~splstate.ids~ ~D5_SEMI_ARCANE~)) BEGIN
    COPY_EXISTING ~splstate.ids~ ~override~
	  COUNT_2DA_COLS cols
	  READ_2DA_ENTRIES_NOW rows cols
	  FOR (row = 1; row < rows; ++row) BEGIN
	    READ_2DA_ENTRY_FORMER rows row 1 ~state_name~
	    READ_2DA_ENTRY_FORMER rows row 0 ~state_ind~
	    PATCH_IF (~%state_name%~ STRING_EQUAL_CASE ~D5_SEMI_ARCANE~) BEGIN
          SET semi_spont_arcane = %state_ind%
	    END
	  END
    BUT_ONLY
  END
  ACTION_IF !(VARIABLE_IS_SET %semi_spont_arcane%) BEGIN
    LAF d5_resolve_state STR_VAR new_state_id = ~D5_SEMI_ARCANE~ RET new_state_ind END
    OUTER_SET semi_spont_arcane = %new_state_ind%
  END

  COPY ~might_and_guile/lib/semi_spont/d5_base.spl~ ~override/d5zbd00.spl~
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_bard_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zbard~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_jester_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zjstr~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_skald_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zskld~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_gallant_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zglnt~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_meister_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zmstr~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_jinxer_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zjinx~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_hexblade_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zjinx~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_elegist_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zeleg~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_blade_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zblde~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_agent_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zagnt~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_bladesinger_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zblds~ END
	LPF ADD_SPELL_EFFECT INT_VAR insert_point = 0 opcode = 318 target = 1 parameter1 = %semi_spont_arcane% parameter2 = 111 timing = 0 duration = 1 STR_VAR resource = ~d5zbd00~ END

  ACTION_PHP_EACH bard_kits_list AS clab => kind BEGIN
    ACTION_IF !(~%kind%~ STRING_EQUAL_CASE ~w~) BEGIN
      ACTION_IF (FILE_EXISTS_IN_GAME ~%clab%.2da~) BEGIN
        APPEND ~%clab%.2da~ ~BARD_CAST   AP_D5ZBD00  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****       ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****  ~
      END
    END
  END

END

ACTION_IF (d5_bards_5E_casting = 0) BEGIN
  ACTION_PHP_EACH bard_free_spells AS spl => ind BEGIN
    LAF free_known_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zbard~ END
  END
  ACTION_PHP_EACH jester_free_spells AS spl => ind BEGIN
    LAF free_known_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zjstr~ END
  END
  ACTION_PHP_EACH skald_free_spells AS spl => ind BEGIN
    LAF free_known_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zskld~ END
  END
  ACTION_PHP_EACH gallant_free_spells AS spl => ind BEGIN
    LAF free_known_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zglnt~ END
  END
  ACTION_PHP_EACH meister_free_spells AS spl => ind BEGIN
    LAF free_known_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zmstr~ END
  END
  ACTION_PHP_EACH jinxer_free_spells AS spl => ind BEGIN
    LAF free_known_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zjinx~ END
  END
  ACTION_PHP_EACH elegist_free_spells AS spl => ind BEGIN
    LAF free_known_spells STR_VAR free_spell = EVAL ~%spl%~ list_spell = ~d5zeleg~ END
  END
  COPY_EXISTING ~d5bsong.spl~ ~override~
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_bard_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zbard~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_jester_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zjstr~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_skald_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zskld~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_gallant_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zglnt~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_meister_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zmstr~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_jinxer_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zjinx~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_hexblade_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zjinx~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_elegist_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zeleg~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_blade_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zblde~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_agent_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zagnt~ END
    LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %nu_bladesinger_code% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5zblds~ END
  IF_EXISTS BUT_ONLY
END


/* ...give this vv to bards in place of Vocalize
// Declamation (targetable Vocalize):
COPY ~might_and_guile/nubards/d5bdvoc.spl~ ~override~
	SAY NAME1 @40901
	SAY UNIDENTIFIED_DESC @40902
*/

ACTION_IF (d5_bards_5E_casting = 1) BEGIN
 LAF process_semi_spells END

 ACTION_IF !(FILE_EXISTS_IN_GAME ~d5__semi_spont_sequencers.d5~) BEGIN
  LAF semi_spont_sequencers END
  
  ACTION_IF (FILE_EXISTS_IN_GAME ~qdtnb_metamagic.qd~) BEGIN
    ACTION_FOR_EACH seq_spl IN ~d5_seq1~ ~d5_seq2~ ~d5_seq3~ BEGIN
      COPY_EXISTING ~%seq_spl%.spl~ ~override~
        LPF DELETE_EFFECT INT_VAR match_opcode = 172 STR_VAR match_resource = EVAL ~%seq_spl%~ END
      IF_EXISTS BUT_ONLY
    END
    ACTION_FOR_EACH seq_seq IN ~spwi420d~ ~spwi420p~ ~spwi710d~ ~spwi710p~ ~spwi809d~ ~spwi809p~ BEGIN
      COPY_EXISTING ~%seq_seq%.spl~ ~override~
        LPF DELETE_EFFECT INT_VAR match_opcode = 171 STR_VAR match_resource = ~d5_seq1~ END
        LPF DELETE_EFFECT INT_VAR match_opcode = 171 STR_VAR match_resource = ~d5_seq2~ END
        LPF DELETE_EFFECT INT_VAR match_opcode = 171 STR_VAR match_resource = ~d5_seq3~ END
      IF_EXISTS BUT_ONLY
    END
  END
 END

 ACTION_IF !(FILE_EXISTS_IN_GAME ~d5_new_identify.d5~) BEGIN
  LAF semi_spont_identify END
 END

END
//___________________________________________________________________________________



//append nubard.2da to clab tables____________________________________________________
//
// ***** need to re-think whether this split is necessary given changes to init
ACTION_PHP_EACH bard_kits_list AS clab => kind BEGIN
  ACTION_IF (~%kind%~ STRING_EQUAL_CASE ~W~) BEGIN
    ACTION_IF (FILE_EXISTS_IN_GAME ~%clab%.2da~) BEGIN
      COPY_EXISTING ~%clab%.2da~ ~override~
        LPM remove_blank_lines
        APPEND_FILE ~override/d5nubard.2da~
      BUT_ONLY
/*
      ACTION_IF (FILE_EXISTS_IN_GAME ~d5zzini.spl~) BEGIN
        COPY_EXISTING ~d5zzini.spl~ ~override~
          LPF ADD_SPELL_EFFECT INT_VAR insert_point = 1 opcode = 326 target = 1 parameter1 = %clab_1% parameter2 = %kit_is_row% timing = 1 STR_VAR resource = ~d5bsong~ END
      END
*/
/*
      ACTION_IF !(FILE_EXISTS_IN_GAME ~d5zzini.spl~) BEGIN
        APPEND ~%clab%.2da~ ~BARD_SONG   AP_D5BD000  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****       ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****  ~
      END
*/
    END
  END
  ACTION_IF (~%kind%~ STRING_EQUAL_CASE ~C~) BEGIN
    APPEND ~%clab%.2da~ ~BARD_CAST   AP_D5ZZ000  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****       ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****  ~
  END
END

// demibards just get the song init
/*
APPEND ~d5_hrld.2da~ ~BARD_SONG   AP_D5BDB00  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****       ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****  ~
APPEND ~d5_whsl.2da~ ~BARD_SONG   AP_D5BDB00  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****       ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****  ~
APPEND ~d5_lors.2da~ ~BARD_SONG   AP_D5BDB00  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****       ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****  ~
APPEND ~d5_lort.2da~ ~BARD_SONG   AP_D5BDB00  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****       ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****  ~
*/
ACTION_PHP_EACH bard_kits_list AS clab => kind BEGIN
  ACTION_IF !(~%kind%~ STRING_EQUAL_CASE ~w~) BEGIN
    ACTION_IF (FILE_EXISTS_IN_GAME ~%clab%.2da~) BEGIN
	  APPEND ~%clab%.2da~ ~NU_BARDS    AP_D5_1HP   AP_D5_1HP   AP_D5_1HP   AP_D5_1HP   AP_D5_1HP   AP_D5_1HP   AP_D5_1HP   AP_D5_1HP   AP_D5_1HP   AP_D5_1HP   ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        **** ~
//BARD_SONG   AP_D5BD000  ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****       ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****        ****  
	END
  END
END

/*
//remove one slot from some kits______________________________________________________
//
// blade, jinxer have more thief skills
// F/M kits are strong, knock them down too

COPY_EXISTING ~d5_blade.2da~ ~override~
//			  ~d5_jinx.2da~ ~override~
			  ~d5_glnt.2da~ ~override~
			  ~d5_skld.2da~ ~override~
			  ~d5_hxbl.2da~ ~override~
			  ~d5_blads.2da~ ~override~
	READ_2DA_ENTRIES_NOW rows 2
	SET rows_removed = 0
	FOR (row = 1; row < rows; ++row) BEGIN
	  READ_2DA_ENTRY_FORMER rows row 0 line
	  PATCH_IF (~%line%~ STRING_EQUAL_CASE ~SRCSLOTX~) BEGIN
		REMOVE_2DA_ROW (row - rows_removed) cols
		SET rows_removed += 1
	  END
	END
BUT_ONLY
//____________________________________________________________________________________
*/


//KIT DESCRIPTION PATCHES_____________________________________________________________
//
OUTER_SPRINT advantages @1006
OUTER_SPRINT abilities @1007
OUTER_SPRINT disadvantages @1008
OUTER_SPRINT restrictions @1009
OUTER_SPRINT tra_no_sequencer @40985
OUTER_SPRINT tra_no_identify @40986
OUTER_SPRINT tra_5E_casting @40987

COPY_EXISTING ~kitlist.2da~ ~override~
  COUNT_2DA_ROWS 9 rows
  FOR (row = 3; row < rows; row += 1) BEGIN
	READ_2DA_ENTRY row 5 9 kit_clab
	READ_2DA_ENTRY row 4 9 kit_desc
    PHP_EACH bard_kits_list AS clab => kind BEGIN
      PATCH_IF (~%kit_clab%~ STRING_EQUAL_CASE ~%clab%~) BEGIN
        PATCH_IF (~%kind%~ STRING_EQUAL_CASE ~w~) BEGIN
/*
	PATCH_IF (~%kit_clab%~ STRING_EQUAL_CASE ~d5_bard~) OR
	  			(~%kit_clab%~ STRING_EQUAL_CASE ~d5_blade~) OR
	  			(~%kit_clab%~ STRING_EQUAL_CASE ~d5_jstr~) OR
	  			(~%kit_clab%~ STRING_EQUAL_CASE ~d5_skld~) OR
	  			(~%kit_clab%~ STRING_EQUAL_CASE ~d5_glnt~) OR
	  			(~%kit_clab%~ STRING_EQUAL_CASE ~d5_mstr~) OR
	  			(~%kit_clab%~ STRING_EQUAL_CASE ~d5_jinx~) OR
	  			(~%kit_clab%~ STRING_EQUAL_CASE ~d5_hxbl~) OR
	  			(~%kit_clab%~ STRING_EQUAL_CASE ~d5_eleg~) OR
	  			(~%kit_clab%~ STRING_EQUAL_CASE ~d5_agnt~) OR
	  			(~%kit_clab%~ STRING_EQUAL_CASE ~d5_blads~) BEGIN
*/	
	      SET desc = %kit_desc%
		  PATCH_IF (IS_AN_INT %desc%) BEGIN
			PATCH_IF (d5_bards_5E_casting = 1) AND !(FILE_EXISTS_IN_GAME ~qdtnb_identify.qd~) BEGIN
		      GET_STRREF %desc% kit_description
			  INNER_PATCH_SAVE kit_description ~%kit_description%~ BEGIN
				REPLACE_TEXTUALLY ~%restrictions%~ ~%tra_no_identify%~
				REPLACE_TEXTUALLY ~%disadvantages%~ ~%tra_no_identify%~
			  END
			  INNER_ACTION BEGIN
				STRING_SET_EVALUATE %kit_desc% ~%kit_description%~
			  END
			END
			PATCH_IF (d5_bards_5E_casting = 1) AND !(MOD_IS_INSTALLED ~tomeandblood.tp2~ ~55~) BEGIN
		      GET_STRREF %desc% kit_description
			  INNER_PATCH_SAVE kit_description ~%kit_description%~ BEGIN
				REPLACE_TEXTUALLY ~%restrictions%~ ~%tra_no_sequencer%~
				REPLACE_TEXTUALLY ~%disadvantages%~ ~%tra_no_sequencer%~
			  END
			  INNER_ACTION BEGIN
				STRING_SET_EVALUATE %kit_desc% ~%kit_description%~
			  END
			END
			PATCH_IF (d5_bards_5E_casting = 0) BEGIN
		      GET_STRREF %desc% kit_description
		      INNER_PATCH_SAVE kit_description ~%kit_description%~ BEGIN
			    REPLACE_TEXTUALLY ~%tra_5E_casting%~ ~~
		      END
		      INNER_ACTION BEGIN
			    STRING_SET_EVALUATE %kit_desc% ~%kit_description%~
		      END
		    END
		  END
		END
	  END
	END
  END
BUT_ONLY
//____________________________________________________________________________________


//HLA TABLES__________________________________________________________________________
//
// ***** need to change these so they adjust from multi-mage tables instead of thief

// give extra feats as HLAs (up to ... 5?)
//
// make bard HLAs available to these kits
//
// add vocalize aura:
COPY ~might_and_guile/nubards/d5nosil.spl~ ~override~
  SAY NAME1 @40998
  SAY UNIDENTIFIED_DESC @40999
COPY ~might_and_guile/nubards/d5nosil.eff~ ~override~
COPY ~might_and_guile/nubards/d5nosila.spl~ ~override~

ACTION_IF (d5_bards_5E_casting = 1) BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5src1a.spl~) BEGIN
   COPY_EXISTING ~d5src1a.spl~ ~override/d5brds1.spl~
    SAY NAME1 @40991
    SAY UNIDENTIFIED_DESC @40991
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5src2a.spl~) BEGIN
   COPY_EXISTING ~d5src2a.spl~ ~override/d5brds2.spl~
    SAY NAME1 @40992
    SAY UNIDENTIFIED_DESC @40992
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5src3a.spl~) BEGIN
   COPY_EXISTING ~d5src3a.spl~ ~override/d5brds3.spl~
    SAY NAME1 @40993
    SAY UNIDENTIFIED_DESC @40993
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5src4a.spl~) BEGIN
   COPY_EXISTING ~d5src4a.spl~ ~override/d5brds4.spl~
    SAY NAME1 @40994
    SAY UNIDENTIFIED_DESC @40994
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5src5a.spl~) BEGIN
   COPY_EXISTING ~d5src5a.spl~ ~override/d5brds5.spl~
    SAY NAME1 @40995
    SAY UNIDENTIFIED_DESC @40995
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5src6a.spl~) BEGIN
   COPY_EXISTING ~d5src6a.spl~ ~override/d5brds6.spl~
    SAY NAME1 @40996
    SAY UNIDENTIFIED_DESC @40996
  END
  ACTION_IF (FILE_EXISTS_IN_GAME ~d5src7a.spl~) BEGIN
   COPY_EXISTING ~d5src7a.spl~ ~override/d5brds7.spl~
    SAY NAME1 @40997
    SAY UNIDENTIFIED_DESC @40997
  END
END

LAF action_add_hla STR_VAR kit_name = ~D5_BLADE~ ability = ~GA_SPCL900~ num_allowed = ~2~ END			//	whirlwind
LAF action_add_hla STR_VAR kit_name = ~D5_BLADE~ ability = ~GA_SPCL423~ num_allowed = ~2~ END			//	poison weapon
LAF action_remove_hla STR_VAR kit_name = ~D5_BLADE~ remove_ability = ~GA_SPCL905~ END					//	no critical strike
LAF action_remove_hla STR_VAR kit_name = ~D5_BLADE~ remove_ability = ~GA_SPCL906~ END					//	no power attack
ACTION_IF FILE_EXISTS_IN_GAME ~d5__rfeat.d5~ BEGIN
  LAF action_add_hla STR_VAR kit_name = ~D5_BLADE~ ability = ~AP_D5_RFA5~ num_allowed = ~1~ END			//	luck bonus
  LAF action_add_hla STR_VAR kit_name = ~D5_BLADE~ ability = ~AP_D5_RFD3~ num_allowed = ~1~ END			//	spell evasion
  LAF action_add_hla STR_VAR kit_name = ~D5_BLADE~ ability = ~AP_D5_UMD~ num_allowed = ~1~ END			//	use scrolls/wands
  LAF action_add_hla STR_VAR kit_name = ~D5_BLADE~ ability = ~GA_D5FEAT0~ num_allowed = ~3~ END			//	extra feats
END

ACTION_IF FILE_EXISTS_IN_GAME ~d5__rfeat.d5~ BEGIN
  LAF action_add_hla STR_VAR kit_name = ~D5_JESTER~ ability = ~AP_D5_RFA5~ num_allowed = ~2~ END		//	luck bonus
  LAF action_add_hla STR_VAR kit_name = ~D5_JESTER~ ability = ~AP_D5_RFD3~ num_allowed = ~1~ END		//	spell evasion
  LAF action_add_hla STR_VAR kit_name = ~D5_JESTER~ ability = ~AP_D5_RFD5~ num_allowed = ~3~ END		//	saving throw bonus
  LAF action_add_hla STR_VAR kit_name = ~D5_JESTER~ ability = ~GA_D5FEAT0~ num_allowed = ~3~ END		//	extra feats
END

LAF action_add_hla STR_VAR kit_name = ~D5_SKALD~ ability = ~GA_SPCL909~ num_allowed = ~3~ prerequisite = ~AP_SPCL905~ END	//	smite
LAF action_add_hla STR_VAR kit_name = ~D5_SKALD~ ability = ~GA_SPCL902~ num_allowed = ~3~ END				//	death blow
LAF action_add_hla STR_VAR kit_name = ~D5_SKALD~ ability = ~GA_SPCL908~ num_allowed = ~3~ END				//	war cry
LAF action_add_hla STR_VAR kit_name = ~D5_SKALD~ ability = ~GA_SPCL321~ num_allowed = ~1~ END				//	zerk rage
LAF action_remove_hla STR_VAR kit_name = ~D5_SKALD~ remove_ability = ~GA_SPCL913~ END					//	no evasion
ACTION_IF FILE_EXISTS_IN_GAME ~d5__rfeat.d5~ BEGIN
  LAF action_add_hla STR_VAR kit_name = ~D5_SKALD~ ability = ~GA_D5FEAT0~ num_allowed = ~3~ END			//	extra feats
END

LAF action_add_hla STR_VAR kit_name = ~D5_GALLANT~ ability = ~GA_SPCL909~ num_allowed = ~3~ prerequisite = ~AP_SPCL905~ END	//	smite
LAF action_add_hla STR_VAR kit_name = ~D5_GALLANT~ ability = ~GA_SPCL904~ num_allowed = ~1~ END				//	resist magic
LAF action_add_hla STR_VAR kit_name = ~D5_GALLANT~ ability = ~GA_SPCL211~ num_allowed = ~1~ END				//	lay on hands
LAF action_add_hla STR_VAR kit_name = ~D5_GALLANT~ ability = ~GA_SPCL233~ num_allowed = ~3~ END				//	pro. evil 10' radius
LAF action_remove_hla STR_VAR kit_name = ~D5_GALLANT~ remove_ability = ~GA_SPCL913~ END					//	no evasion
ACTION_IF FILE_EXISTS_IN_GAME ~d5__rfeat.d5~ BEGIN
  LAF action_add_hla STR_VAR kit_name = ~D5_GALLANT~ ability = ~GA_D5FEAT0~ num_allowed = ~3~ END		//	extra feats
END

LAF action_add_hla STR_VAR kit_name = ~D5_HERALD~ ability = ~GA_SPCL907~ num_allowed = ~1~ END				//	resist magic
LAF action_add_hla STR_VAR kit_name = ~D5_HERALD~ ability = ~GA_SPCL904~ num_allowed = ~1~ END				//	hardiness
LAF action_add_hla STR_VAR kit_name = ~D5_HERALD~ ability = ~GA_SPCL908~ num_allowed = ~3~ END				//	war cry
ACTION_IF FILE_EXISTS_IN_GAME ~d5__rfeat.d5~ BEGIN
  LAF action_add_hla STR_VAR kit_name = ~D5_HERALD~ ability = ~AP_D5_RFA5~ num_allowed = ~1~ END		//	luck bonus
  LAF action_add_hla STR_VAR kit_name = ~D5_HERALD~ ability = ~AP_D5_RFD3~ num_allowed = ~1~ END		//	spell evasion
//  LAF action_add_hla STR_VAR kit_name = ~D5_HERALD~ ability = ~AP_D5_WFA2~ num_allowed = ~1~ excluded_by = ~AP_D5_WFA3~ END		//	offensive tactics
//  LAF action_add_hla STR_VAR kit_name = ~D5_HERALD~ ability = ~AP_D5_WFA3~ num_allowed = ~1~ excluded_by = ~AP_D5_WFA2~ END		//	defensive tactics
  LAF action_add_hla STR_VAR kit_name = ~D5_HERALD~ ability = ~GA_D5FEAT0~ num_allowed = ~3~ END		//	extra feats
END

LAF action_add_hla STR_VAR kit_name = ~D5_MEISTER~ ability = ~GA_SPCL922~ num_allowed = ~1~ END			//	tracking
LAF action_add_hla STR_VAR kit_name = ~D5_MEISTER~ ability = ~AP_SPCL924~ num_allowed = ~1~ END			//	poison immunity
ACTION_IF FILE_EXISTS_IN_GAME ~d5__rfeat.d5~ BEGIN
  LAF action_add_hla STR_VAR kit_name = ~D5_MEISTER~ ability = ~AP_D5_RFA5~ num_allowed = ~2~ END		//	luck bonus
  LAF action_add_hla STR_VAR kit_name = ~D5_MEISTER~ ability = ~AP_D5_RFD3~ num_allowed = ~1~ END		//	spell evasion
  LAF action_add_hla STR_VAR kit_name = ~D5_MEISTER~ ability = ~AP_D5_UMD~ num_allowed = ~1~ END		//	use scrolls/wands
  LAF action_add_hla STR_VAR kit_name = ~D5_MEISTER~ ability = ~GA_D5FEAT0~ num_allowed = ~3~ END		//	extra feats
END

LAF action_add_hla STR_VAR kit_name = ~D5_JINXER~ ability = ~GA_SPCL914~ num_allowed = ~3~ prerequisite = ~AP_SPCL913~ END	//	greater evasion
LAF action_add_hla STR_VAR kit_name = ~D5_JINXER~ ability = ~AP_SPSD02~ num_allowed = ~3~ END			//	shadowstep
LAF action_add_hla STR_VAR kit_name = ~D5_JINXER~ ability = ~AP_SPCL937~ num_allowed = ~1~ END			//	shadow maze
ACTION_IF FILE_EXISTS_IN_GAME ~d5__rfeat.d5~ BEGIN
  LAF action_add_hla STR_VAR kit_name = ~D5_JINXER~ ability = ~AP_D5_RFA5~ num_allowed = ~1~ END		//	luck bonus
  LAF action_add_hla STR_VAR kit_name = ~D5_JINXER~ ability = ~AP_D5_RFD3~ num_allowed = ~1~ END		//	spell evasion
  LAF action_add_hla STR_VAR kit_name = ~D5_JINXER~ ability = ~AP_D5_RFG5~ num_allowed = ~1~ END		//	fighting dirty
  LAF action_add_hla STR_VAR kit_name = ~D5_JINXER~ ability = ~GA_D5FEAT0~ num_allowed = ~3~ END		//	extra feats
END

LAF action_add_hla STR_VAR kit_name = ~D5_ELEGIST~ ability = ~AP_SPSD02~ num_allowed = ~3~ END			//	shadowstep
LAF action_add_hla STR_VAR kit_name = ~D5_ELEGIST~ ability = ~AP_SPCL937~ num_allowed = ~1~ END			//	shadow maze
LAF action_add_hla STR_VAR kit_name = ~D5_ELEGIST~ ability = ~GA_SPCL902~ num_allowed = ~3~ END			//	death blow
ACTION_IF FILE_EXISTS_IN_GAME ~d5__rfeat.d5~ BEGIN
  LAF action_add_hla STR_VAR kit_name = ~D5_ELEGIST~ ability = ~AP_D5_RFD3~ num_allowed = ~1~ END		//	spell evasion
  LAF action_add_hla STR_VAR kit_name = ~D5_ELEGIST~ ability = ~AP_D5_RFG5~ num_allowed = ~1~ END		//	fighting dirty
  LAF action_add_hla STR_VAR kit_name = ~D5_ELEGIST~ ability = ~GA_D5FEAT0~ num_allowed = ~3~ END		//	extra feats
END

LAF action_add_hla STR_VAR kit_name = ~D5_HEXBLADE~ ability = ~GA_SPCL909~ num_allowed = ~3~ prerequisite = ~AP_SPCL905~ END	//	smite
LAF action_add_hla STR_VAR kit_name = ~D5_HEXBLADE~ ability = ~GA_SPCL902~ num_allowed = ~3~ END				//	death blow
LAF action_add_hla STR_VAR kit_name = ~D5_HEXBLADE~ ability = ~GA_SPCL908~ num_allowed = ~3~ END				//	war cry
LAF action_add_hla STR_VAR kit_name = ~D5_HEXBLADE~ ability = ~GA_SPCL321~ num_allowed = ~1~ END				//	zerk rage
LAF action_remove_hla STR_VAR kit_name = ~D5_HEXBLADE~ remove_ability = ~GA_SPCL913~ END					//	no evasion
ACTION_IF FILE_EXISTS_IN_GAME ~d5__rfeat.d5~ BEGIN
  LAF action_add_hla STR_VAR kit_name = ~D5_HEXBLADE~ ability = ~GA_D5FEAT0~ num_allowed = ~3~ END			//	extra feats
END

LAF action_add_hla STR_VAR kit_name = ~D5_AGENT~ ability = ~GA_SPCL914~ num_allowed = ~3~ prerequisite = ~AP_SPCL913~ END	//	greater evasion
LAF action_add_hla STR_VAR kit_name = ~D5_AGENT~ ability = ~AP_SPSD02~ num_allowed = ~3~ END			//	shadowstep
LAF action_add_hla STR_VAR kit_name = ~D5_AGENT~ ability = ~AP_SPCL937~ num_allowed = ~1~ END			//	shadow maze
ACTION_IF FILE_EXISTS_IN_GAME ~d5__rfeat.d5~ BEGIN
  LAF action_add_hla STR_VAR kit_name = ~D5_AGENT~ ability = ~AP_D5_RFA5~ num_allowed = ~1~ END			//	luck bonus
  LAF action_add_hla STR_VAR kit_name = ~D5_AGENT~ ability = ~AP_D5_RFD3~ num_allowed = ~1~ END			//	spell evasion
  LAF action_add_hla STR_VAR kit_name = ~D5_AGENT~ ability = ~AP_D5_RFG5~ num_allowed = ~1~ END			//	fighting dirty
  LAF action_add_hla STR_VAR kit_name = ~D5_AGENT~ ability = ~GA_D5FEAT0~ num_allowed = ~3~ END			//	extra feats
END

/*
LAF action_add_hla STR_VAR kit_name = ~D5_LORESINGER~ ability = ~GA_SPCL907~ num_allowed = ~1~ END			//	resist magic
ACTION_IF FILE_EXISTS_IN_GAME ~d5__rfeat.d5~ BEGIN
  LAF action_add_hla STR_VAR kit_name = ~D5_LORESINGER~ ability = ~AP_D5_RFA5~ num_allowed = ~2~ END	//	luck bonus
  LAF action_add_hla STR_VAR kit_name = ~D5_LORESINGER~ ability = ~AP_D5_RFD3~ num_allowed = ~1~ END	//	spell evasion
  LAF action_add_hla STR_VAR kit_name = ~D5_LORESINGER~ ability = ~GA_D5FEAT0~ num_allowed = ~3~ END	//	extra feats
END
*/

LAF action_add_hla STR_VAR kit_name = ~D5_BLADESINGER~ ability = ~GA_SPCL907~ num_allowed = ~1~ END				//	resist magic
LAF action_add_hla STR_VAR kit_name = ~D5_BLADESINGER~ ability = ~GA_SPCL904~ num_allowed = ~1~ END				//	hardiness
LAF action_add_hla STR_VAR kit_name = ~D5_BLADESINGER~ ability = ~GA_SPCL908~ num_allowed = ~3~ END				//	war cry
ACTION_IF FILE_EXISTS_IN_GAME ~d5__rfeat.d5~ BEGIN
  LAF action_add_hla STR_VAR kit_name = ~D5_BLADESINGER~ ability = ~AP_D5_RFA5~ num_allowed = ~1~ END		//	luck bonus
  LAF action_add_hla STR_VAR kit_name = ~D5_BLADESINGER~ ability = ~AP_D5_RFD3~ num_allowed = ~1~ END		//	spell evasion
//  LAF action_add_hla STR_VAR kit_name = ~D5_BLADESINGER~ ability = ~AP_D5_WFA2~ num_allowed = ~1~ excluded_by = ~AP_D5_WFA3~ END		//	offensive tactics
//  LAF action_add_hla STR_VAR kit_name = ~D5_BLADESINGER~ ability = ~AP_D5_WFA3~ num_allowed = ~1~ excluded_by = ~AP_D5_WFA2~ END		//	defensive tactics
  LAF action_add_hla STR_VAR kit_name = ~D5_BLADESINGER~ ability = ~GA_D5FEAT0~ num_allowed = ~3~ END		//	extra feats
END

ACTION_IF FILE_EXISTS_IN_GAME ~d5__rfeat.d5~ BEGIN
  LAF action_add_hla STR_VAR kit_name = ~D5_BARD~ ability = ~AP_D5_RFA5~ num_allowed = ~2~ END			//	luck bonus
  LAF action_add_hla STR_VAR kit_name = ~D5_BARD~ ability = ~AP_D5_RFD3~ num_allowed = ~1~ END			//	spell evasion
  LAF action_add_hla STR_VAR kit_name = ~D5_BARD~ ability = ~AP_D5_RFD5~ num_allowed = ~3~ END			//	saving throw bonus
  LAF action_add_hla STR_VAR kit_name = ~D5_BARD~ ability = ~GA_D5FEAT0~ num_allowed = ~3~ END			//	extra feats
END

ACTION_IF FILE_EXISTS_IN_GAME ~RR#BHL01.SPL~ BEGIN
  ACTION_FOR_EACH bard_kit IN ~D5_BARD~ ~D5_BLADE~ ~D5_JESTER~ ~D5_SKALD~ ~D5_GALLANT~ ~D5_HERALD~ ~D5_MEISTER~ ~D5_JINXER~ ~D5_HEXBLADE~ ~D5_AGENT~ /*~D5_LORESINGER~*/ ~D5_BLADESINGER~ BEGIN
// replace spcl921 with RR magic flute
	LAF action_replace_hla STR_VAR kit_name = ~D5_BARD~ remove_ability = ~GA_SPCL921~ ability = ~GA_RR#BHL07~ END
// add other RR HLAs
	LAF action_add_hla STR_VAR kit_name = ~%bard_kit%~ ability = ~GA_RR#BHL01~ num_allowed = ~3~ END		//	mass charm
	LAF action_add_hla STR_VAR kit_name = ~%bard_kit%~ ability = ~GA_RR#BHL02~ num_allowed = ~3~ END		//	enthralling melody
	LAF action_add_hla STR_VAR kit_name = ~%bard_kit%~ ability = ~GA_RR#BHL05~ num_allowed = ~3~ END		//	resonating weapon
	LAF action_add_hla STR_VAR kit_name = ~%bard_kit%~ ability = ~GA_RR#BHL06~ num_allowed = ~3~ END		//	sound barrier
	LAF action_add_hla STR_VAR kit_name = ~%bard_kit%~ ability = ~GA_RR#BHL03~ num_allowed = ~3~ END		//	sound burst
  END
END
//____________________________________________________________________________________


//CHANGE NPC BARDS____________________________________________________________________
//
// do a basic algorithmic change
// then specifically make garrick = gallant and eldoth = jinxer

/* why was this here?
COPY_EXISTING ~kitlist.2da~ ~override~
  COUNT_2DA_ROWS 8 rows
  FOR (row = 3; row < rows; ++row) BEGIN 
	READ_2DA_ENTRY row 1 8 ~kit_name~
	PATCH_IF (~%kit_name%~ STRING_EQUAL_CASE ~D5_BARD~ = 1) BEGIN
	  SET new_bard = %row% - 1
	END
  END
BUT_ONLY
*/

ACTION_PHP_EACH JOINABLE_NPC_ARRAY AS cre => dv BEGIN
//  PRINT ~%cre% => %dv%~ 
  COPY_EXISTING ~%cre%~ ~override~
	PATCH_IF (SOURCE_SIZE > 0x2d3) BEGIN
	  READ_BYTE 0x273 npc_class
	  READ_SHORT 0x246 old_kit
	  PATCH_IF (npc_class = 5) BEGIN
		PATCH_IF (old_kit = 16384) OR
		  		 (old_kit = 0) BEGIN 									// trueclass bards
		  WRITE_BYTE 0x234 1 											// sets level to 1
		  WRITE_BYTE 0x235 1
		  WRITE_BYTE 0x236 1
		  WRITE_BYTE 0x273 13 											// sets class
		  WRITE_SHORT 0x244 (%nu_bard_code% >> 16) & 0xffff
		  WRITE_SHORT 0x246 %nu_bard_code% & 0xffff
		  WRITE_BYTE 0x0045 10
		  WRITE_BYTE 0x0064 5
		  WRITE_BYTE 0x0065 5
		  WRITE_BYTE 0x0066 25
		  WRITE_BYTE 0x0067 5
		  WRITE_BYTE 0x0068 10
		  WRITE_BYTE 0x0069 5
		  WRITE_BYTE 0x006a 5
	 	  READ_BYTE 0x23d npc_con
		  PATCH_IF (npc_con < 15) BEGIN
			WRITE_SHORT 0x24 6
			WRITE_SHORT 0x26 6
		  END
		  PATCH_IF (npc_con = 15) BEGIN
			WRITE_SHORT 0x24 7
			WRITE_SHORT 0x26 7
		  END
		  PATCH_IF (npc_con > 15) BEGIN
			WRITE_SHORT 0x24 8
			WRITE_SHORT 0x26 8
		  END
		END
		PATCH_IF (old_kit = 16397) BEGIN 								// blades
		  WRITE_BYTE 0x234 1 											// sets level to 1
		  WRITE_BYTE 0x235 1
		  WRITE_BYTE 0x236 1
		  WRITE_BYTE 0x273 13 											// sets class
		  WRITE_SHORT 0x244 (%nu_blade_code% >> 16) & 0xffff
		  WRITE_SHORT 0x246 %nu_blade_code% & 0xffff
		  WRITE_BYTE 0x0045 10
		  WRITE_BYTE 0x0064 5
		  WRITE_BYTE 0x0065 5
		  WRITE_BYTE 0x0066 10
		  WRITE_BYTE 0x0067 5
		  WRITE_BYTE 0x0068 10
		  WRITE_BYTE 0x0069 5
		  WRITE_BYTE 0x006a 5
	 	  READ_BYTE 0x23d npc_con
		  PATCH_IF (npc_con < 15) BEGIN
			WRITE_SHORT 0x24 6
			WRITE_SHORT 0x26 6
		  END
		  PATCH_IF (npc_con = 15) BEGIN
			WRITE_SHORT 0x24 7
			WRITE_SHORT 0x26 7
		  END
		  PATCH_IF (npc_con > 15) BEGIN
			WRITE_SHORT 0x24 8
			WRITE_SHORT 0x26 8
		  END
		END
		PATCH_IF (old_kit = 16398) BEGIN 								// jesters
		  WRITE_BYTE 0x234 1 											// sets level to 1
		  WRITE_BYTE 0x235 1
		  WRITE_BYTE 0x236 1
		  WRITE_BYTE 0x273 4 											// sets class
		  WRITE_SHORT 0x244 (%nu_jester_code% >> 16) & 0xffff
		  WRITE_SHORT 0x246 %nu_jester_code% & 0xffff
		  WRITE_BYTE 0x0045 10
		  WRITE_BYTE 0x0064 5
		  WRITE_BYTE 0x0065 5
		  WRITE_BYTE 0x0066 25
		  WRITE_BYTE 0x0067 5
		  WRITE_BYTE 0x0068 10
		  WRITE_BYTE 0x0069 5
		  WRITE_BYTE 0x006a 5
	 	  READ_BYTE 0x23d npc_con
		  PATCH_IF (npc_con < 15) BEGIN
			WRITE_SHORT 0x24 6
			WRITE_SHORT 0x26 6
		  END
		  PATCH_IF (npc_con = 15) BEGIN
			WRITE_SHORT 0x24 7
			WRITE_SHORT 0x26 7
		  END
		  PATCH_IF (npc_con > 15) BEGIN
			WRITE_SHORT 0x24 8
			WRITE_SHORT 0x26 8
		  END
		END
		REMOVE_KNOWN_SPELLS
		REMOVE_MEMORIZED_SPELLS
		PATCH_IF (old_kit = 16399) BEGIN 								//	skalds
// ***** figure out proficiencies... just double for now
		  LPF ALTER_EFFECT INT_VAR silent = 1 match_opcode = 233 match_parameter1 = 1 parameter1 = 2 END
		  WRITE_BYTE 0x234 1 											// sets level to 1
		  WRITE_BYTE 0x235 1
		  WRITE_BYTE 0x236 1
		  WRITE_BYTE 0x273 7											// sets class
		  WRITE_SHORT 0x244 (%nu_skald_code% >> 16) & 0xffff
		  WRITE_SHORT 0x246 %nu_skald_code% & 0xffff
		  WRITE_BYTE 0x0066 25
		  PATCH_IF (npc_con < 15) BEGIN
			WRITE_SHORT 0x24 8
			WRITE_SHORT 0x26 8
		  END
		  PATCH_IF (npc_con = 15) BEGIN
			WRITE_SHORT 0x24 9
			WRITE_SHORT 0x26 9
		  END
		  PATCH_IF (npc_con = 16) BEGIN
			WRITE_SHORT 0x24 10
			WRITE_SHORT 0x26 10
		  END
		  PATCH_IF (npc_con = 17) BEGIN
			WRITE_SHORT 0x24 11
			WRITE_SHORT 0x26 11
		  END
		  PATCH_IF (npc_con > 17) BEGIN
			WRITE_SHORT 0x24 12
			WRITE_SHORT 0x26 12
		  END
		END
		PATCH_IF FILE_EXISTS_IN_GAME ~d5__rfeat.d5~ BEGIN
			LPF ADD_CRE_EFFECT INT_VAR opcode = 171 target = 1 timing = 9 STR_VAR resource = ~d5feata~ END
		END
	  END
	END
  BUT_ONLY
END

ACTION_FOR_EACH char IN ~eldoth~ ~eldoth5~ BEGIN
  ACTION_IF FILE_EXISTS_IN_GAME ~%char%.cre~ BEGIN
	COPY_EXISTING ~%char%.cre~ ~override~
	  WRITE_SHORT 0x244 (%nu_jinxer_code% >> 16) & 0xffff
	  WRITE_SHORT 0x246 %nu_jinxer_code% & 0xffff
	BUT_ONLY
  END
END

ACTION_FOR_EACH char IN ~garric~ ~garric2~ ~garric4~ ~garric6~ BEGIN
  ACTION_IF FILE_EXISTS_IN_GAME ~%char%.cre~ BEGIN
	COPY_EXISTING ~garric2.cre~ ~override/%char%.cre~
		  WRITE_BYTE 0x273 7
		  WRITE_SHORT 0x244 (%nu_gallant_code% >> 16) & 0xffff
		  WRITE_SHORT 0x246 %nu_gallant_code% & 0xffff
	  READ_BYTE 0x23d npc_con
	  PATCH_IF (npc_con < 15) BEGIN
		WRITE_SHORT 0x24 8
		WRITE_SHORT 0x26 8
	  END
	  PATCH_IF (npc_con = 15) BEGIN
		WRITE_SHORT 0x24 9
		WRITE_SHORT 0x26 9
	  END
	  PATCH_IF (npc_con = 16) BEGIN
		WRITE_SHORT 0x24 10
		WRITE_SHORT 0x26 10
	  END
	  PATCH_IF (npc_con = 17) BEGIN
		WRITE_SHORT 0x24 11
		WRITE_SHORT 0x26 11
	  END
	  PATCH_IF (npc_con > 17) BEGIN
		WRITE_SHORT 0x24 12
		WRITE_SHORT 0x26 12
	  END
// ***** figure out proficiencies (just double what's already there??)
	  LPF ALTER_EFFECT INT_VAR silent = 1 match_opcode = 233 match_parameter1 = 1 parameter1 = 2 END
	BUT_ONLY
  END
END
//___________________________________________________________________________________


//QD_MULTICLASS______________________________________________________________________
//
ACTION_IF FILE_EXISTS_IN_GAME ~d5_bard.2da~ BEGIN
  LAF qd_multiclass
	STR_VAR
		kit_name = ~D5_BARD~ 
		kit_clab = ~d5_bard~
		base_class = ~M~
  END
END 
ACTION_IF FILE_EXISTS_IN_GAME ~d5_blade.2da~ BEGIN
  LAF qd_multiclass
	STR_VAR
		kit_name = ~D5_BLADE~ 
		kit_clab = ~d5_blade~
		base_class = ~M~
  END
END 
ACTION_IF FILE_EXISTS_IN_GAME ~d5_jstr.2da~ BEGIN
  LAF qd_multiclass
	STR_VAR
		kit_name = ~D5_JESTER~ 
		kit_clab = ~d5_jstr~
		base_class = ~M~
  END
END 
ACTION_IF FILE_EXISTS_IN_GAME ~d5_skld.2da~ BEGIN
  LAF qd_multiclass
	STR_VAR
		kit_name = ~D5_SKALD~ 
		kit_clab = ~d5_skld~
		base_class = ~M~
  END
END 
ACTION_IF FILE_EXISTS_IN_GAME ~d5_glnt.2da~ BEGIN
  LAF qd_multiclass
	STR_VAR
		kit_name = ~D5_GALLANT~ 
		kit_clab = ~d5_glnt~
		base_class = ~M~
  END
END 
ACTION_IF FILE_EXISTS_IN_GAME ~d5_hrld.2da~ BEGIN
  LAF qd_multiclass
	STR_VAR
		kit_name = ~D5_HERALD~ 
		kit_clab = ~d5_hrld~
		base_class = ~T~
  END
END 
ACTION_IF FILE_EXISTS_IN_GAME ~d5_mstr.2da~ BEGIN
  LAF qd_multiclass
	STR_VAR
		kit_name = ~D5_MEISTER~ 
		kit_clab = ~d5_mstr~
		base_class = ~M~
  END
END 
ACTION_IF FILE_EXISTS_IN_GAME ~d5_jinx.2da~ BEGIN
  LAF qd_multiclass
	STR_VAR
		kit_name = ~D5_JINXER~ 
		kit_clab = ~d5_jinx~
		base_class = ~M~
  END
END 
ACTION_IF FILE_EXISTS_IN_GAME ~d5_eleg.2da~ BEGIN
  LAF qd_multiclass
	STR_VAR
		kit_name = ~D5_ELEGIST~ 
		kit_clab = ~d5_eleg~
		base_class = ~M~
  END
END 
ACTION_IF FILE_EXISTS_IN_GAME ~d5_hxbl.2da~ BEGIN
  LAF qd_multiclass
	STR_VAR
		kit_name = ~D5_HEXBLADE~ 
		kit_clab = ~d5_hxbl~
		base_class = ~M~
  END
END 
ACTION_IF FILE_EXISTS_IN_GAME ~d5_agnt.2da~ BEGIN
  LAF qd_multiclass
	STR_VAR
		kit_name = ~D5_AGENT~ 
		kit_clab = ~d5_agnt~
		base_class = ~M~
  END
END 
ACTION_IF FILE_EXISTS_IN_GAME ~d5_lort.2da~ BEGIN
  LAF qd_multiclass
	STR_VAR
		kit_name = ~D5_LORESINGER_CT~
		kit_clab = ~d5_lort~
		base_class = ~T~
  END
END 
ACTION_IF FILE_EXISTS_IN_GAME ~d5_blads.2da~ BEGIN
  LAF qd_multiclass
	STR_VAR
		kit_name = ~D5_BLADESINGER~ 
		kit_clab = ~d5_blads~
		base_class = ~M~
  END
END 
//___________________________________________________________________________________


//CHANGE BARD STRONGHOLDS____________________________________________________________
//
// give theater to bard, blade, jester, gallant, loresinger
ACTION_IF GAME_IS ~BG2EE EET~ BEGIN

<<<<<<<< d5/raelis+.d
EXTEND_BOTTOM RAELIS 71 
  IF ~Global("PlayerHasStronghold","GLOBAL",0)
  	  OR(11)
		Kit(Player1,D5_BARD)
		Kit(Player1,D5_BLADE)
		Kit(Player1,D5_BLADESINGER)
		Kit(Player1,D5_JESTER)
		Kit(Player1,D5_SKALD)
		Kit(Player1,D5_GALLANT)
		Kit(Player1,D5_HERALD)
		Kit(Player1,D5_MEISTER)
		Kit(Player1,D5_JINXER)
		Kit(Player1,D5_HEXBLADE)
		Kit(Player1,D5_AGENT)
//		Kit(Player1,D5_LORESINGER)
~ THEN DO ~EraseJournalEntry(4685)
EraseJournalEntry(46846)
EraseJournalEntry(46847)
EraseJournalEntry(46848)
EraseJournalEntry(46849)
EraseJournalEntry(46850)
EraseJournalEntry(46851)
AddXPObject(Player1,44000)
AddXPObject(Player2,44000)
AddXPObject(Player3,44000)
AddXPObject(Player4,44000)
AddXPObject(Player5,44000)
AddXPObject(Player6,44000)
~ SOLVED_JOURNAL #47761 GOTO 61
END

EXTEND_BOTTOM RAELIS 72
  IF ~  OR(11)
		Kit(Player1,D5_BARD)
		Kit(Player1,D5_BLADE)
		Kit(Player1,D5_BLADESINGER)
		Kit(Player1,D5_JESTER)
		Kit(Player1,D5_SKALD)
		Kit(Player1,D5_GALLANT)
		Kit(Player1,D5_HERALD)
		Kit(Player1,D5_MEISTER)
		Kit(Player1,D5_JINXER)
		Kit(Player1,D5_HEXBLADE)
		Kit(Player1,D5_AGENT)
//		Kit(Player1,D5_LORESINGER)
  ~ THEN GOTO 73
END

EXTEND_BOTTOM HAERDA 99
  IF ~  OR(11)
		Kit(Player1,D5_BARD)
		Kit(Player1,D5_BLADE)
		Kit(Player1,D5_BLADESINGER)
		Kit(Player1,D5_JESTER)
		Kit(Player1,D5_SKALD)
		Kit(Player1,D5_GALLANT)
		Kit(Player1,D5_HERALD)
		Kit(Player1,D5_MEISTER)
		Kit(Player1,D5_JINXER)
		Kit(Player1,D5_HEXBLADE)
		Kit(Player1,D5_AGENT)
//		Kit(Player1,D5_LORESINGER)
  ~ THEN EXTERN ~RAELIS~ 59
END
>>>>>>>> 

COMPILE ~d5/raelis+.d~

// take guild away from bard, jester, skald, gallant, herald, meistersinger, loresinger

<<<<<<<< d5/renal+.d
ADD_TRANS_TRIGGER RENAL 7 ~!Kit(Player1,D5_BARD)
		!Kit(Player1,D5_BLADE)
		!Kit(Player1,D5_BLADESINGER)
		!Kit(Player1,D5_JESTER)
		!Kit(Player1,D5_MEISTER)
//		!Kit(Player1,D5_LORESINGER)~ DO 1
EXTEND_BOTTOM RENAL 7
  IF ~OR(5)
		Kit(Player1,D5_BARD)
		Kit(Player1,D5_BLADE)
		Kit(Player1,D5_BLADESINGER)
		Kit(Player1,D5_JESTER)
		Kit(Player1,D5_MEISTER)
//		Kit(Player1,D5_LORESINGER)
  ~ THEN REPLY #21233 GOTO 18
END
>>>>>>>> 

COMPILE ~d5/renal+.d~

// give ranger cabin to meistersinger

<<<<<<<< d5/uhmayor+.d
EXTEND_BOTTOM UHMAY01 31
  IF ~ Global("PlayerHasStronghold","GLOBAL",0)
	Global("MayorPay","GLOBAL",0)
	OR(2)
	  Kit(Player1,D5_WHISTLER)
	  Kit(Player1,D5_MEISTER)
~ THEN GOTO 34
END 

EXTEND_BOTTOM UHMAY01 33
  IF ~  Global("PlayerHasStronghold","GLOBAL",0)
	OR(2)
	  Kit(Player1,D5_WHISTLER)
	  Kit(Player1,D5_MEISTER)
~ THEN GOTO 34
END
>>>>>>>> 

COMPILE ~d5/uhmayor+.d~

END	//	end game_is
//____________________________________________________________________________________


// IWDEE BARD INTERACTIONS____________________________________________________________
//
ACTION_IF GAME_IS ~iwdee~ BEGIN
/*
  COPY_EXISTING ~delisia.dlg~ ~OVERRIDE~
	DECOMPILE_AND_PATCH BEGIN
	  REPLACE_TEXTUALLY ~Class(LastTalkedToBy,BARD_ALL)~ ~OR(11)
		Class(LastTalkedToBy,BARD_ALL)
		Kit(LastTalkedToBy,D5_BARD)
		Kit(LastTalkedToBy,D5_BLADE)
		Kit(LastTalkedToBy,D5_BLADESINGER)
		Kit(LastTalkedToBy,D5_JESTER)
		Kit(LastTalkedToBy,D5_SKALD)
		Kit(LastTalkedToBy,D5_GALLANT)
		Kit(LastTalkedToBy,D5_HERALD)
		Kit(LastTalkedToBy,D5_MEISTER)
		Kit(LastTalkedToBy,D5_JINXER)
		Kit(LastTalkedToBy,D5_HEXBLADE)
		Kit(LastTalkedToBy,D5_AGENT)
//		Kit(LastTalkedToBy,D5_LORESINGER)
~
	END
  BUT_ONLY
*/

<<<<<<<< d5/delisia+.d
EXTEND_BOTTOM DELISIA 0 
  IF ~Global("Bard_Greeting","GLOBAL",0)
  		OR(11)
		Kit(LastTalkedToBy,D5_BARD)
		Kit(LastTalkedToBy,D5_BLADE)
		Kit(LastTalkedToBy,D5_BLADESINGER)
		Kit(LastTalkedToBy,D5_JESTER)
		Kit(LastTalkedToBy,D5_SKALD)
		Kit(LastTalkedToBy,D5_GALLANT)
		Kit(LastTalkedToBy,D5_HERALD)
		Kit(LastTalkedToBy,D5_MEISTER)
		Kit(LastTalkedToBy,D5_JINXER)
		Kit(LastTalkedToBy,D5_HEXBLADE)
//		Kit(LastTalkedToBy,D5_LORESINGER)
		Kit(LastTalkedToBy,D5_AGENT)~
	THEN REPLY #5153 
	DO ~SetGlobal("Bard_Greeting","GLOBAL",1)
		AddXP2DA("Level_1_Easy")
		DisplayStringNoNameDlg(Myself,30979)
		SetGlobal("Know_Elisia","GLOBAL",1)
		AddJournalEntry(23507,QUEST)~ 
	GOTO 3
  IF ~Global("Bard_Greeting","GLOBAL",1)
  		OR(11)
		Kit(LastTalkedToBy,D5_BARD)
		Kit(LastTalkedToBy,D5_BLADE)
		Kit(LastTalkedToBy,D5_BLADESINGER)
		Kit(LastTalkedToBy,D5_JESTER)
		Kit(LastTalkedToBy,D5_SKALD)
		Kit(LastTalkedToBy,D5_GALLANT)
		Kit(LastTalkedToBy,D5_HERALD)
		Kit(LastTalkedToBy,D5_MEISTER)
		Kit(LastTalkedToBy,D5_JINXER)
		Kit(LastTalkedToBy,D5_HEXBLADE)
//		Kit(LastTalkedToBy,D5_LORESINGER)
		Kit(LastTalkedToBy,D5_AGENT)~ 
	THEN REPLY #5157 
	EXIT
END

EXTEND_BOTTOM DELISIA 1
  IF ~Global("Bard_Greeting","GLOBAL",0)
  		OR(11)
		Kit(LastTalkedToBy,D5_BARD)
		Kit(LastTalkedToBy,D5_BLADE)
		Kit(LastTalkedToBy,D5_BLADESINGER)
		Kit(LastTalkedToBy,D5_JESTER)
		Kit(LastTalkedToBy,D5_SKALD)
		Kit(LastTalkedToBy,D5_GALLANT)
		Kit(LastTalkedToBy,D5_HERALD)
		Kit(LastTalkedToBy,D5_MEISTER)
		Kit(LastTalkedToBy,D5_JINXER)
		Kit(LastTalkedToBy,D5_HEXBLADE)
//		Kit(LastTalkedToBy,D5_LORESINGER)
		Kit(LastTalkedToBy,D5_AGENT)~
	THEN REPLY #5153 
	DO ~SetGlobal("Bard_Greeting","GLOBAL",1)
		AddXP2DA("Level_1_Easy")
		DisplayStringNoNameDlg(Myself,30979)~ 
	GOTO 3
  IF ~Global("Bard_Greeting","GLOBAL",1)
  		OR(11)
		Kit(LastTalkedToBy,D5_BARD)
		Kit(LastTalkedToBy,D5_BLADE)
		Kit(LastTalkedToBy,D5_BLADESINGER)
		Kit(LastTalkedToBy,D5_JESTER)
		Kit(LastTalkedToBy,D5_SKALD)
		Kit(LastTalkedToBy,D5_GALLANT)
		Kit(LastTalkedToBy,D5_HERALD)
		Kit(LastTalkedToBy,D5_MEISTER)
		Kit(LastTalkedToBy,D5_JINXER)
		Kit(LastTalkedToBy,D5_HEXBLADE)
//		Kit(LastTalkedToBy,D5_LORESINGER)
		Kit(LastTalkedToBy,D5_AGENT)~
	THEN REPLY #5157 
	EXIT
END

EXTEND_BOTTOM DELISIA 10
  IF ~!Class(LastTalkedToBy,BARD_ALL)
	OR(11)
		Kit(LastTalkedToBy,D5_BARD)
		Kit(LastTalkedToBy,D5_BLADE)
		Kit(LastTalkedToBy,D5_BLADESINGER)
		Kit(LastTalkedToBy,D5_JESTER)
		Kit(LastTalkedToBy,D5_SKALD)
		Kit(LastTalkedToBy,D5_GALLANT)
		Kit(LastTalkedToBy,D5_HERALD)
		Kit(LastTalkedToBy,D5_MEISTER)
		Kit(LastTalkedToBy,D5_JINXER)
		Kit(LastTalkedToBy,D5_HEXBLADE)
//		Kit(LastTalkedToBy,D5_LORESINGER)
		Kit(LastTalkedToBy,D5_AGENT)~ 
	THEN REPLY #34554 
	GOTO 13
END
>>>>>>>> 
COMPILE ~d5/delisia+.d~

END
//____________________________________________________________________________________

// SOD BARD INTERACTIONS______________________________________________________________
//
ACTION_IF FILE_EXISTS_IN_GAME ~bdaraya.dlg~ BEGIN

<<<<<<<< d5/bdaraya+.d
EXTEND_BOTTOM BDARAYA 2

IF ~CheckStatGT(Player1,12,CHR) 
	OR(11)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #54887  EXTERN ~bdmaxwel~ 2

IF ~CheckStatLT(Player1,13,CHR)
	OR(11)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #54887  GOTO 4
END
>>>>>>>> 
COPY ~d5/bdaraya+.d~ ~weidu_external/%MOD_FOLDER%/compile/bdaraya+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#54887~ ~#254887~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/bdaraya+.d~

<<<<<<<< d5/bdautinn+.d
EXTEND_BOTTOM BDAUTINN 1

 IF ~OR(11)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #44392  GOTO 9
END
>>>>>>>> 
COPY ~d5/bdautinn+.d~ ~weidu_external/%MOD_FOLDER%/compile/bdautinn+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#44392~ ~#244392~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/bdautinn+.d~

<<<<<<<< d5/BDBFORT4+.d
EXTEND_BOTTOM BDBFORT4 7
  IF ~OR(11)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #43682 DO ~GiveItemCreate("bdscrl3b",Player1,0,0,0)
~ GOTO 9
END
>>>>>>>> 
COPY ~d5/BDBFORT4+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDBFORT4+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#43682~ ~#243682~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDBFORT4+.d~

<<<<<<<< d5/BDCORWIJ+.d
EXTEND_BOTTOM BDCORWIJ 82
  IF ~OR(11)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #52066  GOTO 84
END
>>>>>>>> 
COPY ~d5/BDCORWIJ+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDCORWIJ+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#52066~ ~#252066~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDCORWIJ+.d~

<<<<<<<< d5/BDDELEND+.d
EXTEND_BOTTOM BDDELEND 14
  IF ~OR(11)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #44605 DO ~SetGlobal("BD_SDD117_PLAY","BD0108",1)
~ GOTO 24
END

EXTEND_BOTTOM BDDELEND 28
  IF ~OR(11)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #44640  GOTO 37
END

/* this is a condition for the state itself.  need to figure out how to do this
EXTEND_BOTTOM BDDELEND 46
IF ~ Class(Player1,BARD_ALL)
	Global("bd_delenda_conned","BD0108",1)
~ THEN BEGIN 46 
...
END
*/
>>>>>>>> 
COPY ~d5/BDDELEND+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDDELEND+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#44605~ ~#244605~
    REPLACE_TEXTUALLY ~#44640~ ~#244640~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDDELEND+.d~

<<<<<<<< d5/BDDENELD+.d
EXTEND_BOTTOM BDDENELD 18
  IF ~OR(11)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #48995  GOTO 20
END

EXTEND_BOTTOM BDDENELD 36
  IF ~OR(11)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #62096  GOTO 37
END
>>>>>>>> 
COPY ~d5/BDDENELD+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDDENELD+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#48995~ ~#248995~
    REPLACE_TEXTUALLY ~#62096~ ~#262096~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDDENELD+.d~

<<<<<<<< d5/BDDREON+.d
EXTEND_BOTTOM BDDREON 5
  IF ~OR(11)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #61237  GOTO 7
END
EXTEND_BOTTOM BDDREON 8
  IF ~OR(11)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #61246  GOTO 9
END
>>>>>>>> 
COPY ~d5/BDDREON+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDDREON+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#61237~ ~#261237~
    REPLACE_TEXTUALLY ~#61246~ ~#261246~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDDREON+.d~

<<<<<<<< d5/BDDSSEN+.d
EXTEND_BOTTOM BDDSSEN 2
  IF ~OR(11)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #44056  GOTO 4
END

EXTEND_BOTTOM BDDSSEN 7
  IF ~OR(11)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #58567  GOTO 10
END
>>>>>>>> 
COPY ~d5/BDDSSEN+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDDSSEN+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#44056~ ~#244056~
    REPLACE_TEXTUALLY ~#58567~ ~#258567~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDDSSEN+.d~

<<<<<<<< d5/BDFAMARI+.d
EXTEND_BOTTOM BDFAMARI 2
  IF ~ CheckStatGT(Player1,16,CHR)
   OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #58488  GOTO 3
END
>>>>>>>> 
COPY ~d5/BDFAMARI+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDFAMARI+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#58488~ ~#258488~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDFAMARI+.d~

<<<<<<<< d5/BDGUAR20+.d
EXTEND_BOTTOM BDGUAR20 18
  IF ~OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #64235  GOTO 19
END
>>>>>>>> 
COPY ~d5/BDGUAR20+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDGUAR20+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#64235~ ~#264235~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDGUAR20+.d~

<<<<<<<< d5/BDHESTER+.d
EXTEND_BOTTOM BDHESTER 6
  IF ~  OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #47990  GOTO 14

END

EXTEND_BOTTOM BDHESTER 7
  IF ~  OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #47998  GOTO 14
END
>>>>>>>> 
COPY ~d5/BDHESTER+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDHESTER+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#47990~ ~#247990~
    REPLACE_TEXTUALLY ~#47998~ ~#247998~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDHESTER+.d~

<<<<<<<< d5/BDJENKS+.d
EXTEND_BOTTOM BDJENKS 3
  IF ~CheckStatGT(Player1,12,CHR)
  OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #58765  GOTO 4
END
>>>>>>>> 
COPY ~d5/BDJENKS+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDJENKS+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#58765~ ~#258765~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDJENKS+.d~

<<<<<<<< d5/BDJOSPIL+.d
EXTEND_BOTTOM BDJOSPIL 23
  IF ~  OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #44809  DO ~SetGlobal("bd_wah029","LOCALS",1)
	IncrementGlobal("bd_jospil_score","LOCALS",2)
~ GOTO 24
END
>>>>>>>> 
COPY ~d5/BDJOSPIL+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDJOSPIL+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#44809~ ~#244809~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDJOSPIL+.d~

<<<<<<<< d5/BDKATHEE+.d
EXTEND_BOTTOM BDKATHEE 8
  IF ~  OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #57619  GOTO 9
END
>>>>>>>> 
COPY ~d5/BDKATHEE+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDKATHEE+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#57619~ ~#257619~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDKATHEE+.d~

<<<<<<<< d5/BDKHALID+.d
EXTEND_BOTTOM BDKHALID 36
  IF ~  OR(14)
	CheckStatGT(Player1,14,INT)
	CheckStatGT(Player1,13,WIS)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #57945  GOTO 37
END
>>>>>>>> 
COPY ~d5/BDKHALID+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDKHALID+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#57945~ ~#257945~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDKHALID+.d~

<<<<<<<< d5/BDLEOPAS+.d
EXTEND_BOTTOM BDLEOPAS 20
  IF ~  OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #47853  EXTERN ~BDVALIS~ 24
END

EXTEND_BOTTOM BDLEOPAS 20
  IF ~  OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #47854  EXTERN ~BDCORINT~ 21
END

EXTEND_BOTTOM BDLEOPAS 20
  IF ~ CheckStatGT(Player1,15,CHR)
	OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #47856  GOTO 28
END

EXTEND_BOTTOM BDLEOPAS 20
  IF ~ CheckStatLT(Player1,16,CHR)
	OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #47856  GOTO 27
END
>>>>>>>> 
COPY ~d5/BDLEOPAS+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDLEOPAS+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#47853~ ~#247853~
    REPLACE_TEXTUALLY ~#47854~ ~#247854~
    REPLACE_TEXTUALLY ~#47856~ ~#247856~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDLEOPAS+.d~

<<<<<<<< d5/BDRASAAD+.d
EXTEND_BOTTOM BDRASAAD 20
  IF ~  IsValidForPartyDialogue("Safana")
	OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #34589  DO ~SetGlobal("BD_Spoken_Rasaad","GLOBAL",1)
SetGlobal("bd_invited_rasaad","bd0111",1)
~ EXTERN ~BDSAFANJ~ 14
END

EXTEND_BOTTOM BDRASAAD 20
  IF ~  !IsValidForPartyDialogue("Safana")
	OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #34589  DO ~SetGlobal("BD_Spoken_Rasaad","GLOBAL",1)
SetGlobal("bd_invited_rasaad","bd0111",1)
~ GOTO 21
END
>>>>>>>> 
COPY ~d5/BDRASAAD+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDRASAAD+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#34589~ ~#234589~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDRASAAD+.d~

<<<<<<<< d5/BDRIGAH+.d
EXTEND_BOTTOM BDRIGAH 20
  IF ~ 	OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #52579  GOTO 21
END
>>>>>>>> 
COPY ~d5/BDRIGAH+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDRIGAH+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#52579~ ~#252579~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDRIGAH+.d~

<<<<<<<< d5/BDSHAPUR+.d
EXTEND_BOTTOM BDSHAPUR 8
  IF ~ 	OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #41754  GOTO 14
END

EXTEND_BOTTOM BDSHAPUR 25
  IF ~ 	OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
		OR(2)
	PartyHasItem("bdinsigc")
	PartyHasItem("bdinsigr")
~ THEN REPLY #41903  GOTO 26
END
>>>>>>>> 
COPY ~d5/BDSHAPUR+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDSHAPUR+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#41754~ ~#241754~
    REPLACE_TEXTUALLY ~#41903~ ~#241903~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDSHAPUR+.d~

<<<<<<<< d5/BDSIMONE+.d
EXTEND_BOTTOM BDSIMONE 14
  IF ~ 	OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #50976  GOTO 15
END
>>>>>>>> 
COPY ~d5/BDSIMONE+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDSIMONE+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#50976~ ~#250976~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDSIMONE+.d~

<<<<<<<< d5/BDSKIE+.d
EXTEND_BOTTOM BDSKIE 41
  IF ~ 	OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #44078  GOTO 47
END

EXTEND_BOTTOM BDSKIE 45
  IF ~  OR(14)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
	CheckStatGT(Player1,14,INT)
	CheckStatGT(Player1,14,WIS)
~ THEN REPLY #44084  GOTO 46
END
>>>>>>>> 
COPY ~d5/BDSKIE+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDSKIE+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#44078~ ~#244078~
    REPLACE_TEXTUALLY ~#44084~ ~#244084~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDSKIE+.d~

<<<<<<<< d5/BDTAKOS+.d
EXTEND_BOTTOM BDTAKOS 21
  IF ~ 	OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #42957  GOTO 23
END

EXTEND_BOTTOM BDTAKOS 22
  IF ~ 	OR(12)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #42962  GOTO 23
END
>>>>>>>> 
COPY ~d5/BDTAKOS+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDTAKOS+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#42957~ ~#242957~
    REPLACE_TEXTUALLY ~#42962~ ~#242962~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDTAKOS+.d~

<<<<<<<< d5/BDULORI+.d
EXTEND_BOTTOM BDULORI 3
  IF ~  Race(Player1,ELF)
	OR(12)
		Class(Player1,BARD_ALL)
		Kit(Player1,D5_BARD)
		Kit(Player1,D5_BLADE)
		Kit(Player1,D5_BLADESINGER)
		Kit(Player1,D5_JESTER)
		Kit(Player1,D5_SKALD)
		Kit(Player1,D5_GALLANT)
		Kit(Player1,D5_HERALD)
		Kit(Player1,D5_MEISTER)
		Kit(Player1,D5_JINXER)
		Kit(Player1,D5_HEXBLADE)
//		Kit(Player1,D5_LORESINGER)
		Kit(Player1,D5_AGENT)
~ THEN REPLY #49207  GOTO 4
END

EXTEND_BOTTOM BDULORI 3
  IF ~  !Race(Player1,ELF)
	OR(12)
		Class(Player1,BARD_ALL)
		Kit(Player1,D5_BARD)
		Kit(Player1,D5_BLADE)
		Kit(Player1,D5_BLADESINGER)
		Kit(Player1,D5_JESTER)
		Kit(Player1,D5_SKALD)
		Kit(Player1,D5_GALLANT)
		Kit(Player1,D5_HERALD)
		Kit(Player1,D5_MEISTER)
		Kit(Player1,D5_JINXER)
		Kit(Player1,D5_HEXBLADE)
//		Kit(Player1,D5_LORESINGER)
		Kit(Player1,D5_AGENT)
~ THEN REPLY #49207  GOTO 8
END
>>>>>>>> 
COPY ~d5/BDULORI+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDULORI+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#49207~ ~#249207~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDULORI+.d~

<<<<<<<< d5/BDWAIZAH+.d
EXTEND_BOTTOM BDWAIZAH 1
  IF ~  OR(13)
	CheckStatGT(Player1,13,CHR)
	Class(Player1,BARD_ALL)
	Kit(Player1,D5_BARD)
	Kit(Player1,D5_BLADE)
	Kit(Player1,D5_BLADESINGER)
	Kit(Player1,D5_JESTER)
	Kit(Player1,D5_SKALD)
	Kit(Player1,D5_GALLANT)
	Kit(Player1,D5_HERALD)
	Kit(Player1,D5_MEISTER)
	Kit(Player1,D5_JINXER)
	Kit(Player1,D5_HEXBLADE)
//	Kit(Player1,D5_LORESINGER)
	Kit(Player1,D5_AGENT)
~ THEN REPLY #48805  GOTO 0
END
>>>>>>>> 
COPY ~d5/BDWAIZAH+.d~ ~weidu_external/%MOD_FOLDER%/compile/BDWAIZAH+.d~
  PATCH_IF (GAME_IS ~eet~) BEGIN
    REPLACE_TEXTUALLY ~#48805~ ~#248805~
  END
COMPILE ~weidu_external/%MOD_FOLDER%/compile/BDWAIZAH+.d~

END 	// 	end game includes sod
//____________________________________________________________________________________


//CHANGE SOD BARD'S HAT______________________________________________________________
//
// ... have to do something with Wondrous Gloves too

COPY ~might_and_guile/nubards/bdhelm11.itm~ ~override~
	SAY IDENTIFIED_DESC @40900
COPY ~might_and_guile/nubards/d5bdh11.spl~ ~override~
	SAY NAME1 @7
COPY ~might_and_guile/nubards/d5bdh11.eff~ ~override~
//	SAY NAME1 @7
//___________________________________________________________________________________


//HUMANS CAN BE MULTICLASS BARDS______________________________________________________
//
ACTION_IF FILE_EXISTS_IN_GAME ~CLSRCREQ.2da~ BEGIN
  COPY_EXISTING ~clsrcreq.2da~ ~override~
	COUNT_2DA_ROWS 8 rows
	FOR (row = 0 ; row < rows ; ++row) BEGIN
      READ_2DA_ENTRY row 0 8 entry
      PATCH_IF ("%entry%" STRING_COMPARE_CASE "FIGHTER_MAGE"      = 0) OR
                ("%entry%" STRING_COMPARE_CASE "FIGHTER_THIEF" 	 = 0) OR
                ("%entry%" STRING_COMPARE_CASE "MAGE_THIEF" 	 = 0) OR
                ("%entry%" STRING_COMPARE_CASE "CLERIC_THIEF" 	 = 0) BEGIN
    	SET_2DA_ENTRY  row 1 8 1
    	SET_2DA_ENTRY  row 2 8 1
    	SET_2DA_ENTRY  row 3 8 1
      END
	END
  BUT_ONLY
END

/* don't think need to do this.  also why did I limit it to humans??
ACTION_FOR_EACH multi IN ~FM~ ~MT~ BEGIN
  ACTION_IF FILE_EXISTS_IN_GAME ~K_%multi%_H.2da~ BEGIN
	COPY_EXISTING ~K_%multi%_H.2da~ ~override~
	  COUNT_2DA_COLS cols
	  READ_2DA_ENTRIES_NOW rows cols
	  SET rows_removed = 0
	  FOR (row = 1; row < rows; ++row) BEGIN
		READ_2DA_ENTRY_FORMER rows row 1 kit
		PATCH_IF (%kit% = 0) BEGIN
		  REMOVE_2DA_ROW (row - rows_removed) cols
		  SET rows_removed += 1
		END
	  END
	BUT_ONLY
  END
END
*/
//____________________________________________________________________________________


//DISABLE OLD BARD KITS_______________________________________________________________
//
//LAM d5_revised_bard_settings	//	did this up top

ACTION_IF d5_suppress_old_bards = 1 BEGIN

ACTION_FOR_EACH race IN ~D~ ~E~ ~G~ ~H~ ~HE~ ~HL~ ~HO~ BEGIN
  ACTION_IF FILE_EXISTS_IN_GAME ~K_B_%race%.2da~ BEGIN
	COPY_EXISTING ~K_B_%race%.2da~ ~override~
	  COUNT_2DA_COLS cols
	  READ_2DA_ENTRIES_NOW rows cols
	  SET rows_removed = 0
	  FOR (row = 1; row < rows; ++row) BEGIN
		READ_2DA_ENTRY_FORMER rows row 1 kit
		PATCH_IF (%kit% = 0) OR 
		  		 (%kit% = 13) OR 
		  		 (%kit% = 14) OR 
		  		 (%kit% = 15) BEGIN
		  REMOVE_2DA_ROW (row - rows_removed) cols
		  SET rows_removed += 1
		END
	  END
	BUT_ONLY
  END
END

// and change clsrcreq.2da etc.
ACTION_IF FILE_EXISTS_IN_GAME ~CLSRCREQ.2da~ BEGIN
  COPY_EXISTING ~clsrcreq.2da~ ~override~
	COUNT_2DA_ROWS 8 rows
	FOR (row = 0 ; row < rows ; ++row) BEGIN
      READ_2DA_ENTRY row 0 8 entry
      PATCH_IF (("%entry%" STRING_COMPARE_CASE "BLADE"		= 0) OR
                ("%entry%" STRING_COMPARE_CASE "JESTER"		= 0) OR
                ("%entry%" STRING_COMPARE_CASE "SKALD"		= 0)) BEGIN
		SET_2DA_ENTRY  row 1 8 0
		SET_2DA_ENTRY  row 2 8 0
		SET_2DA_ENTRY  row 3 8 0
		SET_2DA_ENTRY  row 4 8 0
		SET_2DA_ENTRY  row 5 8 0
		SET_2DA_ENTRY  row 6 8 0
		SET_2DA_ENTRY  row 7 8 0
      END
	END
  BUT_ONLY
END

END
//___________________________________________________________________________________

